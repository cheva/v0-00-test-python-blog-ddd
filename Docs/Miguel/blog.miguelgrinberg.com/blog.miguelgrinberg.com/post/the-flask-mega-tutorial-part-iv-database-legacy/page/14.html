<!doctype html>
<html lang="en">
  
<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy/page/14 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 09:46:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
  <script type="text/javascript">
    function getPreferredTheme() {
      const storedTheme = localStorage.getItem('theme')
      if (storedTheme) {
        return storedTheme
      }
      return 'auto';
    }

    function setTheme(theme) {
      if (theme === 'auto') {
        theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
      }
      document.documentElement.setAttribute('data-bs-theme', theme);
    };

    setTheme(getPreferredTheme());
  </script>
  
    <title>
  
    The Flask Mega-Tutorial, Part IV: Database (2012) - miguelgrinberg.com
  
</title>
  
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="description" content="miguelgrinberg.com">
  <meta name="copyright" content="Copyright (c) 2012-2024 Miguel Grinberg">
  <meta name="author" content="Miguel Grinberg">
  
  <meta name="keywords" content="python, programming, flask, web, tutorial, database, sqlalchemy">
  
  
  <link rel="canonical" href="../../the-flask-mega-tutorial-part-iv-database-legacy.html">
  

  
    <link href="../../../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&amp;display=swap" rel="stylesheet">

  <link href="../../../static/tomorrow.min.css" type="text/css" rel="stylesheet" />
  <link href="../../../static/tomorrow-night.min.css" type="text/css" rel="stylesheet" />
  <link href="../../../static/social.css" rel="stylesheet" type="text/css" />
  <link href="../../../static/style_20231230.css" rel="stylesheet" type="text/css" />

  <link rel="shortcut icon" href="https://blog.miguelgrinberg.com/static/favicon.ico">
  <link rel="alternate" type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed" title="miguelgrinberg.com RSS feed">

    <meta property="og:title" content="The Flask Mega-Tutorial, Part IV: Database (2012)">
    <meta property="og:description" content="(Great news! There is a new version of this tutorial!)This is the fourth article in the series in which I document my experience writing web applications in Python using the Flask microframework.The…">
    <meta property="og:image" content="https://blog.miguelgrinberg.com/static/cards/the-flask-mega-tutorial-part-iv-database-legacy.jpg">
    <meta property="og:url" content="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy">
    <meta name="twitter:title" content="The Flask Mega-Tutorial, Part IV: Database (2012)">
    <meta name="twitter:description" content="(Great news! There is a new version of this tutorial!)This is the fourth article in the series in which I document my experience writing web applications in Python using the Flask microframework.The…">
    <meta name="twitter:image" content="https://blog.miguelgrinberg.com/static/cards/the-flask-mega-tutorial-part-iv-database-legacy.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@miguelgrinberg">

  </head>
  <body>
    <svg style="display: none" version="2.0">
      <defs>
        <symbol id="icon-theme-auto" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-circle-half" viewBox="0 0 16 16">
          <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16"/>
        </symbol>
        <symbol id="icon-theme-light" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-brightness-high-fill" viewBox="0 0 16 16">
          <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </symbol>
        <symbol id="icon-theme-dark" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-moon-stars-fill" viewBox="0 0 16 16">
          <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"/>
          <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
        </symbol>
      </defs>
    </svg>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="https://blog.miguelgrinberg.com/index">miguelgrinberg.com</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" aria-current="page" href="https://blog.miguelgrinberg.com/index">Home</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../my-courses-and-books.html">My Courses and Books</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../hire-me.html">Consulting</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../about-me.html">About Me</a></li>
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <svg width="20" height="20" version="2.0"><use id="current-theme" href="#icon-theme-light"></svg>
          </a>
          <ul class="dropdown-menu">
            <li>
              <a id="select-theme-light" class="dropdown-item" href="javascript:updateTheme('light')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-light"></svg>&nbsp; Light Mode
              </a>
            </li>
            <li>
              <a id="select-theme-dark" class="dropdown-item" href="javascript:updateTheme('dark')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-dark"></svg>&nbsp; Dark Mode
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a id="select-theme-auto" class="dropdown-item" href="javascript:updateTheme('auto')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-auto"></svg>&nbsp; System Default
              </a>
            </li>
          </ul>
        </li>
        
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item social-icons">
          <a type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed"><img src="../../../static/social/rss.png" alt="RSS Feed" title="RSS Feed" /></a>
          <a href="https://twitter.com/miguelgrinberg"><img src="../../../static/social/twitter.png" alt="Twitter" title="Twitter" /></a>
          <a rel="me" href="https://mstdn.social/@miguelgrinberg"><img src="../../../static/social/mastodon.png" alt="Mastodon" title="Mastodon" /></a>
          <a href="http://github.com/miguelgrinberg"><img src="../../../static/social/github.png" alt="GitHub" title="GitHub" /></a>
          <a href="https://youtube.com/miguelgrinberg"><img src="../../../static/social/youtube.png" alt="YouTube" title="YouTube" /></a>
          <a href="http://www.linkedin.com/in/miguelgrinberg"><img src="../../../static/social/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
          <a href="https://patreon.com/miguelgrinberg"><img src="../../../static/social/patreon.png" alt="Patreon" title="Patreon" /></a>
          <!--<a href="https://www.facebook.com/miguelgrinbergblog"><img src="/static/social/facebook.png" alt="Facebook" title="Facebook" /></a>-->
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row">
    <div class="col-md-8">
      <div id="main">
        
        
        
        
        

<div class="post">

<div class="post-header">
  <h1><a href="../../the-flask-mega-tutorial-part-iv-database-legacy.html">The Flask Mega-Tutorial, Part IV: Database (2012)</a></h1>
  <h2>
    Posted by
    <form action="https://blog.miguelgrinberg.com/author/Miguel Grinberg" method="POST">
      <input type="submit" class="btn btn-danger btn-sm" value="Miguel Grinberg" />
    </form>
    on
    <button class="btn btn-secondary btn-sm" disabled><span class="flask-moment" data-timestamp="2012-05-20T07:30:21Z" data-function="format" data-format="LL" data-refresh="0" style="display: none">2012-05-20T07:30:21Z</span></button>
    under
    
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Database" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Database" />
      </form>
    
    
  </h2>
</div>
<div class="post-body"><p><em>(Great news! There is a <a href="../../the-flask-mega-tutorial-part-i-hello-world.html">new version of this tutorial</a>!)</em></p>
<p>This is the fourth article in the series in which I document my experience writing web applications in <a href="http://python.org/">Python</a> using the <a href="http://flask.pocoo.org/">Flask</a> microframework.</p>
<p>The goal of the tutorial series is to develop a decently featured microblogging application that demonstrating total lack of originality I have decided to call <code>microblog</code>.</p>
<p><strong>NOTE</strong>: This article was revised in September 2014 to be in sync with current versions of Python and Flask.</p>
<p>Here is an index of all the articles in the series that have been published to date:</p>
<ul>
<li><a href="../../the-flask-mega-tutorial-part-i-hello-world-legacy.html">Part I: Hello, World!</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ii-templates-legacy.html">Part II: Templates</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iii-web-forms-legacy.html">Part III: Web Forms</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iv-database-legacy.html">Part IV: Database</a> (this article)</li>
<li><a href="../../the-flask-mega-tutorial-part-v-user-logins-legacy.html">Part V: User Logins</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vi-profile-page-and-avatars-legacy.html">Part VI: Profile Page And Avatars</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vii-unit-testing-legacy.html">Part VII: Unit Testing</a></li>
<li><a href="../../the-flask-mega-tutorial-part-viii-followers-contacts-and-friends-legacy.html">Part VIII: Followers, Contacts And Friends</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ix-pagination-legacy.html">Part IX: Pagination</a></li>
<li><a href="../../the-flask-mega-tutorial-part-x-full-text-search-legacy.html">Part X: Full Text Search</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xi-email-support-legacy.html">Part XI: Email Support</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xii-facelift-legacy.html">Part XII: Facelift</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiii-dates-and-times-legacy.html">Part XIII: Dates and Times</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiv-i18n-and-l10n-legacy.html">Part XIV: I18n and L10n</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xv-ajax-legacy.html">Part XV: Ajax</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvi-debugging-testing-and-profiling-legacy.html">Part XVI: Debugging, Testing and Profiling</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-even-on-the-raspberry-pi-legacy.html">Part XVII: Deployment on Linux (even on the Raspberry Pi!)</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xviii-deployment-on-the-heroku-cloud-legacy.html">Part XVIII: Deployment on the Heroku Cloud</a></li>
</ul>
<h2>Recap</h2>
<p>In the previous chapter of the series we created our login form, complete with submission and validation.</p>
<p>In this article we are going to create our database and set it up so that we can record our users in it.</p>
<p>To follow this chapter along you need to have the <code>microblog</code> app as we left it at the end of the previous chapter. Please make sure the app is installed and running.</p>
<h2>Running Python scripts from the command line</h2>
<p>In this chapter we are going to write a few scripts that simplify the management of our database. Before we get into that let's review how a Python script is executed on the command line.</p>
<p>If you are on Linux or OS X, then scripts have to be given executable permission, like this:</p>
<pre><code>$ chmod a+x script.py
</code></pre>
<p>The script has a <a href="http://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> line, which points to the interpreter that should be used. A script that has been given executable permission and has a shebang line can be executed simply like this:</p>
<pre><code>./script.py &lt;arguments&gt;
</code></pre>
<p>On Windows, however, this does not work, and instead you have to provide the script as an argument to the chosen Python interpreter:</p>
<pre><code>$ flask\Scripts\python script.py &lt;arguments&gt;
</code></pre>
<p>To avoid having to type the path to the Python interpreter you can add your <code>microblog/flask/Scripts</code> directory to the system path, making sure it appears before your regular Python interpreter. This can be temporarily achieved by activating the virtual environment with the following command:</p>
<pre><code>$ flask\Scripts\activate
</code></pre>
<p>From now on, in this tutorial the Linux/OS X syntax will be used for brevity. If you are on Windows remember to convert the syntax appropriately.</p>
<h2>Databases in Flask</h2>
<p>We will use the <a href="http://packages.python.org/Flask-SQLAlchemy">Flask-SQLAlchemy</a> extension to manage our application. This extension provides a wrapper for the <a href="http://www.sqlalchemy.org/">SQLAlchemy</a> project, which is an <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">Object Relational Mapper</a> or ORM.</p>
<p>ORMs allow database applications to work with objects instead of tables and SQL. The operations performed on the objects are translated into database commands transparently by the ORM. Knowing SQL can be very helpful when working with ORMs, but we will not be learning SQL in this tutorial, we will let Flask-SQLAlchemy speak SQL for us.</p>
<h2>Migrations</h2>
<p>Most database tutorials I've seen cover creation and use of a database, but do not adequately address the problem of updating a database as the application grows. Typically you end up having to delete the old database and create a new one each time you need to make updates, losing all the data. And if the data cannot be recreated easily you may be forced to write export and import scripts yourself.</p>
<p>Luckily, we have a much better option.</p>
<p>We are going to use <a href="https://github.com/openstack/sqlalchemy-migrate">SQLAlchemy-migrate</a> to keep track of database updates for us. It adds a bit of work to get a database started, but that is a small price to pay for never having to worry about manual database migrations.</p>
<p>Enough theory, let's get started!</p>
<h2>Configuration</h2>
<p>For our little application we will use a sqlite database. The sqlite databases are the most convenient choice for small applications, as each database is stored in a single file and there is no need to start a database server.</p>
<p>We have a couple of new configuration items to add to our config file (file <code>config.py</code>):</p>
<pre><code>import os
basedir = os.path.abspath(os.path.dirname(__file__))

SQLALCHEMY_DATABASE_URI = 'sqlite:///' + os.path.join(basedir, 'app.db')
SQLALCHEMY_MIGRATE_REPO = os.path.join(basedir, 'db_repository')
</code></pre>
<p>The SQLALCHEMY_DATABASE_URI is required by the Flask-SQLAlchemy extension. This is the path of our database file.</p>
<p>The SQLALCHEMY_MIGRATE_REPO is the folder where we will store the SQLAlchemy-migrate data files.</p>
<p>Finally, when we initialize our app we also need to initialize our database. Here is our updated package init file (file <code>app/__init__.py</code>):</p>
<pre><code>from flask import Flask
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config.from_object('config')
db = SQLAlchemy(app)

from app import views, models
</code></pre>
<p>Note the two changes we have made to our init script. We are now creating a <code>db</code> object that will be our database, and we are also importing a new module called <code>models</code>. We will write this module next.</p>
<h2>The database model</h2>
<p>The data that we will store in our database will be represented by a collection of classes that are referred to as the database models. The ORM layer will do the translations required to map objects created from these classes into rows in the proper database table.</p>
<p>Let's start by creating a model that will represent our users. Using the <a href="http://ondras.zarovi.cz/sql/demo">WWW SQL Designer</a> tool, I have made the following diagram to represent our users table:</p>
<p><img alt="users table" src="../../../static/images/flask-mega-tutorial-part-iv-1.png" /></p>
<p>The <code>id</code> field is usually in all models, and is used as the <em>primary key</em>. Each user in the database will be assigned a unique id value, stored in this field. Luckily this is done automatically for us, we just need to provide the <code>id</code> field.</p>
<p>The <code>nickname</code> and <code>email</code> fields are defined as strings (or VARCHAR in database jargon), and their maximum lengths are specified so that the database can optimize space usage.</p>
<p>Now that we have decided what we want our users table to look like, the job of translating that into code is pretty easy (file <code>app/models.py</code>):</p>
<pre><code>from app import db

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    nickname = db.Column(db.String(64), index=True, unique=True)
    email = db.Column(db.String(120), index=True, unique=True)

    def __repr__(self):
        return '&lt;User %r&gt;' % (self.nickname)
</code></pre>
<p>The <code>User</code> class that we just created contains several fields, defined as class variables. Fields are created as instances of the <code>db.Column</code> class, which takes the field type as an argument, plus other optional arguments that allow us, for example, to indicate which fields are unique and indexed.</p>
<p>The <code>__repr__</code> method tells Python how to print objects of this class. We will use this for debugging.</p>
<h2>Creating the database</h2>
<p>With the configuration and model in place we are now ready to create our database file. The SQLAlchemy-migrate package comes with command line tools and APIs to create databases in a way that allows easy updates in the future, so that is what we will use. I find the command line tools a bit awkward to use, so instead I have written my own set of little Python scripts that invoke the migration APIs.</p>
<p>Here is a script that creates the database (file <code>db_create.py</code>):</p>
<pre><code>#!flask/bin/python
from migrate.versioning import api
from config import SQLALCHEMY_DATABASE_URI
from config import SQLALCHEMY_MIGRATE_REPO
from app import db
import os.path
db.create_all()
if not os.path.exists(SQLALCHEMY_MIGRATE_REPO):
    api.create(SQLALCHEMY_MIGRATE_REPO, 'database repository')
    api.version_control(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
else:
    api.version_control(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO, api.version(SQLALCHEMY_MIGRATE_REPO))
</code></pre>
<p>Note how this script is completely generic. All the application specific pathnames are imported from the config file. When you start your own project you can just copy the script to the new app's directory and it will work right away.</p>
<p>To create the database you just need to execute this script (remember that if you are on Windows the command is slightly different):</p>
<pre><code>./db_create.py
</code></pre>
<p>After you run the command you will have a new <code>app.db</code> file. This is an empty sqlite database, created from the start to support migrations. You will also have a <code>db_repository</code> directory with some files inside. This is the place where SQLAlchemy-migrate stores its data files. Note that we do not regenerate the repository if it already exists. This will allow us to recreate the database while leaving the existing repository if we need to.</p>
<h2>Our first migration</h2>
<p>Now that we have defined our model, we can incorporate it into our database. We will consider any changes to the structure of the app database a <em>migration</em>, so this is our first, which will take us from an empty database to a database that can store users.</p>
<p>To generate a migration I use another little Python helper script (file <code>db_migrate.py</code>):</p>
<pre><code>#!flask/bin/python
import imp
from migrate.versioning import api
from app import db
from config import SQLALCHEMY_DATABASE_URI
from config import SQLALCHEMY_MIGRATE_REPO
v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
migration = SQLALCHEMY_MIGRATE_REPO + ('/versions/%03d_migration.py' % (v+1))
tmp_module = imp.new_module('old_model')
old_model = api.create_model(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
exec(old_model, tmp_module.__dict__)
script = api.make_update_script_for_model(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO, tmp_module.meta, db.metadata)
open(migration, "wt").write(script)
api.upgrade(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
print('New migration saved as ' + migration)
print('Current database version: ' + str(v))
</code></pre>
<p>The script looks complicated, but it doesn't really do much. The way SQLAlchemy-migrate creates a migration is by comparing the structure of the database (obtained in our case from file <code>app.db</code>) against the structure of our models (obtained from file <code>app/models.py</code>). The differences between the two are recorded as a migration script inside the migration repository. The migration script knows how to apply a migration or undo it, so it is always possible to upgrade or downgrade a database format.</p>
<p>While I have never had problems generating migrations automatically with the above script, I could see that sometimes it would be hard to determine what changes were made just by comparing the old and the new format. To make it easy for SQLAlchemy-migrate to determine the changes I never rename existing fields, I limit my changes to adding or removing models or fields, or changing types of existing fields. And I always review the generated migration script to make sure it is right.</p>
<p>It goes without saying that you should never attempt to migrate your database without having a backup, in case something goes wrong. Also never run a migration for the first time on a production database, always make sure the migration works correctly on a development database.</p>
<p>So let's go ahead and record our migration:</p>
<pre><code>$ ./db_migrate.py
</code></pre>
<p>And the output from the script will be:</p>
<pre><code>New migration saved as db_repository/versions/001_migration.py
Current database version: 1
</code></pre>
<p>The script shows where the migration script was stored, and also prints the current database version. The empty database version was version 0, after we migrated to include users we are at version 1.</p>
<h2>Database upgrades and downgrades</h2>
<p>By now you may be wondering why is it that important to go through the extra hassle of recording database migrations.</p>
<p>Imagine that you have your application in your development machine, and also have a copy deployed to a production server that is online and in use.</p>
<p>Let's say that for the next release of your app you have to introduce a change to your models, for example a new table needs to be added. Without migrations you would need to figure out how to change the format of your database, both in your development machine and then again in your server, and this could be a lot of work.</p>
<p>If you have database migration support, then when you are ready to release the new version of the app to your production server you just need to record a new migration, copy the migration scripts to your production server and run a simple script that applies the changes for you. The database upgrade can be done with this little Python script (file <code>db_upgrade.py</code>):</p>
<pre><code>#!flask/bin/python
from migrate.versioning import api
from config import SQLALCHEMY_DATABASE_URI
from config import SQLALCHEMY_MIGRATE_REPO
api.upgrade(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
print('Current database version: ' + str(v))
</code></pre>
<p>When you run the above script, the database will be upgraded to the latest revision, by applying the migration scripts stored in the database repository.</p>
<p>It is not a common need to have to downgrade a database to an old format, but just in case, SQLAlchemy-migrate supports this as well (file <code>db_downgrade.py</code>):</p>
<pre><code>#!flask/bin/python
from migrate.versioning import api
from config import SQLALCHEMY_DATABASE_URI
from config import SQLALCHEMY_MIGRATE_REPO
v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
api.downgrade(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO, v - 1)
v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
print('Current database version: ' + str(v))
</code></pre>
<p>This script will downgrade the database one revision. You can run it multiple times to downgrade several revisions.</p>
<h2>Database relationships</h2>
<p>Relational databases are good at storing relations between data items. Consider the case of a user writing a blog post. The user will have a record in the <code>users</code> table, and the post will have a record in the <code>posts</code> table. The most efficient way to record who wrote a given post is to link the two related records.</p>
<p>Once a link between a user and a post is established there are two types of queries that we may need to use. The most trivial one is when you have a blog post and need to know what user wrote it. A more complex query is the reverse of this one. If you have a user, you may want to know all the posts that the user wrote. Flask-SQLAlchemy will help us with both types of queries.</p>
<p>Let's expand our database to store posts, so that we can see relationships in action. For this we go back to our database design tool and create a <code>posts</code> table:</p>
<p><img alt="users table" src="../../../static/images/flask-mega-tutorial-part-iv-2.png" /></p>
<p>Our <code>posts</code> table will have the required <code>id</code>, the <code>body</code> of the post and a <code>timestamp</code>. Not much new there. But the <code>user_id</code> field deserves an explanation.</p>
<p>We said we wanted to link users to the posts that they write. The way to do that is by adding a field to the post that contains the <code>id</code> of the user that wrote it. This <code>id</code> is called a <em>foreign key</em>. Our database design tool shows foreign keys as a link between the foreign key and the <code>id</code> field of the table it refers to. This kind of link is called a one-to-many relationship, <em>one</em> user writes <em>many</em> posts.</p>
<p>Let's modify our models to reflect these changes (<code>app/models.py</code>):</p>
<pre><code>from app import db

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    nickname = db.Column(db.String(64), index=True, unique=True)
    email = db.Column(db.String(120), index=True, unique=True)
    posts = db.relationship('Post', backref='author', lazy='dynamic')

    def __repr__(self):
        return '&lt;User %r&gt;' % (self.nickname)

class Post(db.Model):
    id = db.Column(db.Integer, primary_key = True)
    body = db.Column(db.String(140))
    timestamp = db.Column(db.DateTime)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))

    def __repr__(self):
        return '&lt;Post %r&gt;' % (self.body)
</code></pre>
<p>We have added the <code>Post</code> class, which will represent blog posts written by users. The <code>user_id</code> field in the <code>Post</code> class was initialized as a <em>foreign key</em>, so that Flask-SQLAlchemy knows that this field will link to a user.</p>
<p>Note that we have also added a new field to the <code>User</code> class called <code>posts</code>, that is constructed as a <code>db.relationship</code> field. This is not an actual database field, so it isn't in our database diagram. For a one-to-many relationship a <code>db.relationship</code> field is normally defined on the "one" side. With this relationship we get a <code>user.posts</code> member that gets us the list of posts from the user. The first argument to <code>db.relationship</code> indicates the "many" class of this relationship. The <code>backref</code> argument defines a field that will be added to the objects of the "many" class that points back at the "one" object. In our case this means that we can use <code>post.author</code> to get the User instance that created a post. Don't worry if these details don't make much sense just yet, we'll see examples of this at the end of this article.</p>
<p>Let's record another migration with this change. Simply run:</p>
<pre><code>$ ./db_migrate.py
</code></pre>
<p>And the script will respond:</p>
<pre><code>New migration saved as db_repository/versions/002_migration.py
Current database version: 2
</code></pre>
<p>It isn't really necessary to record each little change to the database model as a separate migration, a migration is normally only recorded at significant points in the history of the project. We are doing more migrations than necessary here only to show how the migration system works.</p>
<h2>Play time</h2>
<p>We have spent a lot of time defining our database, but we haven't seen how it works yet. Since our app does not have database code yet let's make use of our brand new database in the Python interpreter.</p>
<p>So go ahead and fire up Python. On Linux or OS X:</p>
<pre><code>flask/bin/python
</code></pre>
<p>Or on Windows:</p>
<pre><code>flask\Scripts\python
</code></pre>
<p>Once in the Python prompt enter the following:</p>
<pre><code>&gt;&gt;&gt; from app import db, models
&gt;&gt;&gt;
</code></pre>
<p>This brings our database and models into memory. </p>
<p>Let's create a new user:</p>
<pre><code>&gt;&gt;&gt; u = models.User(nickname='john', email='john@email.com')
&gt;&gt;&gt; db.session.add(u)
&gt;&gt;&gt; db.session.commit()
&gt;&gt;&gt;
</code></pre>
<p>Changes to a database are done in the context of a session. Multiple changes can be accumulated in a session and once all the changes have been registered you can issue a single <code>db.session.commit()</code>, which writes the changes atomically. If at any time while working on a session there is an error, a call to <code>db.session.rollback()</code> will revert the database to its state before the session was started. If neither <code>commit</code> nor <code>rollback</code> are issued then the system by default will roll back the session. Sessions guarantee that the database will never be left in an inconsistent state.</p>
<p>Let's add another user:</p>
<pre><code>&gt;&gt;&gt; u = models.User(nickname='susan', email='susan@email.com')
&gt;&gt;&gt; db.session.add(u)
&gt;&gt;&gt; db.session.commit()
&gt;&gt;&gt;
</code></pre>
<p>Now we can query what our users are:</p>
<pre><code>&gt;&gt;&gt; users = models.User.query.all()
&gt;&gt;&gt; users
[&lt;User u'john'&gt;, &lt;User u'susan'&gt;]
&gt;&gt;&gt; for u in users:
...     print(u.id,u.nickname)
...
1 john
2 susan
&gt;&gt;&gt;
</code></pre>
<p>For this we have used the <code>query</code> member, which is available in all model classes. Note how the <code>id</code> member was automatically set for us.</p>
<p>Here is another way to do queries. If we know the <code>id</code> of a user we can find the data for that user as follows:</p>
<pre><code>&gt;&gt;&gt; u = models.User.query.get(1)
&gt;&gt;&gt; u
&lt;User u'john'&gt;
&gt;&gt;&gt;
</code></pre>
<p>Now let's add a blog post:</p>
<pre><code>&gt;&gt;&gt; import datetime
&gt;&gt;&gt; u = models.User.query.get(1)
&gt;&gt;&gt; p = models.Post(body='my first post!', timestamp=datetime.datetime.utcnow(), author=u)
&gt;&gt;&gt; db.session.add(p)
&gt;&gt;&gt; db.session.commit()
</code></pre>
<p>Here we set our <code>timestamp</code> in UTC time zone. All timestamps stored in our database will be in UTC. We can have users from all over the world writing posts and we need to use uniform time units. In a future tutorial we will see how to show these times to users in their local timezone.</p>
<p>You may have noticed that we have not set the <code>user_id</code> field of the Post class. Instead, we are storing a User object inside the <code>author</code> field. The <code>author</code> field is a virtual field that was added by Flask-SQLAlchemy to help with relationships, we have defined the name of this field in the <code>backref</code> argument to <code>db.relationship</code> in our model. With this information the ORM layer will know how to complete the <code>user_id</code> for us.</p>
<p>To complete this session, let's look at a few more database queries that we can do:</p>
<pre><code># get all posts from a user
&gt;&gt;&gt; u = models.User.query.get(1)
&gt;&gt;&gt; u
&lt;User u'john'&gt;
&gt;&gt;&gt; posts = u.posts.all()
&gt;&gt;&gt; posts
[&lt;Post u'my first post!'&gt;]

# obtain author of each post
&gt;&gt;&gt; for p in posts:
...     print(p.id,p.author.nickname,p.body)
...
1 john my first post!

# a user that has no posts
&gt;&gt;&gt; u = models.User.query.get(2)
&gt;&gt;&gt; u
&lt;User u'susan'&gt;
&gt;&gt;&gt; u.posts.all()
[]

# get all users in reverse alphabetical order
&gt;&gt;&gt; models.User.query.order_by('nickname desc').all()
[&lt;User u'susan'&gt;, &lt;User u'john'&gt;]
&gt;&gt;&gt;
</code></pre>
<p>The <a href="http://packages.python.org/Flask-SQLAlchemy/index.html">Flask-SQLAlchemy</a> documentation is the best place to learn about the many options that are available to query the database.</p>
<p>Before we close, let's erase the test users and posts we have created, so that we can start from a clean database in the next chapter:</p>
<pre><code>&gt;&gt;&gt; users = models.User.query.all()
&gt;&gt;&gt; for u in users:
...     db.session.delete(u)
...
&gt;&gt;&gt; posts = models.Post.query.all()
&gt;&gt;&gt; for p in posts:
...     db.session.delete(p)
...
&gt;&gt;&gt; db.session.commit()
&gt;&gt;&gt;
</code></pre>
<h2>Final words</h2>
<p>This was a long tutorial. We have learned the basics of working with a database, but we haven't incorporated the database into our application yet. In the next chapter we will put all we have learned about databases into practice when we look at our user login system.</p>
<p>In the meantime, if you haven't been writing the application along, you may want to download it in its current state:</p>
<p>Download <a href="https://github.com/miguelgrinberg/microblog-2012/archive/version-0.4.zip">microblog-0.4.zip</a>.</p>
<p>Note that I have not included a database in the zip file above, but the repository with the migrations is there. To create a new database just use the <code>db_create.py</code> script, then use <code>db_upgrade.py</code> to upgrade the database to the latest revision.</p>
<p>I hope to see you next time!</p>
<p>Miguel</p></div>

<div class="card patreon-bar">
  <div class="card-body">
    <h5>Become a Patron!</h5>
    <p class="card-text">Hello, and thank you for visiting my blog! If you enjoyed this article, please consider supporting my work on this blog on <a href="https://patreon.com/miguelgrinberg">Patreon</a>!</p>
    <a href="https://patreon.com/miguelgrinberg" alt="Become a Patron!" title="Become a Patron!"><img src="../../../static/patreon-button.png"></a>
  </div>
</div>


<div class="card social-bar">
  <div class="card-body">
    <h5>Share this post:</h5>
      <!-- Sharingbutton Hacker News -->
      <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy&amp;t=The%20Flask%20Mega-Tutorial%2C%20Part%20IV%3A%20Database%20%282012%29" target="_blank" rel="noopener" aria-label="Hacker News">
        <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg></div>Hacker News</div>
      </a>

      <!-- Sharingbutton Reddit -->
      <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy&amp;resubmit=true&amp;title=The%20Flask%20Mega-Tutorial,%20Part%20IV:%20Database%20(2012)" target="_blank" rel="noopener" aria-label="Reddit">
        <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div>Reddit</div>
      </a>

      <!-- Sharingbutton Twitter -->
      <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=The%20Flask%20Mega-Tutorial%2C%20Part%20IV%3A%20Database%20%282012%29&amp;url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy" target="_blank" rel="noopener" aria-label="Twitter">
        <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div>Twitter</div>
      </a>

      <!-- Sharingbutton LinkedIn -->
      <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy&amp;title=The%20Flask%20Mega-Tutorial%2C%20Part%20IV%3A%20Database%20%282012%29&amp;summary=The%20Flask%20Mega-Tutorial%2C%20Part%20IV%3A%20Database%20%282012%29&amp;source=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy" target="_blank" rel="noopener" aria-label="LinkedIn">
        <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div>LinkedIn</div>
      </a>

      <!-- Sharingbutton Facebook -->
      <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy" target="_blank" rel="noopener" aria-label="Facebook">
        <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div>Facebook</div>
      </a>

      <!-- Sharingbutton E-Mail -->
      <a class="resp-sharing-button__link" href="mailto:?subject=The%20Flask%20Mega-Tutorial%2C%20Part%20IV%3A%20Database%20%282012%29&amp;body=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy" target="_self" rel="noopener" aria-label="E-Mail">
        <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div>E-Mail</div>
      </a>

  </div>
</div>

<div id="comments" class="post-comment-count">
  
  <a class="btn btn-outline-secondary" href="../../the-flask-mega-tutorial-part-iv-database-legacy.html#comments">406 comments</a>
  
</div>


<div class="comments">
  <ul>
    
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#326</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-21T02:46:27Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-21T02:46:27Z</span>
  </p>
  <div>
    <p>@jda2000: See this StackOverflow answer for an example: <a href="http://stackoverflow.com/a/7143355/904393" rel="nofollow">http://stackoverflow.com/a/7143355/904393</a></p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/d4fd3c4e9e457d23b9578c903311ce10?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#327</span> <span class="badge text-bg-warning">Sebastian Cheung</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-22T00:52:10Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-22T00:52:10Z</span>
  </p>
  <div>
    <p>Hi Miguel,</p>
<p>Not sure why Roles database is not automatically created at all? </p>
<p>Please advice, or must I manually add each of the Roles specifications at run time? </p>
<p>Seb</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#328</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-22T03:05:39Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-22T03:05:39Z</span>
  </p>
  <div>
    <p>@Sebastian: there is no Roles table in this project, what table are you talking about?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/fb86bbc918edfb885f77de227b98b1f8?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#329</span> <span class="badge text-bg-warning">Sam</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-22T04:23:27Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-22T04:23:27Z</span>
  </p>
  <div>
    <p>when I run heroku run init<br>
I get <br>
Running <code>init</code> attached to terminal... up, run.4708</p>
<p>Traceback (most recent call last):</p>
<p>File "<a href="http://db_create.py/" rel="nofollow">db_create.py</a>", line 2, in &lt;module&gt;</p>
<pre><code>from migrate.versioning import api
</code></pre>
<p>ImportError: No module named migrate.versioning</p>
<p>this is what I have installed:</p>
<p>Flask==0.10.1<br>
Flask-Migrate==1.3.0<br>
Flask-SQLAlchemy==2.0<br>
Flask-Script==2.0.5<br>
Flask-WTF==0.10.3<br>
Jinja2==2.7.3<br>
Mako==1.0.0<br>
MarkupSafe==0.23<br>
PyRSS2Gen==1.0.0<br>
SQLAlchemy==0.7.9<br>
Tempita==0.5.2<br>
Twisted==12.2.0<br>
WTForms==2.0.1<br>
Werkzeug==0.9.6<br>
alembic==0.7.2<br>
altgraph==0.10.1<br>
bdist-mpkg==0.4.4<br>
bonjour-py==0.3<br>
decorator==3.4.0<br>
flask-mongoengine==0.7.1<br>
gunicorn==19.1.1<br>
itsdangerous==0.24<br>
macholib==1.5<br>
matplotlib==1.1.1<br>
modulegraph==0.10.1<br>
mongoengine==0.8.7<br>
numpy==1.6.2<br>
py2app==0.7.1<br>
pyOpenSSL==0.13<br>
pymongo==2.7.2<br>
pyobjc-core==2.3.2a0<br>
pyobjc-framework-AddressBook==2.3.2a0<br>
pyobjc-framework-AppleScriptKit==2.3.2a0<br>
pyobjc-framework-AppleScriptObjC==2.3.2a0<br>
pyobjc-framework-Automator==2.3.2a0<br>
pyobjc-framework-CFNetwork==2.3.2a0<br>
pyobjc-framework-Cocoa==2.3.2a0<br>
pyobjc-framework-Collaboration==2.3.2a0<br>
pyobjc-framework-CoreData==2.3.2a0<br>
pyobjc-framework-CoreLocation==2.3.2a0<br>
pyobjc-framework-CoreText==2.3.2a0<br>
pyobjc-framework-DictionaryServices==2.3.2a0<br>
pyobjc-framework-ExceptionHandling==2.3.2a0<br>
pyobjc-framework-FSEvents==2.3.2a0<br>
pyobjc-framework-InputMethodKit==2.3.2a0<br>
pyobjc-framework-InstallerPlugins==2.3.2a0<br>
pyobjc-framework-InstantMessage==2.3.2a0<br>
pyobjc-framework-InterfaceBuilderKit==2.3.2a0<br>
pyobjc-framework-LatentSemanticMapping==2.3.2a0<br>
pyobjc-framework-LaunchServices==2.3.2a0<br>
pyobjc-framework-Message==2.3.2a0<br>
pyobjc-framework-OpenDirectory==2.3.2a0<br>
pyobjc-framework-PreferencePanes==2.3.2a0<br>
pyobjc-framework-PubSub==2.3.2a0<br>
pyobjc-framework-QTKit==2.3.2a0<br>
pyobjc-framework-Quartz==2.3.2a0<br>
pyobjc-framework-ScreenSaver==2.3.2a0<br>
pyobjc-framework-ScriptingBridge==2.3.2a0<br>
pyobjc-framework-SearchKit==2.3.2a0<br>
pyobjc-framework-ServiceManagement==2.3.2a0<br>
pyobjc-framework-SyncServices==2.3.2a0<br>
pyobjc-framework-SystemConfiguration==2.3.2a0<br>
pyobjc-framework-WebKit==2.3.2a0<br>
pyobjc-framework-XgridFoundation==2.3.2a0<br>
python-dateutil==1.5<br>
pytz==2012d<br>
requests==2.5.0<br>
scipy==0.11.0<br>
sqlalchemy-migrate==0.7.2<br>
virtualenv==1.11.6<br>
wsgiref==0.1.2<br>
xattr==0.6.4<br>
zope.interface==3.8.0</p>
<p>this is what my <a href="http://db_create.py/" rel="nofollow">db_create.py</a> looks like:</p>
&lt;h1&gt;!flask/bin/python&lt;/h1&gt;
<p>from migrate.versioning import api<br>
from config import SQLALCHEMY_DATABASE_URI<br>
from config import SQLALCHEMY_MIGRATE_REPO<br>
from app import db<br>
import os.path<br>
db.create_all()<br>
if not os.path.exists(SQLALCHEMY_MIGRATE_REPO):<br>
    api.create(SQLALCHEMY_MIGRATE_REPO, 'database repository')<br>
    api.version_control(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)<br>
else:<br>
    api.version_control(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO, api.version(SQLALCHEMY_MIGRATE_REPO))</p>
<p>How can I fix this?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#330</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-22T07:00:24Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-22T07:00:24Z</span>
  </p>
  <div>
    <p>@Sam: The list of packages you show me appear to be from a Mac, there are a bunch of things that are OS X specific. Do you also have a requirements.txt file for Heroku to use in creating a virtual environment? You need to provide that in your repository, Heroku creates a virtualenv that must include all the packages required by your application.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/fb86bbc918edfb885f77de227b98b1f8?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#331</span> <span class="badge text-bg-warning">Sam</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-22T17:11:31Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-22T17:11:31Z</span>
  </p>
  <div>
    <p>Should there be two separate requirement.txt files? One for heroku and one for flask? All of the programs I have installed are in my requirements.txt file, but I am still getting this error: <br>
Running <code>init</code> attached to terminal... up, run.2054<br>
Traceback (most recent call last):<br>
  File "<a href="http://db_create.py/" rel="nofollow">db_create.py</a>", line 2, in &lt;module&gt;<br>
    from migrate.versioning import api<br>
ImportError: No module named migrate.versioning</p>
<p>I am not sure what migrate.versioning is referring to. Is it referring to Flask-Migrate? I cannot find any documentation on this issue.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#332</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-22T23:22:36Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-22T23:22:36Z</span>
  </p>
  <div>
    <p>@Sam: migrate.versioning is from sqlalchemy-migrate. I just now realize that you included Flask-Migrate and Alembic and also sqlalchemy-migrate. These are two migration solutions, which one are you using? Also, all those OS X specific packages that you have in your virtualenv are not going to work under Heroku, if your application uses OS X specific features then you will need to use an OS X server to run it.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/eb0aaa5348a7b81a4d0eeafa5bcdf7f6?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#333</span> <span class="badge text-bg-warning">John T</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-25T08:26:02Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-25T08:26:02Z</span>
  </p>
  <div>
    <p>Hi Miguel,</p>
<p>First of all, thank you so much for writing this excellent tutorial and spending time to answer the questions. This is one of the best learning experience ever. </p>
<p>Anyway, I'm a bit stuck on the Play Time part. I fired up Python, I entered the users, but when I queried them, I get this instead: [&lt;app.models.User object at 0x000000003Fe8E80&gt;, &lt;app.models.User object at 0.000000003F38F28&gt;, &lt;app.models.User object at 0.000000003EB55C0&gt;]</p>
<p>I'm guessing these are the location of the object rather their string representation? How do I fix this?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/727e737ddb264dcf2c32fc77bea0a904?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#334</span> <span class="badge text-bg-warning">John</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-25T23:25:07Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-25T23:25:07Z</span>
  </p>
  <div>
    <p>Great stuff Miguel, </p>
<p>Unfortunately the db_migrate is causing a bit of issue. When I try to change multiple things, it often throws an error. It is good if you change them one by one but in succession there is lots of bugs. Is there a fix for this? </p>
<p>For example, if you create a column with a relationship that is fine. But if you have a column that is an integer and then change it to a relationship, it causes a crash. However, you can get around this by first deleting the column and then adding a new one. Still this is a bit annoying to do everytime there is a database change.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#335</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-27T07:15:06Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-27T07:15:06Z</span>
  </p>
  <div>
    <p>@JohnT: the problem is that your model does not have a <strong>repr</strong>() method. This method tells Python how to print the class.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#336</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2014-12-27T07:16:23Z" data-function="fromNow" data-refresh="0" style="display: none">2014-12-27T07:16:23Z</span>
  </p>
  <div>
    <p>@John: the migration framework cannot always figure out what changed. Really it does the best it can, but you should always ensure that it got things right, and if not then edit the migration script manually to represent reality.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/7788dd1b0f8e000d8ac82435bf57d4cf?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#337</span> <span class="badge text-bg-warning">Gunther L</span> said
    
    <span class="flask-moment" data-timestamp="2015-01-02T10:00:22Z" data-function="fromNow" data-refresh="0" style="display: none">2015-01-02T10:00:22Z</span>
  </p>
  <div>
    <p>Since the market/career share of MongoDB is fairly big and still on the rise, and seems to be more interesting for what I'm planning personally, I'll try to use flask-mongoalchemy in a secondary venv. I don't have much expertise, since I've only recently subscribed to a course on MongoDB and have no other experience with nosql or flask, but it most likely integrates well. </p>
<p>Perhaps you can provide a similar tutorial for it in the future? It would certainly be well-received by many.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/f4ea4095ff2ec82c4b996c1e37fd963b?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#338</span> <span class="badge text-bg-warning">Maggie</span> said
    
    <span class="flask-moment" data-timestamp="2015-01-02T19:52:53Z" data-function="fromNow" data-refresh="0" style="display: none">2015-01-02T19:52:53Z</span>
  </p>
  <div>
    <p>Hi Miguel,</p>
<p>Thank you for posting this great tutorial!</p>
<p>I am very new to the art of programming and I am having some issues with the migration to the database. I had a similar problem to Josh, where I uninstalled a later version of sqlalchemy-migrate and installed version 0.7.2. This also installed a folder called migrate, but this seem to be where <a href="http://api.py/" rel="nofollow">api.py</a> is run from so I guess that part is ok.</p>
<p>I am on a Windows machine and when I run the command flask\Scripts\python <a href="http://db_create.py/" rel="nofollow">db_create.py</a> I get the following error (in the app db_repository is made, but not the db file in the app folder.</p>
<p>C:\microblog&gt;flask\Scripts\python <a href="http://db_create.py/" rel="nofollow">db_create.py</a><br>
Traceback (most recent call last):<br>
  File "<a href="http://db_create.py/" rel="nofollow">db_create.py</a>", line 2, in &lt;module&gt;<br>
    from migrate.versioning import api<br>
  File "C:\microblog\flask\lib\site-packages\<a href="http://migrate__init__.py/" rel="nofollow">migrate__init__.py</a>", line 9, in &lt;m
odule&gt;<br>
    from migrate.changeset import *
  File "C:\microblog\flask\lib\site-packages\migrate\<a href="http://changeset__init__.py/" rel="nofollow">changeset__init__.py</a>", lin<br>
e 21, in &lt;module&gt;<br>
    from migrate.changeset.schema import *
  File "C:\microblog\flask\lib\site-packages\migrate\changeset\<a href="http://schema.py/" rel="nofollow">schema.py</a>", line<br>
6, in &lt;module&gt;<br>
    from UserDict import DictMixin<br>
ImportError: No module named 'UserDict'</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#339</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2015-01-03T02:27:15Z" data-function="fromNow" data-refresh="0" style="display: none">2015-01-03T02:27:15Z</span>
  </p>
  <div>
    <p>@Maggie: version 0.7.2 is the version I used two years ago when I wrote the original version of this tutorial for Python 2. This version works really well, but it is not compatible with Python 3. I recommend that you upgrade sqlalchemy-migrate to the latest version, which is compatible with Python 3.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/02f4655efd42cd20b136815463e22946?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#340</span> <span class="badge text-bg-warning">ken</span> said
    
    <span class="flask-moment" data-timestamp="2015-01-04T12:55:19Z" data-function="fromNow" data-refresh="0" style="display: none">2015-01-04T12:55:19Z</span>
  </p>
  <div>
    <p>Good day, Miguel! </p>
<p>First of all, thank you for this tutorial. It actually brings back my interest back in coding. But I'm having a problem regarding on running <a href="http://db_create.py/" rel="nofollow">db_create.py</a>. Here's what I get.</p>
<p>File "C:\Users\ken\Desktop\wadiya&gt;flask\Scripts\python <a href="http://db_create.py/" rel="nofollow">db_create.py</a><br>
 Traceback (most recent call last):</p>
<p>File "<a href="http://db_create.py/" rel="nofollow">db_create.py</a>" line 2, in &lt;module&gt;<br>
    from migrate.versioning import api<br>
 File "C:\Users\ken\Desktop\wadiya\flask\lib\site-packages\lib\site-packages\<a href="http://migrate__init__.py/" rel="nofollow">migrate__init__.py</a>", line 14, in &lt;module&gt;</p>
<pre><code>pkg_resources.Requirement.parse('sqlalchemy-migrate')).version
</code></pre>
<p>File "C:\Users\ken\Desktop\wadiya\flask\lib\site-packages\setuptools-0.6c11-py2.7.egg\<a href="http://pkg_resources.py/" rel="nofollow">pkg_resources.py</a>", line 197, in get_provider<br>
 File "C:\Users\ken\Desktop\wadiya\flask\lib\site-packagessetuptools-0.6c11-py2.7.egg\<a href="http://pkg_resources.py/" rel="nofollow">pkg_resources.py</a>", line 666, in require<br>
 File "C:\Users\ken\Desktop\wadiya\flask\lib\site-packages\setuptools-0.6c11-py2.7.egg\<a href="http://pkg_resources.py/" rel="nofollow">pkg_resources.py</a>", line 565, in resolve<br>
 pkg_resources.DistributionNotFound: sqlalchemy-migrate</p>
<p>I tried doing the tutorial again from the first part, but I always stuck on this specific part. I installed the <a href="http://virtualenv.py/" rel="nofollow">virtualenv.py</a> all the components of flask. My SQLAlchemy is version 0.9.8 and SQLAlchemy-migrate is 0.9.2.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#341</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2015-01-05T06:34:40Z" data-function="fromNow" data-refresh="0" style="display: none">2015-01-05T06:34:40Z</span>
  </p>
  <div>
    <p>@ken: You are using Python 2.7, so you can downgrade your sqlalchemy-migrate to 0.7.2 and see if that helps. This project changed hands now, I doubt it is being tested much under Windows these days. Version 0.7.2 is the one I used back when I wrote this article, give that a try and let me know it works.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/3d298667c8dfbad28e1cc63f8c3d4756?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#342</span> <span class="badge text-bg-warning">Gleb</span> said
    
    <span class="flask-moment" data-timestamp="2015-01-27T12:24:47Z" data-function="fromNow" data-refresh="0" style="display: none">2015-01-27T12:24:47Z</span>
  </p>
  <div>
    <p>Hello, Miguel.</p>
<p>Thank you for so comprehensive tutorial. I've found it very useful.<br>
I want to ask a question about database migration. When i do it i ussualy receive error in db_migrate file line 11<br>
exec old_model in tmp_module.<strong>dict</strong> <br>
when you exec old model(plain text) and insert it to new module.<br>
Error looks like this "TypeError: object() takes no parameters"<br>
I can't get why i get this error. because in your original version everything is ok.</p>
<p>Thank you in advance, Gleb Stepanov.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#343</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2015-01-28T06:26:54Z" data-function="fromNow" data-refresh="0" style="display: none">2015-01-28T06:26:54Z</span>
  </p>
  <div>
    <p>@Gleb: a complete stack trace of the error would be helpful.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/8cdcf468e03959285742d09b5a8e1835?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#344</span> <span class="badge text-bg-warning">Aditya Dhara</span> said
    
    <span class="flask-moment" data-timestamp="2015-01-30T22:19:42Z" data-function="fromNow" data-refresh="0" style="display: none">2015-01-30T22:19:42Z</span>
  </p>
  <div>
    <p>Hi Miguel,</p>
<p>I have a question: is there a way to compare the existing database schema to <a href="http://models.py/?" rel="nofollow">models.py?</a></p>
<p>my end goal is to automate the creation of migrations when I change <a href="http://models.py/" rel="nofollow">models.py</a> so,<br>
if database_is_updated():<br>
    db_migrate()<br>
where database_is_updated compares the existing database to <a href="http://models.py/" rel="nofollow">models.py</a></p>
<p>Thanks,<br>
Aditya</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/e828a27398858e1cf6790734f337e783?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#345</span> <span class="badge text-bg-warning">Ryan Hartje</span> said
    
    <span class="flask-moment" data-timestamp="2015-01-31T18:00:46Z" data-function="fromNow" data-refresh="0" style="display: none">2015-01-31T18:00:46Z</span>
  </p>
  <div>
    <p>@Naren,</p>
<p>You have an extra l in your <a href="http://config.py/" rel="nofollow">config.py</a>, specifically here:<br>
SQLALCHEMY_DATABASE_URI = 'sqllite:///' + os.path.join(basedir, 'app.db')</p>
<p>I had the same issue, you should replace sqllite with sqlite (only 1 l):<br>
SQLALCHEMY_DATABASE_URI = 'sqlite:///' + os.path.join(basedir, 'app.db')</p>
<p>I hope this helps.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#346</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2015-02-01T03:30:14Z" data-function="fromNow" data-refresh="0" style="display: none">2015-02-01T03:30:14Z</span>
  </p>
  <div>
    <p>@Aditya: that is how automated migrations work. But these comparisons are not always producing the correct migrations, they always need to be checked for accuracy.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/3b5c60a681efc53bce3598e29da1d4cc?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#347</span> <span class="badge text-bg-warning">Rodrigo Araujo</span> said
    
    <span class="flask-moment" data-timestamp="2015-02-04T02:22:56Z" data-function="fromNow" data-refresh="0" style="display: none">2015-02-04T02:22:56Z</span>
  </p>
  <div>
    <p>Hi! Congratulations on this epic tutorial!<br>
I'm having trouble on the <a href="http://db_create.py/" rel="nofollow">db_create.py</a> script: when I run it, I get the following errors:</p>
<p>Phantomiald:ProjectOrion rodrigo$ ./<a href="http://db_create.py/" rel="nofollow">db_create.py</a> <br>
Traceback (most recent call last):<br>
  File "./<a href="http://db_create.py/" rel="nofollow">db_create.py</a>", line 2, in &lt;module&gt;<br>
    import migrate.versioning<br>
  File "/Library/Python/2.7/site-packages/migrate/<strong>init</strong>.py", line 11, in &lt;module&gt;<br>
    from migrate.changeset import *
  File "/Library/Python/2.7/site-packages/migrate/changeset/<strong>init</strong>.py", line 19, in &lt;module&gt;<br>
    from migrate.changeset.schema import *
  File "/Library/Python/2.7/site-packages/migrate/changeset/<a href="http://schema.py/" rel="nofollow">schema.py</a>", line 202, in &lt;module&gt;<br>
    class ColumnDelta(six.with_metaclass(MyMeta, DictMixin, sqlalchemy.schema.SchemaItem)):<br>
TypeError: with_metaclass() takes at most 2 arguments (3 given)</p>
<p>I have SQLAlchemy==0.9.8 and sqlalchemy-migrate==0.9.4, any ideas on what might be causing this?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#348</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2015-02-04T07:26:02Z" data-function="fromNow" data-refresh="0" style="display: none">2015-02-04T07:26:02Z</span>
  </p>
  <div>
    <p>@Rodrigo: What version of package six do you have? Make sure you have the latest release.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/26a4e8be0a97fcc96ba503841a9fcd95?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#349</span> <span class="badge text-bg-warning">Patricio</span> said
    
    <span class="flask-moment" data-timestamp="2015-02-05T01:18:10Z" data-function="fromNow" data-refresh="0" style="display: none">2015-02-05T01:18:10Z</span>
  </p>
  <div>
    <p>@ken: it seems fixed on git repository.</p>
<blockquote>
<blockquote>
<blockquote>
<p>import migrate<br>
print migrate.<strong>version</strong><br>
0.9.4.post9<br>
from migrate.versioning import api<br>
</p>
</blockquote>
</blockquote>
</blockquote>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/22b42bdb619fcb2d8c1d1f134a714762?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#350</span> <span class="badge text-bg-warning">Thomas</span> said
    
    <span class="flask-moment" data-timestamp="2015-02-10T18:58:27Z" data-function="fromNow" data-refresh="0" style="display: none">2015-02-10T18:58:27Z</span>
  </p>
  <div>
    <p>I am trying to use your migration script <a href="http://db_migrate.py/" rel="nofollow">db_migrate.py</a>, however, even though I specify unique=True in my <a href="http://models.py/" rel="nofollow">models.py</a>, the unique=True part is never included in the generated migration scripts. What gives?</p>
  </div>
</div>
    </li>
    
  </ul>
</div>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item"><a class="page-link" href="1.html#comments">&laquo;&laquo;</a></li>
    <li class="page-item"><a class="page-link" href="13.html#comments">&laquo;</a></li>
    <li class="page-item"><a class="page-link" href="15.html#comments">&raquo;</a></li>
    <li class="page-item"><a class="page-link" href="0.html#comments">&raquo;&raquo;</a></li>
  </ul>
</nav>




</div>

      </div>
    </div>
    
    <div class="col-md-4">
      <div id="sidebar">
        
          
  



<div class="card">
  
  
  
  <div class="card-header">SQLAlchemy 2 In Practice</div>
  <a class="card-book-cover" href="https://amzn.to/3S0diwc">
    <img src="../../../static/sqlalchemy-small.png">
  </a>
  <div class="card-body">
    <p class="card-text">If you want to learn the ins and outs of relational database programming with Python and SQLAlchemy, consider my <a href="https://amzn.to/3S0diwc">SQLAlchemy 2 In Practice</a> book, available on <a href="https://amzn.to/3S0diwc">Amazon</a>.</p>
  </div>
  <div class="card-body">
    <a class="card-link" href="https://amzn.to/3S0diwc">Click here to get this Book!</a><br />
  </div>

  
</div>
        
        <div class="card">
  <div class="card-header">About Miguel</div>
  <div class="card-body">
    <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="../../../static/miguel.jpg" />
    <p class="card-text">Welcome to my blog!</p>
    <p class="card-text">I'm a software engineer and technical writer, currently living in Drogheda, Ireland.</p>
    <p class="card-text">You can also find me on <a href="https://twitter.com/miguelgrinberg">Twitter</a>, <a href="https://mstdn.social/@miguelgrinberg">Mastodon</a>, <a href="https://github.com/miguelgrinberg">Github</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a>, <a href="https://youtube.com/miguelgrinberg">YouTube</a>, <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a> and <a href="https://patreon.com/miguelgrinberg">Patreon</a>.</p>
    <p class="card-text">Thank you for visiting!</p>
  </div>
</div>
        
        <div class="card" id="categories">
  <div class="card-header">Categories</div>
  <div class="card-body">
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AI/feed"><img src="../../../static/rss-small.png" title="AI RSS Feed" label="AI RSS Feed" alt="AI RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AI" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AI" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AWS/feed"><img src="../../../static/rss-small.png" title="AWS RSS Feed" label="AWS RSS Feed" alt="AWS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AWS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AWS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Arduino/feed"><img src="../../../static/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed" alt="Arduino RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Arduino" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Arduino" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Authentication/feed"><img src="../../../static/rss-small.png" title="Authentication RSS Feed" label="Authentication RSS Feed" alt="Authentication RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Authentication" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Authentication" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Blog/feed"><img src="../../../static/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed" alt="Blog RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Blog" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Blog" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/C++/feed"><img src="../../../static/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed" alt="C++ RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/C++" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="C++" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/CSS/feed"><img src="../../../static/rss-small.png" title="CSS RSS Feed" label="CSS RSS Feed" alt="CSS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/CSS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="CSS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Cloud/feed"><img src="../../../static/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed" alt="Cloud RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Cloud" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Cloud" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Database/feed"><img src="../../../static/rss-small.png" title="Database RSS Feed" label="Database RSS Feed" alt="Database RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Database" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Database" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Docker/feed"><img src="../../../static/rss-small.png" title="Docker RSS Feed" label="Docker RSS Feed" alt="Docker RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Docker" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Docker" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Filmmaking/feed"><img src="../../../static/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed" alt="Filmmaking RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Filmmaking" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Filmmaking" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Flask/feed"><img src="../../../static/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed" alt="Flask RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" /> <small><em>126</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Games/feed"><img src="../../../static/rss-small.png" title="Games RSS Feed" label="Games RSS Feed" alt="Games RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Games" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Games" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Heroku/feed"><img src="../../../static/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed" alt="Heroku RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Heroku" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Heroku" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/IoT/feed"><img src="../../../static/rss-small.png" title="IoT RSS Feed" label="IoT RSS Feed" alt="IoT RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/IoT" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="IoT" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/JavaScript/feed"><img src="../../../static/rss-small.png" title="JavaScript RSS Feed" label="JavaScript RSS Feed" alt="JavaScript RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/JavaScript" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="JavaScript" /> <small><em>35</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/MicroPython/feed"><img src="../../../static/rss-small.png" title="MicroPython RSS Feed" label="MicroPython RSS Feed" alt="MicroPython RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/MicroPython" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="MicroPython" /> <small><em>9</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microdot/feed"><img src="../../../static/rss-small.png" title="Microdot RSS Feed" label="Microdot RSS Feed" alt="Microdot RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microdot" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microdot" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microservices/feed"><img src="../../../static/rss-small.png" title="Microservices RSS Feed" label="Microservices RSS Feed" alt="Microservices RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microservices" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microservices" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Movie Reviews/feed"><img src="../../../static/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed" alt="Movie Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Movie Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Movie Reviews" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/OpenStack/feed"><img src="../../../static/rss-small.png" title="OpenStack RSS Feed" label="OpenStack RSS Feed" alt="OpenStack RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/OpenStack" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="OpenStack" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Personal/feed"><img src="../../../static/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed" alt="Personal RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Personal" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Personal" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Photography/feed"><img src="../../../static/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed" alt="Photography RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Photography" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Photography" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Product Reviews/feed"><img src="../../../static/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed" alt="Product Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Product Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Product Reviews" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Programming/feed"><img src="../../../static/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed" alt="Programming RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" /> <small><em>187</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Project Management/feed"><img src="../../../static/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed" alt="Project Management RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Project Management" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Project Management" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Python/feed"><img src="../../../static/rss-small.png" title="Python RSS Feed" label="Python RSS Feed" alt="Python RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" /> <small><em>169</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/REST/feed"><img src="../../../static/rss-small.png" title="REST RSS Feed" label="REST RSS Feed" alt="REST RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/REST" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="REST" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Rackspace/feed"><img src="../../../static/rss-small.png" title="Rackspace RSS Feed" label="Rackspace RSS Feed" alt="Rackspace RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Rackspace" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Rackspace" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Raspberry Pi/feed"><img src="../../../static/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed" alt="Raspberry Pi RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Raspberry Pi" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Raspberry Pi" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/React/feed"><img src="../../../static/rss-small.png" title="React RSS Feed" label="React RSS Feed" alt="React RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/React" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="React" /> <small><em>18</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Robotics/feed"><img src="../../../static/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed" alt="Robotics RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Robotics" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Robotics" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Security/feed"><img src="../../../static/rss-small.png" title="Security RSS Feed" label="Security RSS Feed" alt="Security RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Security" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Security" /> <small><em>12</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Video/feed"><img src="../../../static/rss-small.png" title="Video RSS Feed" label="Video RSS Feed" alt="Video RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Video" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Video" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/WebSocket/feed"><img src="../../../static/rss-small.png" title="WebSocket RSS Feed" label="WebSocket RSS Feed" alt="WebSocket RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/WebSocket" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="WebSocket" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Webcast/feed"><img src="../../../static/rss-small.png" title="Webcast RSS Feed" label="Webcast RSS Feed" alt="Webcast RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Webcast" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Webcast" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Windows/feed"><img src="../../../static/rss-small.png" title="Windows RSS Feed" label="Windows RSS Feed" alt="Windows RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Windows" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Windows" /> <small><em>1</em></small>
      </form>
    </div>
    
  </div>
</div>
        
      </div>
    </div>
    
  </div>
  <div id="footer">
    
    <p>&copy; 2012-<script type="text/javascript">document.write(new Date().getFullYear());</script> by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster _at_ miguelgrinberg _dot_ com">Questions?</a></p>
  </div>
</div>

  
    <script src="../../../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../../../static/prettify.js"></script>
  <script src="../../../../cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous"></script>

<script>
moment.locale("en");
function flask_moment_render(elem) {{
    const timestamp = moment(elem.dataset.timestamp);
    const func = elem.dataset.function;
    const format = elem.dataset.format;
    const timestamp2 = elem.dataset.timestamp2;
    const no_suffix = elem.dataset.nosuffix;
    const units = elem.dataset.units;
    let args = [];
    if (format)
        args.push(format);
    if (timestamp2)
        args.push(moment(timestamp2));
    if (no_suffix)
        args.push(no_suffix);
    if (units)
        args.push(units);
    elem.textContent = timestamp[func].apply(timestamp, args);
    elem.classList.remove('flask-moment');
    elem.style.display = "";
}}
function flask_moment_render_all() {{
    const moments = document.querySelectorAll('.flask-moment');
    moments.forEach(function(moment) {{
        flask_moment_render(moment);
        const refresh = moment.dataset.refresh;
        if (refresh && refresh > 0) {{
            (function(elem, interval) {{
                setInterval(function() {{
                    flask_moment_render(elem);
                }}, interval);
            }})(moment, refresh);
        }}
    }})
}}
document.addEventListener("DOMContentLoaded", flask_moment_render_all);
</script>

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-20EHZP9GRZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-20EHZP9GRZ');
  </script>
  
  <script type="text/javascript">
    function setThemeUI() {
      document.getElementById('select-theme-auto').classList.remove('active');
      document.getElementById('select-theme-light').classList.remove('active');
      document.getElementById('select-theme-dark').classList.remove('active');
      const theme = getPreferredTheme();
      const actualTheme = document.documentElement.getAttribute('data-bs-theme', 'light');
      document.getElementById('select-theme-' + theme).classList.add('active');
      document.getElementById('current-theme').href.baseVal = `#icon-theme-${actualTheme}`;
    };

    function updateTheme(theme) {
      if (theme === 'auto') {
        localStorage.removeItem('theme')
      }
      else {
        localStorage.setItem('theme', theme)
      }
      setTheme(getPreferredTheme());
    }

    setThemeUI();

    const darkModePreference = window.matchMedia("(prefers-color-scheme: dark)");
    darkModePreference.addEventListener("change", e => {
      if (getPreferredTheme() === 'auto') {
        setTheme('auto');
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      // add prettyprint class to all <pre><code></code></pre> blocks
      let prettify = false;
      document.querySelectorAll('div.post-body pre code').forEach((code) => {
        code.parentNode.classList.add('prettyprint');
        prettify = true;
      });
      prettyPrint();
    });
  </script>

  </body>

<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database-legacy/page/14 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 09:46:21 GMT -->
</html>