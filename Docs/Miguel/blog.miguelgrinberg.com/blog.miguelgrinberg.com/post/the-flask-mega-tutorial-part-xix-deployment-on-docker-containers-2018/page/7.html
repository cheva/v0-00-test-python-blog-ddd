<!doctype html>
<html lang="en">
  
<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018/page/7 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 09:45:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
  <script type="text/javascript">
    function getPreferredTheme() {
      const storedTheme = localStorage.getItem('theme')
      if (storedTheme) {
        return storedTheme
      }
      return 'auto';
    }

    function setTheme(theme) {
      if (theme === 'auto') {
        theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
      }
      document.documentElement.setAttribute('data-bs-theme', theme);
    };

    setTheme(getPreferredTheme());
  </script>
  
    <title>
  
    The Flask Mega-Tutorial Part XIX: Deployment on Docker Containers (2018) - miguelgrinberg.com
  
</title>
  
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="description" content="miguelgrinberg.com">
  <meta name="copyright" content="Copyright (c) 2012-2024 Miguel Grinberg">
  <meta name="author" content="Miguel Grinberg">
  
  <meta name="keywords" content="flask, python, programming, docker, containers">
  
  
  <link rel="canonical" href="../../the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018.html">
  

  
    <link href="../../../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&amp;display=swap" rel="stylesheet">

  <link href="../../../static/tomorrow.min.css" type="text/css" rel="stylesheet" />
  <link href="../../../static/tomorrow-night.min.css" type="text/css" rel="stylesheet" />
  <link href="../../../static/social.css" rel="stylesheet" type="text/css" />
  <link href="../../../static/style_20231230.css" rel="stylesheet" type="text/css" />

  <link rel="shortcut icon" href="https://blog.miguelgrinberg.com/static/favicon.ico">
  <link rel="alternate" type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed" title="miguelgrinberg.com RSS feed">

    <meta property="og:title" content="The Flask Mega-Tutorial Part XIX: Deployment on Docker Containers (2018)">
    <meta property="og:description" content="(Great news! There is a new version of this tutorial!)This is the nineteenth installment of the Flask Mega-Tutorial series, in which I&#39;m going to deploy Microblog to the Docker container platform.For…">
    <meta property="og:image" content="https://blog.miguelgrinberg.com/static/cards/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018.jpg">
    <meta property="og:url" content="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018">
    <meta name="twitter:title" content="The Flask Mega-Tutorial Part XIX: Deployment on Docker Containers (2018)">
    <meta name="twitter:description" content="(Great news! There is a new version of this tutorial!)This is the nineteenth installment of the Flask Mega-Tutorial series, in which I&#39;m going to deploy Microblog to the Docker container platform.For…">
    <meta name="twitter:image" content="https://blog.miguelgrinberg.com/static/cards/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@miguelgrinberg">

  </head>
  <body>
    <svg style="display: none" version="2.0">
      <defs>
        <symbol id="icon-theme-auto" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-circle-half" viewBox="0 0 16 16">
          <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16"/>
        </symbol>
        <symbol id="icon-theme-light" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-brightness-high-fill" viewBox="0 0 16 16">
          <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </symbol>
        <symbol id="icon-theme-dark" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-moon-stars-fill" viewBox="0 0 16 16">
          <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"/>
          <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
        </symbol>
      </defs>
    </svg>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="https://blog.miguelgrinberg.com/index">miguelgrinberg.com</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" aria-current="page" href="https://blog.miguelgrinberg.com/index">Home</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../my-courses-and-books.html">My Courses and Books</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../hire-me.html">Consulting</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../about-me.html">About Me</a></li>
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <svg width="20" height="20" version="2.0"><use id="current-theme" href="#icon-theme-light"></svg>
          </a>
          <ul class="dropdown-menu">
            <li>
              <a id="select-theme-light" class="dropdown-item" href="javascript:updateTheme('light')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-light"></svg>&nbsp; Light Mode
              </a>
            </li>
            <li>
              <a id="select-theme-dark" class="dropdown-item" href="javascript:updateTheme('dark')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-dark"></svg>&nbsp; Dark Mode
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a id="select-theme-auto" class="dropdown-item" href="javascript:updateTheme('auto')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-auto"></svg>&nbsp; System Default
              </a>
            </li>
          </ul>
        </li>
        
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item social-icons">
          <a type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed"><img src="../../../static/social/rss.png" alt="RSS Feed" title="RSS Feed" /></a>
          <a href="https://twitter.com/miguelgrinberg"><img src="../../../static/social/twitter.png" alt="Twitter" title="Twitter" /></a>
          <a rel="me" href="https://mstdn.social/@miguelgrinberg"><img src="../../../static/social/mastodon.png" alt="Mastodon" title="Mastodon" /></a>
          <a href="http://github.com/miguelgrinberg"><img src="../../../static/social/github.png" alt="GitHub" title="GitHub" /></a>
          <a href="https://youtube.com/miguelgrinberg"><img src="../../../static/social/youtube.png" alt="YouTube" title="YouTube" /></a>
          <a href="http://www.linkedin.com/in/miguelgrinberg"><img src="../../../static/social/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
          <a href="https://patreon.com/miguelgrinberg"><img src="../../../static/social/patreon.png" alt="Patreon" title="Patreon" /></a>
          <!--<a href="https://www.facebook.com/miguelgrinbergblog"><img src="/static/social/facebook.png" alt="Facebook" title="Facebook" /></a>-->
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row">
    <div class="col-md-8">
      <div id="main">
        
        
        
        
        

<div class="post">

<div class="post-header">
  <h1><a href="../../the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018.html">The Flask Mega-Tutorial Part XIX: Deployment on Docker Containers (2018)</a></h1>
  <h2>
    Posted by
    <form action="https://blog.miguelgrinberg.com/author/Miguel Grinberg" method="POST">
      <input type="submit" class="btn btn-danger btn-sm" value="Miguel Grinberg" />
    </form>
    on
    <button class="btn btn-secondary btn-sm" disabled><span class="flask-moment" data-timestamp="2018-04-10T17:58:26Z" data-function="format" data-format="LL" data-refresh="0" style="display: none">2018-04-10T17:58:26Z</span></button>
    under
    
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Docker" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Docker" />
      </form>
    
    
  </h2>
</div>
<div class="post-body"><p><em>(Great news! There is a <a href="../../the-flask-mega-tutorial-part-i-hello-world.html">new version of this tutorial</a>!)</em></p>
<p>This is the nineteenth installment of the Flask Mega-Tutorial series, in which I'm going to deploy Microblog to the Docker container platform.</p>
<p>For your reference, below is a list of the articles in this series.</p>
<ul>
<li><a href="../../the-flask-mega-tutorial-part-i-hello-world-2018.html">Chapter 1: Hello, World!</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ii-templates-2018.html">Chapter 2: Templates</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iii-web-forms-2018.html">Chapter 3: Web Forms</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iv-database-2018.html">Chapter 4: Database</a></li>
<li><a href="../../the-flask-mega-tutorial-part-v-user-logins-2018.html">Chapter 5: User Logins</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vi-profile-page-and-avatars-2018.html">Chapter 6: Profile Page and Avatars</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vii-error-handling-2018.html">Chapter 7: Error Handling</a></li>
<li><a href="../../the-flask-mega-tutorial-part-viii-followers-2018.html">Chapter 8: Followers</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ix-pagination-2018.html">Chapter 9: Pagination</a></li>
<li><a href="../../the-flask-mega-tutorial-part-x-email-support-2018.html">Chapter 10: Email Support</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xi-facelift-2018.html">Chapter 11: Facelift</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xii-dates-and-times-2018.html">Chapter 12: Dates and Times</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiii-i18n-and-l10n-2018.html">Chapter 13: I18n and L10n</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiv-ajax-2018.html">Chapter 14: Ajax</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xv-a-better-application-structure-2018.html">Chapter 15: A Better Application Structure</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvi-full-text-search-2018.html">Chapter 16: Full-Text Search</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-2018.html">Chapter 17: Deployment on Linux</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xviii-deployment-on-heroku-2018.html">Chapter 18: Deployment on Heroku</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018.html">Chapter 19: Deployment on Docker Containers</a> (this article)</li>
<li><a href="../../the-flask-mega-tutorial-part-xx-some-javascript-magic-2018.html">Chapter 20: Some JavaScript Magic</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xxi-user-notifications-2018.html">Chapter 21: User Notifications</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xxii-background-jobs-2018.html">Chapter 22: Background Jobs</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xxiii-application-programming-interfaces-apis-2018.html">Chapter 23: Application Programming Interfaces (APIs)</a></li>
</ul>
<p>In <a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-2018.html">Chapter 17</a> you learned about traditional deployments, in which you have to take care of every little aspect of the server configuration. Then in <a href="../../the-flask-mega-tutorial-part-xviii-deployment-on-heroku-2018.html">Chapter 18</a> I took you to the other extreme when I introduced you to Heroku, a service that takes complete control of the configuration and deployment tasks, allowing you to fully concentrate on your application. In this chapter you are going to learn about a third application deployment strategy based on <em>containers</em>, more particularly on the <a href="https://www.docker.com/">Docker</a> container platform. This third option sits somewhere in between the other two in terms of the amount of deployment work needed on your part.</p>
<p>Containers are built on a lightweight virtualization technology that allows an application, along with its dependencies and configuration to run in complete isolation, but without the need to use a full blown virtualization solution such as virtual machines, which need a lot more resources and can sometimes have a significant performance degradation in comparison to the host. A system configured as a container host can execute many containers, all of them sharing the host's kernel and direct access to the host's hardware. This is in contrast to virtual machines, which have to emulate a complete system, including CPU, disk, other hardware, kernel, etc.</p>
<p>In spite of having to share the kernel, the level of isolation in a container is pretty high. A container has its own file system, and can be based on an operating system that is different than the one used by the container host. For example, you can run containers based on Ubuntu Linux on a Fedora host, or vice versa. While containers are a technology that is native to the Linux operating system, thanks to virtualization it is also possible to run Linux containers on Windows and Mac OS X hosts. This allows you to test your deployments on your development system, and also incorporate containers in your development workflow if you wish to do so.</p>
<p><em>The GitHub links for this chapter are: <a href="https://github.com/miguelgrinberg/microblog/tree/v0.19">Browse</a>, <a href="https://github.com/miguelgrinberg/microblog-2018/archive/v0.19.zip">Zip</a>, <a href="../../../../github.com/miguelgrinberg/microblog/compare/v0.18...v0.html">Diff</a>.</em></p>
<h2>Installing Docker</h2>
<p>While Docker isn't the only container platform, it is by far the most popular, so that's going to be my choice. </p>
<p>To work with Docker, you first have to install it on your system. There are installers for Windows, Mac OS X and several Linux distributions available at the <a href="https://docs.docker.com/get-docker/">Docker website</a>. If you are working on a Microsoft Windows system, it is important to note that Docker requires Hyper-V. The installer will enable this for you if necessary, but keep in mind that enabling Hyper-V prevents other virtualization technologies such as VirtualBox from working.</p>
<p>Once Docker is installed on your system, you can verify that the install was successful by typing the following command on a terminal window or command prompt:</p>
<pre><code>$ docker version
Client:
 Cloud integration: 1.0.14
 Version:           20.10.6
 API version:       1.41
 Go version:        go1.16.3
 Git commit:        370c289
 Built:             Fri Apr  9 22:46:57 2021
 OS/Arch:           darwin/amd64
 Context:           default
 Experimental:      true

Server: Docker Engine - Community
 Engine:
  Version:          20.10.6
  API version:      1.41 (minimum version 1.12)
  Go version:       go1.13.15
  Git commit:       8728dd2
  Built:            Fri Apr  9 22:44:56 2021
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.4.4
  GitCommit:        05f951a3781f4f2c1911b05e61c160e9c30eaa8e
 runc:
  Version:          1.0.0-rc93
  GitCommit:        12644e614e25b05da6fd08a38ffa0cfe1903fdec
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
</code></pre>
<h2>Building a Container Image</h2>
<p>The first step in creating a container for Microblog is to build an <em>image</em> for it. A container image is a template that is used to create a container. It contains a complete representation of the container file system, along with various settings pertaining to networking, start up options, etc.</p>
<p>The most basic way to create a container image for your application is to start a container for the base operating system you want to use (Ubuntu, Fedora, etc.), connect to a bash shell process running in it, and then manually install your application, maybe following the guidelines I presented in <a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-2018.html">Chapter 17</a> for a traditional deployment. After you install everything, you can take a snapshot of the container and that becomes the image. This type of workflow is supported with the <code>docker</code> command, but I'm not going to discuss it because it is not convenient to have to manually install the application every time you need to generate a new image.</p>
<p>A better approach is to generate the container image through a script. The command that creates scripted container images is <code>docker build</code>. This command reads and executes build instructions from a file called <em>Dockerfile</em>, which I will need to create. The Dockerfile is basically an installer script of sorts that executes the installation steps to get the application deployed, plus some container specific settings.</p>
<p>Here is a basic <em>Dockerfile</em> for Microblog:</p>
<p class="code_title"><i>Dockerfile</i>: Dockerfile for Microblog.</p>

<pre><code>FROM python:slim

RUN useradd microblog

WORKDIR /home/microblog

COPY requirements.txt requirements.txt
RUN python -m venv venv
RUN venv/bin/pip install -r requirements.txt
RUN venv/bin/pip install gunicorn

COPY app app
COPY migrations migrations
COPY microblog.py config.py boot.sh ./
RUN chmod +x boot.sh

ENV FLASK_APP microblog.py

RUN chown -R microblog:microblog ./
USER microblog

EXPOSE 5000
ENTRYPOINT [&quot;./boot.sh&quot;]
</code></pre>
<p>Each line in the Dockerfile is a command. The <code>FROM</code> command specifies the base container image on which the new image will be built. The idea is that you start from an existing image, add or change some things, and you end up with a derived image. Images are referenced by a name and a tag, separated by a colon. The tag is used as a versioning mechanism, allowing a container image to provide more than one variant. The name of my chosen image is <code>python</code>, which is the official Docker image for Python. The tags for this image allow you to specify the interpreter version and base operating system. The <code>slim</code> tag selects a container image that has only the minimal packages required to run the Python interpreter. You can see what other tags are available for Python in the <a href="https://hub.docker.com/r/library/python/tags/">Python image repository</a>.</p>
<p>The <code>RUN</code> command executes an arbitrary command in the context of the container. This would be similar to you typing the command in a shell prompt. The <code>useradd microblog</code> command creates a new user named <code>microblog</code>. Most container images have <code>root</code> as the default user, but it is not a good practice to run an application as root, so I create my own user.</p>
<p>The <code>WORKDIR</code> command sets a default directory where the application is going to be installed. When I created the <code>microblog</code> user above, a home directory was created, so now I'm making that directory the default. The new default directory is going to apply to any remaining commands in the Dockerfile, and also later when the container is executed.</p>
<p>The <code>COPY</code> command transfers files from your machine to the container file system. This command takes two or more arguments, the source and destination files or directories. The source file(s) must be relative to the directory where the Dockerfile is located. The destination can be an absolute path, or a path relative to the directory that was set in a previous <code>WORKDIR</code> command. In this first <code>COPY</code> command, I'm copying the <em>requirements.txt</em> file to the <code>microblog</code> user's home directory in the container file system.</p>
<p>Now that I have the <em>requirements.txt</em> file in the container, I can create a virtual environment, using the <code>RUN</code> command. First I create it, and then I install all the requirements in it. Because the requirements file contains only generic dependencies, I then explicitly install <em>gunicorn</em>, which I'm going to use as a web server. Alternatively, I could have added gunicorn to my <em>requirements.txt</em> file.</p>
<p>The three <code>COPY</code> commands that follow install the application in the container, by copying the <em>app</em> package, the <em>migrations</em> directory with the database migrations, and the <em>microblog.py</em> and <em>config.py</em> scripts from the top-level directory. I'm also copying a new file, <em>boot.sh</em> that I will discuss below.</p>
<p>The <code>RUN chmod</code> command ensures that this new <em>boot.sh</em> file is correctly set as an executable file. If you are in a Unix based file system and your source file is already marked as executable, then the copied file will also have the executable bit set. I added an explicit set because on Windows it is harder to set executable bits. If you are working on Mac OS X or Linux you probably don't need this statement, but it does not hurt to have it anyway.</p>
<p>The <code>ENV</code> command sets an environment variable inside the container. I need to set <code>FLASK_APP</code>, which is required to use the <code>flask</code> command.</p>
<p>The <code>RUN chown</code> command that follows sets the owner of all the directories and files that were stored in <em>/home/microblog</em> as the new <code>microblog</code> user. Even though I created this user near the top of the Dockerfile, the default user for all the commands remained <code>root</code>, so all these files need to be switched to the <code>microblog</code> user so that this user can work with them when the container is started.</p>
<p>The <code>USER</code> command in the next line makes this new <code>microblog</code> user the default for any subsequent instructions, and also for when the container is started.</p>
<p>The <code>EXPOSE</code> command configures the port that this container will be using for its server. This is necessary so that Docker can configure the network in the container appropriately. I've chosen the standard Flask port 5000, but this can be any port.</p>
<p>Finally, the <code>ENTRYPOINT</code> command defines the default command that should be executed when the container is started. This is the command that will start the application web server. To keep things well organized, I decided to create a separate script for this, and this is the <em>boot.sh</em> file that I copied to the container earlier. Here are the contents of this script:</p>
<p class="code_title"><i>boot.sh</i>: Docker container start-up script.</p>

<pre><code>#!/bin/bash
source venv/bin/activate
flask db upgrade
flask translate compile
exec gunicorn -b :5000 --access-logfile - --error-logfile - microblog:app
</code></pre>
<p>This is a fairly standard start up script that is fairly similar to how the deployments in <a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-2018.html">Chapter 17</a> and <a href="../../the-flask-mega-tutorial-part-xviii-deployment-on-heroku-2018.html">Chapter 18</a> were started. I activate the virtual environment, upgrade the database though the migration framework, compile the language translations, and finally run the server with gunicorn.</p>
<p>Note the <code>exec</code> that precedes the gunicorn command. In a shell script, <code>exec</code> triggers the process running the script to be replaced with the command given, instead of starting it as a new process. This is important, because Docker associates the life of the container to the first process that runs on it. In cases like this one, where the start up process is not the main process of the container, you need to make sure that the main process takes the place of that first process to ensure that the container is not terminated early by Docker.</p>
<p>An interesting aspect of Docker is that anything that the container writes to <code>stdout</code> or <code>stderr</code> will be captured and stored as logs for the container. For that reason, the <code>--access-logfile</code> and <code>--error-logfile</code> are both configured with a <code>-</code>, which sends the log to standard output so that they are stored as logs by Docker.</p>
<p>With the Dockerfile created, I can now build a container image:</p>
<pre><code>$ docker build -t microblog:latest .
</code></pre>
<p>The <code>-t</code> argument that I'm giving to the <code>docker build</code> command sets the name and tag for the new container image. The <code>.</code> indicates the base directory where the container is to be built. This is the directory where the <em>Dockerfile</em> is located. The build process is going to evaluate all the commands in the <em>Dockerfile</em> and create the image, which will be stored on your own machine.</p>
<p>You can obtain a list of the images that you have locally with the <code>docker images</code> command:</p>
<pre><code>$ docker images
REPOSITORY    TAG          IMAGE ID        CREATED              SIZE
microblog     latest       03978d7e1007    27 seconds ago       283MB
python        slim         c2f204720fdd    11 days ago          115MB
</code></pre>
<p>This listing will include your new image, and also the base image on which it was built. Any time you make changes to the application, you can update the container image by running the build command again.</p>
<h2>Starting a Container</h2>
<p>With an image already created, you can now run the container version of the application. This is done with the <code>docker run</code> command, which usually takes a large number of arguments. I'm going to start by showing you a basic example:</p>
<pre><code>$ docker run --name microblog -d -p 8000:5000 --rm microblog:latest
021da2e1e0d390320248abf97dfbbe7b27c70fefed113d5a41bb67a68522e91c
</code></pre>
<p>The <code>--name</code> option provides a name for the new container. The <code>-d</code> option tells Docker to run the container in the background. Without <code>-d</code> the container runs as a foreground application, blocking your command prompt. The <code>-p</code> option maps container ports to host ports. The first port is the port on the host computer, and the one on the right is the port inside the container. The above example exposes port 5000 in the container on port 8000 in the host, so you will access the application on 8000, even though internally the container is using 5000. The <code>--rm</code> option will delete the container once it is terminated. While this isn't required, containers that finish or are interrupted are usually not needed anymore, so they can be automatically deleted. The last argument is the container image name and tag to use for the container. After you run the above command, you can access the application at <em>http://localhost:8000</em>.</p>
<p>The output of <code>docker run</code> is the ID assigned to the new container. This is a long hexadecimal string, that you can use whenever you need to refer to the container in subsequent commands. In fact, only the first few characters are necessary, enough to make the ID unique.</p>
<p>If you want to see what containers are running, you can use the <code>docker ps</code> command:</p>
<pre><code>$ docker ps
CONTAINER ID  IMAGE             COMMAND      PORTS                   NAMES
021da2e1e0d3  microblog:latest  &quot;./boot.sh&quot;  0.0.0.0:8000-&gt;5000/tcp  microblog
</code></pre>
<p>You can see that even the <code>docker ps</code> command shortens container IDs. If you now want to stop the container, you can use <code>docker stop</code>:</p>
<pre><code>$ docker stop 021da2e1e0d3
021da2e1e0d3
</code></pre>
<p>If you recall, there are a number of options in the application's configuration that are sourced from environment variables. For example, the Flask secret key, database URL and email server options are all imported from environment variables. In the <code>docker run</code> example above I have not worried about those, so all those configuration options are going to use defaults.</p>
<p>In a more realistic example, you will be setting those environment variables inside the container. You saw in the previous section that the <code>ENV</code> command in the <em>Dockerfile</em> sets environment variables, and it is a handy option for variables that are going to be static. For variables that depend on the installation, however, it isn't convenient to have them as part of the build process, because you want to have a container image that is fairly portable. If you want to give your application to another person as a container image, you would want that person to be able to use it as is, and not have to rebuild it with different variables.</p>
<p>So build-time environment variables can be useful, but there is also a need to have run-time environment variables that can be set via the <code>docker run</code> command, and for these variables, the <code>-e</code> option can be used. The following example sets a secret key and sends email through a gmail account:</p>
<pre><code>$ docker run --name microblog -d -p 8000:5000 --rm -e SECRET_KEY=my-secret-key \
    -e MAIL_SERVER=smtp.googlemail.com -e MAIL_PORT=587 -e MAIL_USE_TLS=true \
    -e MAIL_USERNAME=&lt;your-gmail-username&gt; -e MAIL_PASSWORD=&lt;your-gmail-password&gt; \
    microblog:latest
</code></pre>
<p>It is not uncommon for <code>docker run</code> command lines to be extremely long due to having many environment variable definitions.</p>
<h2>Using Third-Party "Containerized" Services</h2>
<p>The container version of Microblog is looking good, but I haven't really thought much about storage yet. In fact, since I haven't set a <code>DATABASE_URL</code> environment variable, the application is using the default SQLite database, which is supported by a file on disk. What do you think is going to happen to that SQLite file when you stop and delete the container? The file is going to disappear!</p>
<p>The file system in a container is <em>ephemeral</em>, meaning that it goes away when the container goes away. You can write data to the file system, and the data is going to be there if the container needs to read it, but if for any reason you need to recycle your container and replace it with a new one, any data that the application saved to disk is going to be lost forever.</p>
<p>A good design strategy for a container application is to make the application containers <em>stateless</em>. If you have a container that has application code and no data, you can throw it away and replace it with a new one without any problems, the container becomes truly disposable, which is great in terms of simplifying the deployment of upgrades.</p>
<p>But of course, this means that the data must be put somewhere outside of the application container. This is where the fantastic Docker ecosystem comes into play. The Docker Container Registry contains a large variety of container images. I have already told you about the Python container image, which I'm using as a base image for my Microblog container. In addition to that, Docker maintains images for many other languages, databases and other services in the Docker registry and if that isn't enough, the registry also allows companies to publish container images for their products, and also regular users like you or me to publish your own images. That means that the effort to install third party services is reduced to finding an appropriate image in the registry, and starting it with a <code>docker run</code> command with proper arguments.</p>
<p>So what I'm going to do now is create two additional containers, one for a MySQL database, and another one for the Elasticsearch service, and then I'm going to make the command line that starts the Microblog container even longer with options that enable it to access these two new containers.</p>
<h3>Adding a MySQL Container</h3>
<p>Like many other products and services, MySQL has public container images available on the Docker registry. Like my own Microblog container, MySQL relies on environment variables that need to be passed to <code>docker run</code>. These configure passwords, database names etc. While there are many MySQL images in the registry, I decided to use one that is officially maintained by the MySQL team. You can find detailed information about the MySQL container image in its registry page: <em>https://hub.docker.com/r/mysql/mysql-server/</em>.</p>
<p>If you remember the laborious process to set up MySQL in <a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-2018.html">Chapter 17</a>, you are going to appreciate Docker when you see how easy it is to deploy MySQL. Here is the <code>docker run</code> command that starts a MySQL server:</p>
<pre><code>$ docker run --name mysql -d -e MYSQL_RANDOM_ROOT_PASSWORD=yes \
    -e MYSQL_DATABASE=microblog -e MYSQL_USER=microblog \
    -e MYSQL_PASSWORD=&lt;database-password&gt; \
    mysql/mysql-server:latest
</code></pre>
<p>That is it! On any machine that you have Docker installed, you can run the above command and you'll get a fully installed MySQL server with a randomly generated root password, a brand new database called <code>microblog</code>, and a user with the same name that is configured with full permissions to access the database. Note that you will need to enter a proper password as the value for the <code>MYSQL_PASSWORD</code> environment variable.</p>
<p>Now on the application side, I need to add a MySQL client package, like I did for the traditional deployment on Ubuntu. I'm going to use <code>pymysql</code> once again, which I can add to the <em>Dockerfile</em>, along with the <code>cryptography</code> package that it uses for authentication against the MySQL server:</p>
<p class="code_title"><i>Dockerfile</i>: Add pymysql and cryptography to Dockerfile.</p>

<pre><code># ...
RUN venv/bin/pip install gunicorn pymysql cryptography
# ...
</code></pre>
<p>Any time a change is made to the application or the <em>Dockerfile</em>, the container image needs to be rebuilt:</p>
<pre><code>$ docker build -t microblog:latest .
</code></pre>
<p>Any now I can start Microblog again, but this time with a link to the database container so that both can communicate through the network:</p>
<pre><code>$ docker run --name microblog -d -p 8000:5000 --rm -e SECRET_KEY=my-secret-key \
    -e MAIL_SERVER=smtp.googlemail.com -e MAIL_PORT=587 -e MAIL_USE_TLS=true \
    -e MAIL_USERNAME=&lt;your-gmail-username&gt; -e MAIL_PASSWORD=&lt;your-gmail-password&gt; \
    --link mysql:dbserver \
    -e DATABASE_URL=mysql+pymysql://microblog:&lt;database-password&gt;@dbserver/microblog \
    microblog:latest
</code></pre>
<p>The <code>--link</code> option tells Docker to make another container accessible to this one. The argument contains two names separated by a colon. The first part is the name or ID of the container to link, in this case the one named <code>mysql</code> that I created above. The second part defines a hostname that can be used in this container to refer to the linked one. Here I'm using <code>dbserver</code> as generic name that represents the database server.</p>
<p>With the link between the two containers established, I can set the <code>DATABASE_URL</code> environment variable so that SQLAlchemy is directed to use the MySQL database in the other container. The database URL is going to use <code>dbserver</code> as the database hostname, <code>microblog</code> as the database name and user, and the password that you selected when you started MySQL.</p>
<p>One thing I noticed when I was experimenting with the MySQL container is that it takes a few seconds for this container to be fully running and ready to accept database connections. If you start the MySQL container and then start the application container immediately after, when the <em>boot.sh</em> script tries to run <code>flask db upgrade</code> it may fail due to the database not being ready to accept connections. To make my solution more robust, I decided to add a retry loop in <em>boot.sh</em>:</p>
<p class="code_title"><i>boot.sh</i>: Retry database connection.</p>

<pre><code>#!/bin/bash
source venv/bin/activate
while true; do
    flask db upgrade
    if [[ &quot;$?&quot; == &quot;0&quot; ]]; then
        break
    fi
    echo Upgrade command failed, retrying in 5 secs...
    sleep 5
done
flask translate compile
exec gunicorn -b :5000 --access-logfile - --error-logfile - microblog:app
</code></pre>
<p>This loop checks the exit code of the <code>flask db upgrade</code> command, and if it is non-zero it assumes that something went wrong, so it waits five seconds and then retries.</p>
<h3>Adding a Elasticsearch Container</h3>
<p>The <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html">Elasticsearch documentation for Docker</a> shows how to run the service as a single-node for development, and as a two-node production-ready deployment. For now I'm going to go with the single-node option and use the "oss" image, which only has the open source engine. The container is started with the following command:</p>
<pre><code>$ docker run --name elasticsearch -d -p 9200:9200 -p 9300:9300 --rm \
    -e &quot;discovery.type=single-node&quot; \
    docker.elastic.co/elasticsearch/elasticsearch-oss:7.10.2
</code></pre>
<p>This <code>docker run</code> command has many similarities with the ones I've used for Microblog and MySQL, but there are a couple of interesting differences. First, there are two <code>-p</code> options, which means that this container is going to listen on two ports instead of just one. Both ports 9200 and 9300 are mapped to the same ports in the host machine.</p>
<p>The other difference is in the syntax used to refer to the container image. For the images that I've been building locally, the syntax was <code>&lt;name&gt;:&lt;tag&gt;</code>. The MySQL container uses a slightly more complete syntax with the format <code>&lt;account&gt;/&lt;name&gt;:&lt;tag&gt;</code>, which is appropriate to reference container images on the Docker registry. The Elasticsearch image that I'm using follows the pattern <code>&lt;registry&gt;/&lt;account&gt;/&lt;name&gt;:&lt;tag&gt;</code>, which includes the address of the registry as the first component. This syntax is used for images that are not hosted in the Docker registry. In this case Elasticsearch runs their own container registry service at <em>docker.elastic.co</em> instead of using the main registry maintained by Docker.</p>
<p>So now that I have the Elasticsearch service up and running, I can modify the start command for my Microblog container to create a link to it and set the Elasticsearch service URL:</p>
<pre><code>$ docker run --name microblog -d -p 8000:5000 --rm -e SECRET_KEY=my-secret-key \
    -e MAIL_SERVER=smtp.googlemail.com -e MAIL_PORT=587 -e MAIL_USE_TLS=true \
    -e MAIL_USERNAME=&lt;your-gmail-username&gt; -e MAIL_PASSWORD=&lt;your-gmail-password&gt; \
    --link mysql:dbserver \
    -e DATABASE_URL=mysql+pymysql://microblog:&lt;database-password&gt;@dbserver/microblog \
    --link elasticsearch:elasticsearch \
    -e ELASTICSEARCH_URL=http://elasticsearch:9200 \
    microblog:latest
</code></pre>
<p>Before you run this command, remember to stop your previous Microblog container if you still have it running. Also be careful in setting the correct passwords for the database and the Elasticsearch service in the proper places in the command.</p>
<p>Now you should be able to visit <em>http://localhost:8000</em> and use the search feature. If you experience any errors, you can troubleshoot them by looking at the container logs. You'll most likely want to see logs for the Microblog container, where any Python stack traces will appear:</p>
<pre><code>$ docker logs microblog
</code></pre>
<h2>The Docker Container Registry</h2>
<p>So now I have the complete application up and running on Docker, using three containers, two of which come from publicly available third-party images. If you would like to make your own container images available to others, then you have to <em>push</em> them to the Docker registry from where anybody can obtain images.</p>
<p>To have access to the Docker registry you need to go to <em>https://hub.docker.com</em> and create an account for yourself. Make sure you pick a username that you like, because that is going to be used in all the images that you publish.</p>
<p>To be able to access your account from the command line, you need to log in with the <code>docker login</code> command:</p>
<pre><code>$ docker login
</code></pre>
<p>If you've been following my instructions, you now have an image called <code>microblog:latest</code> stored locally on your computer. To be able to push this image to the Docker registry, it needs to be renamed to include the account, like the image from MySQL. This is done with the <code>docker tag</code> command:</p>
<pre><code>$ docker tag microblog:latest &lt;your-docker-registry-account&gt;/microblog:latest
</code></pre>
<p>If you list your images again with <code>docker images</code> you are now going to see two entries for Microblog, the original one with the <code>microblog:latest</code> name, and a new one that also includes your account name. These are really two alias for the same image.</p>
<p>To publish your image to the Docker registry, use the <code>docker push</code> command:</p>
<pre><code>$ docker push &lt;your-docker-registry-account&gt;/microblog:latest
</code></pre>
<p>Now your image is publicly available and you can document how to install it and run from the Docker registry in the same way MySQL and others do.</p>
<h2>Deployment of Containerized Applications</h2>
<p>One of the best things about having your application running in Docker containers is that once you have the containers tested locally, you can take them to any platform that offers Docker support. For example, you could use the same servers I recommended in <a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-2018.html">Chapter 17</a> from Digital Ocean, Linode or Amazon Lightsail. Even the cheapest offering from these providers is sufficient to run Docker with a handful of containers.</p>
<p>The <a href="https://aws.amazon.com/ecs/">Amazon Container Service (ECS)</a> gives you the ability to create a cluster of container hosts on which to run your containers, in a fully integrated AWS environment, with support for scaling and load balancing, plus the option to use a private container registry for your container images.</p>
<p>Finally, a container orchestration platform such as <a href="https://kubernetes.io/">Kubernetes</a> provides an even greater level of automation and convenience, by allowing you to describe your multi-container deployments in simple text files in YAML format, with load balancing, scaling, secure management of secrets and rolling upgrades and rollbacks.</p></div>

<div class="card patreon-bar">
  <div class="card-body">
    <h5>Become a Patron!</h5>
    <p class="card-text">Hello, and thank you for visiting my blog! If you enjoyed this article, please consider supporting my work on this blog on <a href="https://patreon.com/miguelgrinberg">Patreon</a>!</p>
    <a href="https://patreon.com/miguelgrinberg" alt="Become a Patron!" title="Become a Patron!"><img src="../../../static/patreon-button.png"></a>
  </div>
</div>


<div class="card social-bar">
  <div class="card-body">
    <h5>Share this post:</h5>
      <!-- Sharingbutton Hacker News -->
      <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018&amp;t=The%20Flask%20Mega-Tutorial%20Part%20XIX%3A%20Deployment%20on%20Docker%20Containers%20%282018%29" target="_blank" rel="noopener" aria-label="Hacker News">
        <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg></div>Hacker News</div>
      </a>

      <!-- Sharingbutton Reddit -->
      <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018&amp;resubmit=true&amp;title=The%20Flask%20Mega-Tutorial%20Part%20XIX:%20Deployment%20on%20Docker%20Containers%20(2018)" target="_blank" rel="noopener" aria-label="Reddit">
        <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div>Reddit</div>
      </a>

      <!-- Sharingbutton Twitter -->
      <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=The%20Flask%20Mega-Tutorial%20Part%20XIX%3A%20Deployment%20on%20Docker%20Containers%20%282018%29&amp;url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018" target="_blank" rel="noopener" aria-label="Twitter">
        <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div>Twitter</div>
      </a>

      <!-- Sharingbutton LinkedIn -->
      <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018&amp;title=The%20Flask%20Mega-Tutorial%20Part%20XIX%3A%20Deployment%20on%20Docker%20Containers%20%282018%29&amp;summary=The%20Flask%20Mega-Tutorial%20Part%20XIX%3A%20Deployment%20on%20Docker%20Containers%20%282018%29&amp;source=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018" target="_blank" rel="noopener" aria-label="LinkedIn">
        <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div>LinkedIn</div>
      </a>

      <!-- Sharingbutton Facebook -->
      <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018" target="_blank" rel="noopener" aria-label="Facebook">
        <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div>Facebook</div>
      </a>

      <!-- Sharingbutton E-Mail -->
      <a class="resp-sharing-button__link" href="mailto:?subject=The%20Flask%20Mega-Tutorial%20Part%20XIX%3A%20Deployment%20on%20Docker%20Containers%20%282018%29&amp;body=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018" target="_self" rel="noopener" aria-label="E-Mail">
        <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div>E-Mail</div>
      </a>

  </div>
</div>

<div id="comments" class="post-comment-count">
  
  <a class="btn btn-outline-secondary" href="../../the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018.html#comments">224 comments</a>
  
</div>


<div class="comments">
  <ul>
    
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#151</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-08-30T15:45:31Z" data-function="fromNow" data-refresh="0" style="display: none">2020-08-30T15:45:31Z</span>
  </p>
  <div>
    <p>@Lauren: What I usually do to load initial data is to define a flask CLI command to do this. It would be the same actions you have been doing manually, but having them in a command is more convenient as they are easy to repeat.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/fe93f7f9e22b8ed5d0d775beee498c18?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#152</span> <span class="badge text-bg-warning">Kieron Spearing</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-10T11:29:08Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-10T11:29:08Z</span>
  </p>
  <div>
    <p>Hi Miguel</p>
<p>During the docker build -t microblog:latest .</p>
<p>Command I came across this error:</p>
<pre><code>writing manifest file 'pip-egg-info/psycopg2.egg-info/SOURCES.txt'

Error: pg_config executable not found.

pg_config is required to build psycopg2 from source.  Please add the directory
containing pg_config to the $PATH or specify the full executable path with the
option:

    python <a href="http://setup.py/" rel="nofollow">setup.py</a> build_ext --pg-config /path/to/pg_config build ...

or with the pg_config option in 'setup.cfg'.

If you prefer to avoid building psycopg2 from source, please install the PyPI
'psycopg2-binary' package instead.

For further information please check the 'doc/src/install.rst' file (also at
&lt;<a href="https://www.psycopg.org/docs/install.html>" rel="nofollow">https://www.psycopg.org/docs/install.html&gt;</a>).


----------------------------------------
</code></pre>
<p>Command "python <a href="http://setup.py/" rel="nofollow">setup.py</a> egg_info" failed with error code 1 in /tmp/pip-install-chd2gfk3/psycopg2/<br>
You are using pip version 18.1, however version 20.2.3 is available.<br>
You should consider upgrading via the 'pip install --upgrade pip' command.<br>
The command '/bin/sh -c venv/bin/pip install -r requirements.txt' returned a non-zero code: 1</p>
<p>Obviously the pip warning I am not to worried about, however after looking through previous problems and googling a bit I found that modifying the Dockerfile like this to be a solution:</p>
<p>FROM python:3.6-alpine</p>
<p>RUN adduser -D microblog</p>
<p>WORKDIR /home/Mega</p>
<p>COPY requirements.txt requirements.txt<br>
RUN python -m venv venv<br>
RUN apk add --no-cache postgresql-libs<br>
RUN apk add --no-cache --virtual .build-deps gcc musl-dev postgresql-dev<br>
RUN apk add --no-cache --virtual .pynacl_deps build-base python3-dev libffi-dev<br>
RUN venv/bin/pip install -r requirements.txt<br>
RUN venv/bin/pip install gunicorn<br>
RUN apk --purge del .build-deps</p>
<p>COPY app app<br>
COPY migrations migrations<br>
COPY <a href="http://microblog.py/" rel="nofollow">microblog.py</a> <a href="http://config.py/" rel="nofollow">config.py</a> <a href="http://boot.sh/" rel="nofollow">boot.sh</a> ./<br>
RUN chmod +x <a href="http://boot.sh/" rel="nofollow">boot.sh</a></p>
<p>ENV FLASK_APP <a href="http://microblog.py/" rel="nofollow">microblog.py</a></p>
<p>RUN chown -R microblog:microblog ./<br>
USER microblog</p>
<p>EXPOSE 5000<br>
ENTRYPOINT ["./<a href="http://boot.sh/" rel="nofollow">boot.sh</a>"]</p>
<p>Obviously this works, but I feel there may be a better way so my question is:</p>
<p>Is this a good solution and is there a better one? How would you go around getting a better solution for this?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#153</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-10T14:11:24Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-10T14:11:24Z</span>
  </p>
  <div>
    <p>@Kieron: just to be clear, you are using Postgres, while this tutorial uses MySQL in the Docker deployment. If it is all the same to you, switching to MySQL will address this issue. The Postgres driver is written in C so it needs to be compiled. You can try using the <code>psycopg2-binary</code> package instead, which is a compiled version, but that may not work in the alpine image.</p>
<p>The solution that you used is not ideal, because you are installing a lot of dependencies that are only needed to compile psycopg2, but they are inflating the size of your image considerably. There is a way to avoid the extra size by using a "multistage" build. I've found a tutorial that shows how to do this with Postgres here: <a href="https://www.rockyourcode.com/create-a-multi-stage-docker-build-for-python-flask-and-postgres/" rel="nofollow">https://www.rockyourcode.com/create-a-multi-stage-docker-build-for-python-flask-and-postgres/</a>.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/fe93f7f9e22b8ed5d0d775beee498c18?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#154</span> <span class="badge text-bg-warning">Kieron Spearing</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-10T18:32:22Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-10T18:32:22Z</span>
  </p>
  <div>
    <p>I will switch to mysql but thank you for the tutorial i am going to look into it more to learn other ways</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/0b3caa32476652121d14d4b081deef20?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#155</span> <span class="badge text-bg-warning">Hyun Soo Jeon</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-11T02:42:13Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-11T02:42:13Z</span>
  </p>
  <div>
    <p>Hi Miguel! Let me start with a BIG thank you always. You mentioned "A good design strategy for a container application is to make the application containers stateless". I am curious to know whether Microblog is considered a stateful application or a stateless application. I am a beginner in web development and although I have read on the internet the distinctions between them, it's always kind of hard for me to tell. Since Microblog relies on Flask's user session instead of web tokens, is it considered a stateful application? Please kindly correct me if I am wrong. Thank you!</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#156</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-11T13:57:48Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-11T13:57:48Z</span>
  </p>
  <div>
    <p>@Hyun: All applications need to maintain some state, in one way or another. In the context of this topic, when I say that the container should be "stateless" I mean that no data should be stored inside the container itself. The point of this is that you can destroy a container and stand up a new one without having to worry about saving or restoring data that the application needs.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/0b3caa32476652121d14d4b081deef20?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#157</span> <span class="badge text-bg-warning">Hyun</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-12T16:31:01Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-12T16:31:01Z</span>
  </p>
  <div>
    <p>@Miguel Oh I see that makes perfect sense! Thank you very much for your explanation. What we are at it, I have one more question on Flask's user session. If I deploy Microblog, for example, in Kubernetes with 3 replicas, and a user connects to Replica 1 where his/her session will be stored. But if somehow Replica 1 goes down and gets replaced with a new one or simply the connection switches to Replica 2. Does that mean the user will be logged out and asked to log in again? I wanted to try it myself and see but I am a little stuck on some other stuff with Kubernetes</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#158</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-13T09:14:02Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-13T09:14:02Z</span>
  </p>
  <div>
    <p>@Hyun: Flask does not store sessions in the server. Sessions are stored in cookies, so they follow the client regardless of the replica that handles the request.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/fe93f7f9e22b8ed5d0d775beee498c18?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#159</span> <span class="badge text-bg-warning">Kieron Spearing</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-14T15:16:08Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-14T15:16:08Z</span>
  </p>
  <div>
    <p>Hey Miguel</p>
<p>When following through all of this and getting the containers up and running I am finding myself with the following error:</p>
<p>[2020-09-14 15:09:46,197] INFO in <strong>init</strong>: Microblog startup<br>
INFO  [alembic.runtime.migration] Context impl MySQLImpl.<br>
INFO  [alembic.runtime.migration] Will assume non-transactional DDL.<br>
INFO  [alembic.runtime.migration] Running upgrade 2ef5f59404c4 -&gt; e77bb98e1d6c, after tests<br>
Traceback (most recent call last):<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/sqlalchemy/engine/<a href="http://base.py/" rel="nofollow">base.py</a>", line 1278, in _execute_context<br>
    cursor, statement, parameters, context<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/sqlalchemy/engine/<a href="http://default.py/" rel="nofollow">default.py</a>", line 593, in do_execute<br>
    cursor.execute(statement, parameters)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://cursors.py/" rel="nofollow">cursors.py</a>", line 163, in execute<br>
    result = self._query(query)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://cursors.py/" rel="nofollow">cursors.py</a>", line 321, in _query<br>
    conn.query(q)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 505, in query<br>
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 724, in _read_query_result<br>
    result.read()<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 1069, in read<br>
    first_packet = self.connection._read_packet()<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 676, in _read_packet<br>
    packet.raise_for_error()<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://protocol.py/" rel="nofollow">protocol.py</a>", line 223, in raise_for_error<br>
    err.raise_mysql_exception(self._data)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://err.py/" rel="nofollow">err.py</a>", line 107, in raise_mysql_exception<br>
    raise errorclass(errno, errval)<br>
pymysql.err.OperationalError: (1050, "Table 'user' already exists")</p>
<p>Which seems to indicate the database isn't clear before starting, however how would I go about sorting this out so that I could have a clear image and wouldn't this become a problem for future edits to the docker image when starting up? </p>
<p>Obviously I don't plan to push this to docker container registry as I have been following this tutorial very closely and it is your site I am working with here but just curious for future projects when having this error how do you go about fixing it?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#160</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-14T20:09:54Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-14T20:09:54Z</span>
  </p>
  <div>
    <p>@Kieron: Your database files are not stored in a container, they are stored in a Docker volume. You probably have one from a previous test. You need to delete all the tables in this database, or else delete the volume and restart the mysql container so that it creates a brand new one.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/fe93f7f9e22b8ed5d0d775beee498c18?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#161</span> <span class="badge text-bg-warning">Kieron Spearing</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-15T05:21:58Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-15T05:21:58Z</span>
  </p>
  <div>
    <p>Hi Miguel </p>
<p>I have followed the following steps:<br>
I removed all containers, volumes and images and then restarted it all from the beginning and I found the same problem happening , so then I went again and removed the containers once more along with the volume.</p>
<p>When restarting it all I found the following and I am unsure if you can help me clarify what is happening here.<br>
in the docker logs microblog I had the following at first:</p>
<p>File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 327, in <strong>init</strong><br>
    self.connect()<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 619, in connect<br>
    raise exc<br>
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2003, "Can't connect to MySQL server on 'dbserver' ([Errno 111] Connection refused)")<br>
(Background on this error at: <a href="http://sqlalche.me/e/13/e3q8" rel="nofollow">http://sqlalche.me/e/13/e3q8</a>)<br>
sh: missing ]]</p>
<p>After letting it retry with the loop in the <a href="http://boot.sh/" rel="nofollow">boot.sh</a> it came with this:</p>
<p>INFO  [alembic.runtime.migration] Context impl MySQLImpl.<br>
INFO  [alembic.runtime.migration] Will assume non-transactional DDL.<br>
INFO  [alembic.runtime.migration] Running upgrade  -&gt; 1e9d19f0a0db, users table<br>
INFO  [alembic.runtime.migration] Running upgrade 1e9d19f0a0db -&gt; ebf69dfcd48b, posts table<br>
INFO  [alembic.runtime.migration] Running upgrade ebf69dfcd48b -&gt; a341411ee845, new fields in user model<br>
INFO  [alembic.runtime.migration] Running upgrade a341411ee845 -&gt; 2ef5f59404c4, followers<br>
INFO  [alembic.runtime.migration] Running upgrade 2ef5f59404c4 -&gt; e77bb98e1d6c, after tests<br>
Traceback (most recent call last):<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/sqlalchemy/engine/<a href="http://base.py/" rel="nofollow">base.py</a>", line 1278, in _execute_context<br>
    cursor, statement, parameters, context<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/sqlalchemy/engine/<a href="http://default.py/" rel="nofollow">default.py</a>", line 593, in do_execute<br>
    cursor.execute(statement, parameters)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://cursors.py/" rel="nofollow">cursors.py</a>", line 163, in execute<br>
    result = self._query(query)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://cursors.py/" rel="nofollow">cursors.py</a>", line 321, in _query<br>
    conn.query(q)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 505, in query<br>
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 724, in _read_query_result<br>
    result.read()<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 1069, in read<br>
    first_packet = self.connection._read_packet()<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://connections.py/" rel="nofollow">connections.py</a>", line 676, in _read_packet<br>
    packet.raise_for_error()<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://protocol.py/" rel="nofollow">protocol.py</a>", line 223, in raise_for_error<br>
    err.raise_mysql_exception(self._data)<br>
  File "/home/Mega/venv/lib/python3.6/site-packages/pymysql/<a href="http://err.py/" rel="nofollow">err.py</a>", line 107, in raise_mysql_exception<br>
    raise errorclass(errno, errval)<br>
pymysql.err.OperationalError: (1050, "Table 'user' already exists")</p>
<p>This has got me thinking that maybe the problem lies in how i have the migrations through the problem? I have run into this create table error twice before, however I am unsure how to fix this issue? Do you have any idea why it would be behaving this way?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#162</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-15T08:59:38Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-15T08:59:38Z</span>
  </p>
  <div>
    <p>@Kieron: now that I think about it, yes, it seems your migration <code>e77bb98e1d6c</code> is trying to create a table that was already created in a previous migration, so you seem to have a bad migration in your repository.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/fe93f7f9e22b8ed5d0d775beee498c18?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#163</span> <span class="badge text-bg-warning">Kieron Spearing</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-15T12:55:13Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-15T12:55:13Z</span>
  </p>
  <div>
    <p>Are you able to clear the bad migration or start a new migration? won't do it for this but would like to know for future projects working with migrate?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#164</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-09-15T14:12:18Z" data-function="fromNow" data-refresh="0" style="display: none">2020-09-15T14:12:18Z</span>
  </p>
  <div>
    <p>@Kieron: migration scripts are Python code. You can open them in your editor and fix them.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/aa4d7225b5276efcfbbf556ff1b5676f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#165</span> <span class="badge text-bg-warning">Gitau Harrison</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-26T15:28:19Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-26T15:28:19Z</span>
  </p>
  <div>
    <p>I am trying to run my docker container and access it on localhost:8000 without success. I have the image created but the <code>docker run</code> command does not create the container. This is what I have done:</p>
<p><code>Dockerfile:</code></p>
<pre><code>FROM python:3.8-alpine

RUN adduser -D practice_blog

WORKDIR /home/gitau/software_development/python/flask_tutorial/practice_blog

COPY requirements.txt requirements.txt
RUN python3 -m venv practice_blog
# Upgrade pip below
RUN practice_blog/bin/python3 -m pip install --upgrade pip
RUN practice_blog/bin/pip3 install -r requirements.txt
RUN practice_blog/bin/pip3 install gunicorn

COPY app app
COPY migrations migrations
COPY <a href="http://practice_blog.py/" rel="nofollow">practice_blog.py</a> <a href="http://config.py/" rel="nofollow">config.py</a> <a href="http://boot.sh/" rel="nofollow">boot.sh</a> ./
RUN chmod +x <a href="http://boot.sh/" rel="nofollow">boot.sh</a>

ENV FLASK_APP <a href="http://practice_blog.py/" rel="nofollow">practice_blog.py</a>

RUN chown -R practice_blog:practice_blog ./
USER practice_blog

EXPOSE 5000
ENTRYPOINT ['./<a href="http://boot.sh/" rel="nofollow">boot.sh</a>']
</code></pre>
<p><code><a href="http://boot.sh/" rel="nofollow">boot.sh</a></code></p>
<pre><code>!/bin/sh
source practice_blog/bin/activate
flask db upgrade
flask translate compile
exec gunicorn -b :5000 --access-logfile - --error-logfile - practice_blog:app
</code></pre>
<p>Question 1:<br>
What could be my issue?</p>
<p>Question 2:<br>
I have removed the <code>#</code> in the shebang in an attempted to load the <code><a href="http://boot.sh/" rel="nofollow">boot.sh</a></code> file as an executable (even though there is the command <code>exec</code>). Is this necessary? Because as you state, the <code>exec</code> triggers the process running the script to be replaced with the command given, instead of starting it as a new process in a shell script.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#166</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-26T15:45:47Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-26T15:45:47Z</span>
  </p>
  <div>
    <p>@Gitau: if Docker fails to create the container, then there must be logs that tell you what happened. Try <code>docker logs &lt;container-name&gt;</code> after the container failed to create. The "#" in the shebang line of a script is not supposed to be removed, that needs to stay there always.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/aa4d7225b5276efcfbbf556ff1b5676f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#167</span> <span class="badge text-bg-warning">Gitau Harrison</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-26T16:40:36Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-26T16:40:36Z</span>
  </p>
  <div>
    <p>Running <code>docker ps</code> shows no container or the container id.  <code>docker ps -a</code> in my machine shows only the default hello-world container. If I try to run <code>docker logs &lt;container_name&gt;</code>, I do not have the container name to use. </p>
<p>The thing is <code>$ docker run --name practice_blog -d -p 8000:5000 --rm practice_blog:latest</code> successfully creates an id such as this <code>021da2e1e0d390320248abf97dfbbe7b27c70fefed113d5a41bb67a68522e91c</code>. But I cannot see the container when <code>docker ps</code> is run, and therefore, there localhost:8000 refuses to connect.</p>
<p>This is my issue. I am wondering, if I have successfully created an image and even built it to the point where I get a container id, why can't I see <code>practice_blog</code> container?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#168</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-26T19:25:39Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-26T19:25:39Z</span>
  </p>
  <div>
    <p>@Gitau: The <code>--rm</code> is telling docker to delete the container when it ends, successful or not. Remove that option so that you can then look at the container logs and see what failed.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/aa4d7225b5276efcfbbf556ff1b5676f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#169</span> <span class="badge text-bg-warning">Gitau Harrison</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-27T05:23:30Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-27T05:23:30Z</span>
  </p>
  <div>
    <p>Getting rid of <code>--rm</code> solves the container creation problem.</p>
<p><code>docker ps -a</code> shows that the process was exited as soon as it was created</p>
<pre><code>CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS                        PORTS               NAMES
c3cf42ebbc27        practice_blog:latest   &quot;/bin/sh -c ['./boot…&quot;   28 seconds ago      Exited (127) 27 seconds ago                       practice_blog
</code></pre>
<p>And the error from <code>docker logs &lt;CONTAINER ID&gt;</code> indicate that <code>/bin/sh: [./<a href="http://boot.sh/" rel="nofollow">boot.sh</a>]: not found</code></p>
<p>I think that the reason why <code>docker run --name practice_blog -d -p 8000:5000 --rm practice_blog:latest</code> failed to create a container is because the <code><a href="http://boot.sh/" rel="nofollow">boot.sh</a></code> file could not be found. </p>
<p>I have pruned my system of dangling images and containers and redid the <code>build</code> and <code>run</code> commands successfully.</p>
<pre><code>CONTAINER ID        IMAGE                  COMMAND             CREATED             STATUS              PORTS                    NAMES
da8d6da1c4f1        practice_blog:latest   &quot;./<a href="http://boot.sh/" rel="nofollow">boot.sh</a>&quot;         15 seconds ago      Up 14 seconds       0.0.0.0:8000-&gt;5000/tcp   practice_blog
</code></pre>
<p>localhost:8000 works!</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/aa4d7225b5276efcfbbf556ff1b5676f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#170</span> <span class="badge text-bg-warning">Gitau Harrison</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-29T12:39:34Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-29T12:39:34Z</span>
  </p>
  <div>
    <p>The <code>for</code> loop inside the <code><a href="http://boot.sh/" rel="nofollow">boot.sh</a></code> file exits with a non-zero digit and therefore keeps on retrying. This is the error message I am getting:</p>
<pre><code>spec.loader.exec_module(module)
  File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 783, in exec_module
  File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 219, in _call_with_frames_removed
  File &quot;migrations/<a href="http://env.py/" rel="nofollow">env.py</a>&quot;, line 27, in &lt;module&gt;
    str(current_app.extensions['migrate'].db.engine.url).replace('%', '%%'))
AttributeError: 'NoneType' object has no attribute 'engine'
Upgrade command failed, retrying in 5 secs...
</code></pre>
<p>I do not understand what I can do at this point. What does it mean that I do not have the attribute <code>engine</code>? Vaguely I understand that the <code>flask db upgrade</code> command failed.</p>
<p>Notably, I have not started the mysql container and application container at the same or almost the same time. What can I do to fix this? Because at this point, the localhost:8000 site cannot be reached.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#171</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-29T14:05:32Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-29T14:05:32Z</span>
  </p>
  <div>
    <p>@Gitau: the error is not about <code>engine</code>, the important part is that the object on which this <code>engine</code> attribute is obtained is <code>None</code>. This is the <code>db</code> attribute of the Flask-Migrate extension. That means that you did not properly initialize the Flask-Migrate extension, so it does not know what the database is.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/aa4d7225b5276efcfbbf556ff1b5676f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#172</span> <span class="badge text-bg-warning">Gitau Harrison</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-29T16:11:51Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-29T16:11:51Z</span>
  </p>
  <div>
    <p>After linking the <code>mysql</code> server to the application container, should be able to send data on the application, like logging in? What I am getting with such attempts is <code>localhost didn't send any data</code>. I have been able to get localhost:8000 to continue working after linking it to <code>mysql</code>.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#173</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-29T23:31:26Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-29T23:31:26Z</span>
  </p>
  <div>
    <p>@Gitau: I'm not familiar with the "localhost didn't send any data" error. Where does it appear? Who is producing it? Any stack traces that can provide more context?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/aa4d7225b5276efcfbbf556ff1b5676f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#174</span> <span class="badge text-bg-warning">Gitau Harrison</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-30T05:45:03Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-30T05:45:03Z</span>
  </p>
  <div>
    <p><code>localhost didn't send any data</code> is the feedback I get when I try to say log into the app running on localhost:8000. This is after I linked both the app's container and the mysql container. I am not sure what should happen after the link is created. Should the app be able to send data such as log in or registration data?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/aa4d7225b5276efcfbbf556ff1b5676f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#175</span> <span class="badge text-bg-warning">Gitau Harrison</span> said
    
    <span class="flask-moment" data-timestamp="2020-10-30T09:31:07Z" data-function="fromNow" data-refresh="0" style="display: none">2020-10-30T09:31:07Z</span>
  </p>
  <div>
    <p>Looking at the command <code>RUN chown -R microblog:microblog ./</code>, here the user microblog is set as the owner of all files and directories in the <code>WORKDIR</code>.</p>
<p>Breaking it down, <code>RUN chown -R microblog:microblog ./</code>:</p>
<ul>
<li>the first <code>microblog</code> in the command above(before the colon), is it the project folder name?</li>
<li>the second <code>microblog</code>, is it the new owner?</li>
</ul>
<p>I am a bit confused if I create a new project folder with a different name, say <code>microblog_test</code>, but with the user called <code>microblog</code> should it be as:</p>
<pre><code>RUN chown -R microblog_test:microblog ./
</code></pre>
<p>or</p>
<pre><code>RUN chown -R microblog:microblog_test ./
</code></pre>
  </div>
</div>
    </li>
    
  </ul>
</div>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item"><a class="page-link" href="1.html#comments">&laquo;&laquo;</a></li>
    <li class="page-item"><a class="page-link" href="6.html#comments">&laquo;</a></li>
    <li class="page-item"><a class="page-link" href="8.html#comments">&raquo;</a></li>
    <li class="page-item"><a class="page-link" href="0.html#comments">&raquo;&raquo;</a></li>
  </ul>
</nav>



<div id="comment-form">
  <h3>Leave a Comment</h3>

  
  
  

  
<form action="#comment-form" method="post">
  <input id="url" name="url" type="hidden" value="">
<input id="csrf_token" name="csrf_token" type="hidden" value="IjQyYjY5YzZlNTcyYjFkMTVlZGRkOWJjYjA3ZmFlYWFiNTg3YmU5ODki.ZxdzlQ.XOo-7qxNJm07tRACTBbaINik3e4">
    
  <div class="mb-3">
    <label class="form-label" for="name">Name</label>
    <div class="input-group has-validation">
      <input class="form-control" id="name" name="name" required type="text" value="">
    </div>
  </div>

    
    
  <div class="mb-3">
    <label class="form-label" for="email">Email</label>
    <div class="input-group has-validation">
      <input class="form-control" id="email" name="email" required type="text" value="">
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="comment">Comment</label>
    <div class="input-group has-validation">
      <textarea class="form-control" id="comment" name="comment" required>
</textarea>
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="captcha">Captcha</label>
    <div class="input-group has-validation">
      
<script src='https://www.google.com/recaptcha/api.js' async defer></script>
<div class="g-recaptcha" data-sitekey="6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S"></div>

    </div>
  </div>

    
  <input class="btn btn-primary mb-3" id="submit" name="submit" type="submit" value="Submit">

      
</form>

</div>


</div>

      </div>
    </div>
    
    <div class="col-md-4">
      <div id="sidebar">
        
          
  



<div class="card">
  
  
  <div class="card-header">Flask Web Development, 2nd Edition</div>
  <a class="card-book-cover" href="https://amzn.to/3lE2mok">
    <img src="../../../static/flask2e-book-cover-small.png" alt="Flask Web Development, 2nd Edition">
  </a>
  <div class="card-body">
    <p class="card-text">If you want to learn modern web development techniques with Python and Flask, you may find the second edition of my <a href="https://amzn.to/3lE2mok">O'Reilly book</a> useful.</p>
  </div>
  <div class="card-body">
    <a class="card-link" href="https://amzn.to/3lE2mok">Click here to get this Book!</a><br />
  </div>

  
</div>
        
        <div class="card">
  <div class="card-header">About Miguel</div>
  <div class="card-body">
    <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="../../../static/miguel.jpg" />
    <p class="card-text">Welcome to my blog!</p>
    <p class="card-text">I'm a software engineer and technical writer, currently living in Drogheda, Ireland.</p>
    <p class="card-text">You can also find me on <a href="https://twitter.com/miguelgrinberg">Twitter</a>, <a href="https://mstdn.social/@miguelgrinberg">Mastodon</a>, <a href="https://github.com/miguelgrinberg">Github</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a>, <a href="https://youtube.com/miguelgrinberg">YouTube</a>, <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a> and <a href="https://patreon.com/miguelgrinberg">Patreon</a>.</p>
    <p class="card-text">Thank you for visiting!</p>
  </div>
</div>
        
        <div class="card" id="categories">
  <div class="card-header">Categories</div>
  <div class="card-body">
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AI/feed"><img src="../../../static/rss-small.png" title="AI RSS Feed" label="AI RSS Feed" alt="AI RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AI" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AI" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AWS/feed"><img src="../../../static/rss-small.png" title="AWS RSS Feed" label="AWS RSS Feed" alt="AWS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AWS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AWS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Arduino/feed"><img src="../../../static/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed" alt="Arduino RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Arduino" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Arduino" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Authentication/feed"><img src="../../../static/rss-small.png" title="Authentication RSS Feed" label="Authentication RSS Feed" alt="Authentication RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Authentication" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Authentication" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Blog/feed"><img src="../../../static/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed" alt="Blog RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Blog" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Blog" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/C++/feed"><img src="../../../static/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed" alt="C++ RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/C++" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="C++" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/CSS/feed"><img src="../../../static/rss-small.png" title="CSS RSS Feed" label="CSS RSS Feed" alt="CSS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/CSS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="CSS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Cloud/feed"><img src="../../../static/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed" alt="Cloud RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Cloud" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Cloud" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Database/feed"><img src="../../../static/rss-small.png" title="Database RSS Feed" label="Database RSS Feed" alt="Database RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Database" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Database" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Docker/feed"><img src="../../../static/rss-small.png" title="Docker RSS Feed" label="Docker RSS Feed" alt="Docker RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Docker" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Docker" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Filmmaking/feed"><img src="../../../static/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed" alt="Filmmaking RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Filmmaking" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Filmmaking" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Flask/feed"><img src="../../../static/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed" alt="Flask RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" /> <small><em>126</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Games/feed"><img src="../../../static/rss-small.png" title="Games RSS Feed" label="Games RSS Feed" alt="Games RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Games" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Games" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Heroku/feed"><img src="../../../static/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed" alt="Heroku RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Heroku" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Heroku" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/IoT/feed"><img src="../../../static/rss-small.png" title="IoT RSS Feed" label="IoT RSS Feed" alt="IoT RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/IoT" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="IoT" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/JavaScript/feed"><img src="../../../static/rss-small.png" title="JavaScript RSS Feed" label="JavaScript RSS Feed" alt="JavaScript RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/JavaScript" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="JavaScript" /> <small><em>35</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/MicroPython/feed"><img src="../../../static/rss-small.png" title="MicroPython RSS Feed" label="MicroPython RSS Feed" alt="MicroPython RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/MicroPython" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="MicroPython" /> <small><em>9</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microdot/feed"><img src="../../../static/rss-small.png" title="Microdot RSS Feed" label="Microdot RSS Feed" alt="Microdot RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microdot" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microdot" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microservices/feed"><img src="../../../static/rss-small.png" title="Microservices RSS Feed" label="Microservices RSS Feed" alt="Microservices RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microservices" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microservices" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Movie Reviews/feed"><img src="../../../static/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed" alt="Movie Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Movie Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Movie Reviews" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/OpenStack/feed"><img src="../../../static/rss-small.png" title="OpenStack RSS Feed" label="OpenStack RSS Feed" alt="OpenStack RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/OpenStack" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="OpenStack" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Personal/feed"><img src="../../../static/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed" alt="Personal RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Personal" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Personal" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Photography/feed"><img src="../../../static/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed" alt="Photography RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Photography" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Photography" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Product Reviews/feed"><img src="../../../static/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed" alt="Product Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Product Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Product Reviews" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Programming/feed"><img src="../../../static/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed" alt="Programming RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" /> <small><em>187</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Project Management/feed"><img src="../../../static/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed" alt="Project Management RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Project Management" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Project Management" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Python/feed"><img src="../../../static/rss-small.png" title="Python RSS Feed" label="Python RSS Feed" alt="Python RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" /> <small><em>169</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/REST/feed"><img src="../../../static/rss-small.png" title="REST RSS Feed" label="REST RSS Feed" alt="REST RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/REST" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="REST" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Rackspace/feed"><img src="../../../static/rss-small.png" title="Rackspace RSS Feed" label="Rackspace RSS Feed" alt="Rackspace RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Rackspace" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Rackspace" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Raspberry Pi/feed"><img src="../../../static/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed" alt="Raspberry Pi RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Raspberry Pi" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Raspberry Pi" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/React/feed"><img src="../../../static/rss-small.png" title="React RSS Feed" label="React RSS Feed" alt="React RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/React" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="React" /> <small><em>18</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Robotics/feed"><img src="../../../static/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed" alt="Robotics RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Robotics" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Robotics" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Security/feed"><img src="../../../static/rss-small.png" title="Security RSS Feed" label="Security RSS Feed" alt="Security RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Security" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Security" /> <small><em>12</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Video/feed"><img src="../../../static/rss-small.png" title="Video RSS Feed" label="Video RSS Feed" alt="Video RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Video" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Video" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/WebSocket/feed"><img src="../../../static/rss-small.png" title="WebSocket RSS Feed" label="WebSocket RSS Feed" alt="WebSocket RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/WebSocket" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="WebSocket" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Webcast/feed"><img src="../../../static/rss-small.png" title="Webcast RSS Feed" label="Webcast RSS Feed" alt="Webcast RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Webcast" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Webcast" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Windows/feed"><img src="../../../static/rss-small.png" title="Windows RSS Feed" label="Windows RSS Feed" alt="Windows RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Windows" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Windows" /> <small><em>1</em></small>
      </form>
    </div>
    
  </div>
</div>
        
      </div>
    </div>
    
  </div>
  <div id="footer">
    
    <p>&copy; 2012-<script type="text/javascript">document.write(new Date().getFullYear());</script> by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster _at_ miguelgrinberg _dot_ com">Questions?</a></p>
  </div>
</div>

  
    <script src="../../../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../../../static/prettify.js"></script>
  <script src="../../../../cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous"></script>

<script>
moment.locale("en");
function flask_moment_render(elem) {{
    const timestamp = moment(elem.dataset.timestamp);
    const func = elem.dataset.function;
    const format = elem.dataset.format;
    const timestamp2 = elem.dataset.timestamp2;
    const no_suffix = elem.dataset.nosuffix;
    const units = elem.dataset.units;
    let args = [];
    if (format)
        args.push(format);
    if (timestamp2)
        args.push(moment(timestamp2));
    if (no_suffix)
        args.push(no_suffix);
    if (units)
        args.push(units);
    elem.textContent = timestamp[func].apply(timestamp, args);
    elem.classList.remove('flask-moment');
    elem.style.display = "";
}}
function flask_moment_render_all() {{
    const moments = document.querySelectorAll('.flask-moment');
    moments.forEach(function(moment) {{
        flask_moment_render(moment);
        const refresh = moment.dataset.refresh;
        if (refresh && refresh > 0) {{
            (function(elem, interval) {{
                setInterval(function() {{
                    flask_moment_render(elem);
                }}, interval);
            }})(moment, refresh);
        }}
    }})
}}
document.addEventListener("DOMContentLoaded", flask_moment_render_all);
</script>

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-20EHZP9GRZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-20EHZP9GRZ');
  </script>
  
  <script type="text/javascript">
    function setThemeUI() {
      document.getElementById('select-theme-auto').classList.remove('active');
      document.getElementById('select-theme-light').classList.remove('active');
      document.getElementById('select-theme-dark').classList.remove('active');
      const theme = getPreferredTheme();
      const actualTheme = document.documentElement.getAttribute('data-bs-theme', 'light');
      document.getElementById('select-theme-' + theme).classList.add('active');
      document.getElementById('current-theme').href.baseVal = `#icon-theme-${actualTheme}`;
    };

    function updateTheme(theme) {
      if (theme === 'auto') {
        localStorage.removeItem('theme')
      }
      else {
        localStorage.setItem('theme', theme)
      }
      setTheme(getPreferredTheme());
    }

    setThemeUI();

    const darkModePreference = window.matchMedia("(prefers-color-scheme: dark)");
    darkModePreference.addEventListener("change", e => {
      if (getPreferredTheme() === 'auto') {
        setTheme('auto');
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      // add prettyprint class to all <pre><code></code></pre> blocks
      let prettify = false;
      document.querySelectorAll('div.post-body pre code').forEach((code) => {
        code.parentNode.classList.add('prettyprint');
        prettify = true;
      });
      prettyPrint();
    });
  </script>

  </body>

<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018/page/7 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 09:45:10 GMT -->
</html>