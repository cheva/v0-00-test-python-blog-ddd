<!doctype html>
<html lang="en">
  
<!-- Mirrored from blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 08:47:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
  <script type="text/javascript">
    function getPreferredTheme() {
      const storedTheme = localStorage.getItem('theme')
      if (storedTheme) {
        return storedTheme
      }
      return 'auto';
    }

    function setTheme(theme) {
      if (theme === 'auto') {
        theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
      }
      document.documentElement.setAttribute('data-bs-theme', theme);
    };

    setTheme(getPreferredTheme());
  </script>
  
    <title>
  
    The React Mega-Tutorial, Chapter 8: Authentication - miguelgrinberg.com
  
</title>
  
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="description" content="miguelgrinberg.com">
  <meta name="copyright" content="Copyright (c) 2012-2024 Miguel Grinberg">
  <meta name="author" content="Miguel Grinberg">
  
  <meta name="keywords" content="javascript, react, jsx, rest, authentication, authorization, tokens">
  
  
  <link rel="canonical" href="the-react-mega-tutorial-chapter-8-authentication.html">
  

  
    <link href="../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&amp;display=swap" rel="stylesheet">

  <link href="../static/tomorrow.min.css" type="text/css" rel="stylesheet" />
  <link href="../static/tomorrow-night.min.css" type="text/css" rel="stylesheet" />
  <link href="../static/social.css" rel="stylesheet" type="text/css" />
  <link href="../static/style_20231230.css" rel="stylesheet" type="text/css" />

  <link rel="shortcut icon" href="https://blog.miguelgrinberg.com/static/favicon.ico">
  <link rel="alternate" type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed" title="miguelgrinberg.com RSS feed">

    <meta property="og:title" content="The React Mega-Tutorial, Chapter 8: Authentication">
    <meta property="og:description" content="Up to this point, you have been using the Microblog API back end with an option to bypass authentication. This enabled the project to grow without having to deal with the highly complex matter of…">
    <meta property="og:image" content="https://blog.miguelgrinberg.com/static/cards/the-react-mega-tutorial-chapter-8-authentication.jpg">
    <meta property="og:url" content="https://blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication">
    <meta name="twitter:title" content="The React Mega-Tutorial, Chapter 8: Authentication">
    <meta name="twitter:description" content="Up to this point, you have been using the Microblog API back end with an option to bypass authentication. This enabled the project to grow without having to deal with the highly complex matter of…">
    <meta name="twitter:image" content="https://blog.miguelgrinberg.com/static/cards/the-react-mega-tutorial-chapter-8-authentication.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@miguelgrinberg">

  </head>
  <body>
    <svg style="display: none" version="2.0">
      <defs>
        <symbol id="icon-theme-auto" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-circle-half" viewBox="0 0 16 16">
          <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16"/>
        </symbol>
        <symbol id="icon-theme-light" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-brightness-high-fill" viewBox="0 0 16 16">
          <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </symbol>
        <symbol id="icon-theme-dark" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-moon-stars-fill" viewBox="0 0 16 16">
          <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"/>
          <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
        </symbol>
      </defs>
    </svg>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="https://blog.miguelgrinberg.com/index">miguelgrinberg.com</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" aria-current="page" href="https://blog.miguelgrinberg.com/index">Home</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="my-courses-and-books.html">My Courses and Books</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="hire-me.html">Consulting</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="about-me.html">About Me</a></li>
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <svg width="20" height="20" version="2.0"><use id="current-theme" href="#icon-theme-light"></svg>
          </a>
          <ul class="dropdown-menu">
            <li>
              <a id="select-theme-light" class="dropdown-item" href="javascript:updateTheme('light')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-light"></svg>&nbsp; Light Mode
              </a>
            </li>
            <li>
              <a id="select-theme-dark" class="dropdown-item" href="javascript:updateTheme('dark')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-dark"></svg>&nbsp; Dark Mode
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a id="select-theme-auto" class="dropdown-item" href="javascript:updateTheme('auto')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-auto"></svg>&nbsp; System Default
              </a>
            </li>
          </ul>
        </li>
        
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item social-icons">
          <a type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed"><img src="../static/social/rss.png" alt="RSS Feed" title="RSS Feed" /></a>
          <a href="https://twitter.com/miguelgrinberg"><img src="../static/social/twitter.png" alt="Twitter" title="Twitter" /></a>
          <a rel="me" href="https://mstdn.social/@miguelgrinberg"><img src="../static/social/mastodon.png" alt="Mastodon" title="Mastodon" /></a>
          <a href="http://github.com/miguelgrinberg"><img src="../static/social/github.png" alt="GitHub" title="GitHub" /></a>
          <a href="https://youtube.com/miguelgrinberg"><img src="../static/social/youtube.png" alt="YouTube" title="YouTube" /></a>
          <a href="http://www.linkedin.com/in/miguelgrinberg"><img src="../static/social/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
          <a href="https://patreon.com/miguelgrinberg"><img src="../static/social/patreon.png" alt="Patreon" title="Patreon" /></a>
          <!--<a href="https://www.facebook.com/miguelgrinbergblog"><img src="/static/social/facebook.png" alt="Facebook" title="Facebook" /></a>-->
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row">
    <div class="col-md-8">
      <div id="main">
        
        
        
        
        

<div class="post">

<div class="post-header">
  <h1><a href="the-react-mega-tutorial-chapter-8-authentication.html">The React Mega-Tutorial, Chapter 8: Authentication</a></h1>
  <h2>
    Posted by
    <form action="https://blog.miguelgrinberg.com/author/Miguel Grinberg" method="POST">
      <input type="submit" class="btn btn-danger btn-sm" value="Miguel Grinberg" />
    </form>
    on
    <button class="btn btn-secondary btn-sm" disabled><span class="flask-moment" data-timestamp="2022-08-05T16:23:36Z" data-function="format" data-format="LL" data-refresh="0" style="display: none">2022-08-05T16:23:36Z</span></button>
    under
    
      <form action="https://blog.miguelgrinberg.com/category/React" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="React" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/JavaScript" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="JavaScript" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" />
      </form>
    
    
  </h2>
</div>
<div class="post-body"><p>Up to this point, you have been using the Microblog API back end with an option to bypass authentication. This enabled the project to grow without having to deal with the highly complex matter of user authentication up front. In this chapter you will finally learn how to do this.</p>
<p>The complete course, including videos for every chapter is available to order from my <a href="https://courses.miguelgrinberg.com/p/react-mega-tutorial">courses site</a>. Ebook and paperback versions of this course are also available from <a href="https://www.amazon.com/dp/B09YPBXMMY/ref=nosim?tag=thirdwish-20">Amazon</a>. Thank you for your support!</p>
<p>For your reference, here is the complete list of articles in this series:</p>
<ul>
<li><a href="introducing-the-react-mega-tutorial.html">Introducing the React Mega-Tutorial</a></li>
<li><a href="the-react-mega-tutorial-chapter-1-modern-javascript.html">Chapter 1: Modern JavaScript</a></li>
<li><a href="the-react-mega-tutorial-chapter-2-hello-react.html">Chapter 2: Hello, React!</a></li>
<li><a href="the-react-mega-tutorial-chapter-3-working-with-components.html">Chapter 3: Working with Components</a></li>
<li><a href="the-react-mega-tutorial-chapter-4-routing-and-page-navigation.html">Chapter 4: Routing and Page Navigation</a></li>
<li><a href="the-react-mega-tutorial-chapter-5-connecting-to-a-back-end.html">Chapter 5: Connecting to a Back End</a></li>
<li><a href="the-react-mega-tutorial-chapter-6-building-an-api-client.html">Chapter 6: Building an API Client</a></li>
<li><a href="the-react-mega-tutorial-chapter-7-forms-and-validation.html">Chapter 7: Forms and Validation</a></li>
<li><a href="the-react-mega-tutorial-chapter-8-authentication.html">Chapter 8: Authentication</a> (this article)</li>
<li><a href="the-react-mega-tutorial-chapter-9-application-features.html">Chapter 9: Application Features</a></li>
<li><a href="the-react-mega-tutorial-chapter-10-memoization.html">Chapter 10: Memoization</a></li>
<li><a href="the-react-mega-tutorial-chapter-11-automated-testing.html">Chapter 11: Automated Testing</a></li>
<li><a href="the-react-mega-tutorial-chapter-12-production-builds.html">Chapter 12: Production Builds</a></li>
</ul>
<h2>Enabling Back End Authentication</h2>
<p>Back in <a href="the-react-mega-tutorial-chapter-5-connecting-to-a-back-end.html">Chapter 5</a> you installed the Microblog API back end, and as part of the setup instructions, you added the <code>DISABLE_AUTH=true</code> configuration option.</p>
<p>You now need to change this option to <code>DISABLE_AUTH=false</code>. If you deployed Microblog API locally, either in a Docker container or as a Python process, change this setting in the <em>.env</em> file located in the top-level directory of the Microblog API project, and then stop and restart your back end for the change to take effect.</p>
<p>If you deployed Microblog API on Heroku, visit your <a href="https://dashboard.heroku.com/apps">application dashboard</a> and select your deployed application to reconfigure it. From the application page select "Settings", scroll down to "Config vars" and click the "Reveal Config Vars" button to edit the value of <code>DISABLE_AUTH</code>. Heroku automatically restarts your application after the configuration is changed.</p>
<p>Keep in mind that as soon as you activate authentication on the back end, your React application will lose the ability to communicate with it, as many requests will now return a 401 status code and deny access. For requests that render a spinner while data is loaded, the spinner will stay visible indefinitely. All these issues are going to be fixed as the authentication is implemented in this chapter.</p>
<h2>Authentication in the API Client</h2>
<p>The most important benefit of having a dedicated API client class is that all aspects of working with the API are implemented in a single place. Because authentication support will be added inside the class, none of the application components that make API calls will need to change.</p>
<p>The Microblog API authentication flow is as follows:</p>
<ul>
<li>The client sends a <code>POST</code> request to <em>/api/tokens</em>, passing the username and password in a standard <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">basic authentication</a> header.</li>
<li>If the credentials are correct, the status code in the response is 200, and the body includes the <code>access_token</code> attribute. To enable token security best practices, the access token has a short life, and a refresh token that can be used to renew it is returned in a <a href="https://en.wikipedia.org/wiki/Secure_cookie">secure</a> and <a href="https://en.wikipedia.org/wiki/HTTP_cookie#HttpOnly_cookie">HTTP-only</a> cookie.</li>
<li>To make authenticated API calls, the client must include a standard <a href="https://swagger.io/docs/specification/authentication/bearer-authentication/">Bearer authentication</a> header with a valid access token in all requests.</li>
<li>If an API call is made with an access token that is incorrect or expired, a response with status code 401 is returned.</li>
</ul>
<p>While in general terms the solution presented in this chapter can be adapted to fit your own projects, you will need to customize the specific authentication flow according to the requirements of your server.</p>
<h3>Passing the Access Token in API Calls</h3>
<p>The <code>fetch()</code> call in the <code>request()</code> method needs to be expanded to include an <code>Authorization</code> header with the <code>Bearer</code> scheme.</p>
<p class="code_title"><em>src/MicroblogApiClient.js</em>: Include bearer token header</p>

<pre><code class="language-javascript">      response = await fetch(this.base_url + options.url + query, {
        method: options.method,
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + localStorage.getItem('accessToken'),
          ...options.headers,
        },
        body: options.body ? JSON.stringify(options.body) : null,
      });
}
</code></pre>
<p>The access token is retrieved from the browser's <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">local storage</a>. You will see later that when an access token is returned by the back end, it is immediately written to this storage. If there is no previously stored access token in the local storage, then <code>null</code> will be returned.</p>
<p>You may be wondering why this code isn't checking that the access token is not <code>null</code> before including it in the request. The assumption is that if the client object doesn't have an access token, then a different <code>Authorization</code> header will be included in the <code>options</code> object passed by the caller, which overrides the <code>Authorization</code> header defined here.</p>
<p>Storing the token in local storage makes it possible for the application to "remember" the authenticated user when the user refreshes the browser page, when the site is opened in multiple tabs, and when the browser is closed and reopened, which is a behavior that most users expect from a web application. However, you should keep in mind that storing sensitive information in local storage presents a risk if your application is vulnerable to <a href="https://owasp.org/www-community/attacks/xss/">cross-site scripting (XSS) attacks</a>.</p>
<p>An alternative implementation that avoids the risk of getting tokens compromised in an XSS attack is to use an instance variable in the <code>MicroblogApiClient</code> class to store the access token instead of local storage. While this solution increases security, the user experience would be severely degraded, as users would be required to authenticate every time a session with the application is started, even after a page refresh.</p>
<h3>Cross-Site Scripting Attacks</h3>
<p>You've learned in the previous section that storing sensitive information in the browser's local storage is sometimes considered a security risk, yet this is exactly what this project is doing. So this is a good time to discuss these risks in detail.</p>
<p>An XSS attack involves the attacker figuring out a way to insert malicious JavaScript into an application running on the user's browser. There are two basic ways in which this can happen:</p>
<ul>
<li>The attacker finds a way to break into the server that hosts the application's JavaScript files and makes modifications to them so that hacked versions with malicious code are served to clients.</li>
<li>The attacker tricks the application running in the browser into rendering a <code>&lt;script&gt;</code> tag with malicious JavaScript code.</li>
</ul>
<p>If you are using a third-party service such as Heroku to serve your React application, then the first scenario is the responsibility of your service provider. If you host your React application yourself, then you must use standard server hardening techniques such as passwordless logins, use of a firewall, closing any unnecessary network ports, etc.</p>
<p>React provides decent protection against the second attack vector, as long as you render all the content in your application through JSX. Protection against XSS attacks in React consists in applying escaping to all the text that is included in JSX contents returned by components. This escaping is always applied, there is no need to enable this protection.</p>
<p>To keep your application well protected, it is extremely important to avoid the temptation to bypass JSX and render contents to the page directly through DOM APIs, as this would not have any protection against XSS attacks.</p>
<p>When all these security concerns are addressed, the risk of a React application being the victim of an XSS attack is extremely low. Even though it would be unlikely for an access token to be compromised, it is considered a good practice to use short expirations on these tokens, so that if an attacker manages to steal a token by some unknown attack method, the damage that can be done with it is limited. Microblog API provides access tokens that last only 15 minutes in the default configuration. The tokens can only be renewed with a refresh token that is stored in a secure cookie, inaccessible from the browser's JavaScript environment.</p>
<h3>Logging In and Out</h3>
<p>How is the access token obtained? To receive a token, the client must send a <code>POST</code> request to <em>/api/tokens</em>, with the username and password entered by the user on the login page.</p>
<p>Instead of sending this request directly from the <code>LoginPage</code> component, the <code>MicroblogApiClient</code> class can implement a <code>login()</code> method with the required logic that generates the basic authentication header.</p>
<p class="code_title"><em>src/MicroblogApiClient.js</em>: Login method</p>

<pre><code class="language-javascript">  async login(username, password) {
    const response = await this.post('/tokens', null, {
      headers: {
        Authorization:  'Basic ' + btoa(username + &quot;:&quot; + password)
      }
    });
    if (!response.ok) {
      return response.status === 401 ? 'fail' : 'error';
    }
    localStorage.setItem('accessToken', response.body.access_token);
    return 'ok';
  }
</code></pre>
<p>Here you can see how the <code>Authorization</code> header is passed as an option in the third argument to <code>api.post()</code>, to override the default bearer token header added in the previous section. The second argument is used for the body of the request, which is set to <code>null</code> because in this particular case there is no body required.</p>
<p>In case you are curious, the <code>Authorization</code> header used in this method follows the Basic Authentication format defined by the HTTP specification, which requires encoding the username and password as a <a href="https://en.wikipedia.org/wiki/Base64">base64</a> string, done here by the <code>btoa()</code> function available in JavaScript.</p>
<p>There are three possible outcomes for this function. The two most obvious ones indicate authentication success or failure. A third less likely case occurs when the authentication request fails due to an unexpected issue, and not because the credentials are invalid. The return value of this function can be <code>ok</code>, <code>fail</code> or <code>error</code> to represent these three cases. The error case occurs when the authentication request returns a failure status code other than 401.</p>
<p>If the server returns a successful response, then the access token is written to the browser's local storage, so that it is used in all subsequent requests.</p>
<p>The user should be given the option to log out of the application when desired. To log a user out, the access token should be removed. A helper <code>logout()</code> method in the <code>MicroblogApiClient</code> class performs this action.</p>
<p class="code_title"><em>src/MicroblogApiClient.js</em>: Logout method</p>

<pre><code class="language-javascript">  async logout() {
    await this.delete('/tokens');
    localStorage.removeItem('accessToken');
  }
</code></pre>
<p>The <code>logout()</code> method makes a request to the token revocation endpoint of Microblog API, which ensures that the access token cannot be used again. It also removes the token from local storage so that the React application completely forgets about it.</p>
<p>For convenience, an <code>isAuthenticated()</code> method is also added to the client class. The application can use it to check if there is an authenticated user or not.</p>
<p class="code_title"><em>src/MicroblogApiClient.js</em>: isAuthenticated method</p>

<pre><code class="language-javascript">  isAuthenticated() {
    return localStorage.getItem('accessToken') !== null;
  }
</code></pre>
<h2>A User Context and Hook</h2>
<p>An important function of the authentication system is to provide information about the logged-in user to any components that need it. The preferred way to share the user with the application's components is with a context and hook combination.</p>
<p>The <code>UserContext</code> will share an object with four attributes:</p>
<ul>
<li><code>user</code>: the currently logged-in user, or <code>null</code> if the user is not logged in. A value of <code>undefined</code> indicates that the user is being retrieved from the server.</li>
<li><code>setUser</code>: a setter for the user.</li>
<li><code>login</code>: a helper function to log the user in with the username and password provided.</li>
<li><code>logout</code>: a helper function to log the user out.</li>
</ul>
<p>The complete implementation of the user context and its associated hook function is shown below.</p>
<p class="code_title"><em>src/contexts/UserProvider.js</em>: User context and hook</p>

<pre><code class="language-jsx">import { createContext, useContext, useState, useEffect } from 'react';
import { useApi } from './ApiProvider';

const UserContext = createContext();

export default function UserProvider({ children }) {
  const [user, setUser] = useState();
  const api = useApi();

  useEffect(() =&gt; {
    (async () =&gt; {
      if (api.isAuthenticated()) {
        const response = await api.get('/me');
        setUser(response.ok ? response.body : null);
      }
      else {
        setUser(null);
      }
    })();
  }, [api]);

  const login = async (username, password) =&gt; {
    const result = await api.login(username, password);
    if (result === 'ok') {
      const response = await api.get('/me');
      setUser(response.ok ? response.body : null);
    }
    return result;
  };

  const logout = async () =&gt; {
    await api.logout();
    setUser(null);
  };

  return (
    &lt;UserContext.Provider value={{ user, setUser, login, logout }}&gt;
      {children}
    &lt;/UserContext.Provider&gt;
  );
}

export function useUser() {
  return useContext(UserContext);
}
</code></pre>
<p>The <code>UserProvider</code> component defines a <code>user</code> state variable that will contain the details of the authenticated user. The state variable is initialized with a value of <code>undefined</code>, which is used while the user is being retrieved from the server. The value will change to the user details returned by the server as soon as they are available. The value will change to <code>null</code> if there is no authenticated user.</p>
<p>A side effect function is used to try to resolve the value of the <code>user</code> state variable when the component is rendered for the first time. When the <code>api</code> instance is authenticated, the function loads the user's details by calling the <em>/api/me</em> endpoint of Microblog API. The state variable remains set to the initial <code>undefined</code> value until the user information is returned, so any components that need to render user information can display a spinner or similar UI component while waiting.</p>
<p>If the <code>api</code> instance does not have an access token, then the <code>user</code> state variable is set to <code>null</code> to indicate to the rest of the application that there is no user logged in.</p>
<p>The <code>login()</code> helper function accepts username and password arguments. This function will be called by the <code>LoginPage</code> component to log the user in. The function starts by invoking the method of the same name in the API client. If the authentication attempt succeeds, a request to retrieve user information is issued, and the <code>user</code> state variable is updated accordingly, in a very similar way to how it was done in the side effect function.</p>
<p>The <code>logout()</code> helper function logs the user out in the <code>api</code> client instance, and then updates the <code>user</code> state variable to <code>null</code>, so that all components that use the context know that there is no authenticated user anymore.</p>
<p>The <code>UserContext.Provider</code> component sets the value of the context as an object with the <code>user</code>, <code>setUser</code>, <code>login</code> and <code>logout</code> keys.</p>
<p>As with all previous contexts, a <code>useUser()</code> companion hook function is defined to make it more convenient for components to access the elements of the context. For this hook, the entire object shared in the context is returned. The components accessing the context can use a destructuring assignment to obtain the attributes that they need.</p>
<p>The user context needs to be added to the application. Since this context depends on having access to the API client, it needs to be a child of it. Below is the updated <code>App</code> component.</p>
<p class="code_title"><em>src/App.js</em>: Add user context</p>

<pre><code class="language-jsx">... // &lt;-- no changes to existing imports
import UserProvider from './contexts/UserProvider';

export default function App() {
  return (
    &lt;Container fluid className=&quot;App&quot;&gt;
      &lt;BrowserRouter&gt;
        &lt;FlashProvider&gt;
          &lt;ApiProvider&gt;
            &lt;UserProvider&gt;
              &lt;Header /&gt;
              &lt;Routes&gt;
                ... // &lt;-- no changes to routes
              &lt;/Routes&gt;
            &lt;/UserProvider&gt;
          &lt;/ApiProvider&gt;
        &lt;/FlashProvider&gt;
      &lt;/BrowserRouter&gt;
    &lt;/Container&gt;
  );
}
</code></pre>
<h2>Implementing Private Routes</h2>
<p>When designing the authentication subsystem of the application, you have to decide what is the subset of the application routes that are going to be available only to users that have previously authenticated. Let's call these the <em>private</em> routes of the application.</p>
<p>When a client that is not authenticated attempts to access a private route, the best course of action is to redirect the user to the login page, and once the user submits the authentication form, redirect back to the route that was initially attempted.</p>
<p>The <code>PrivateRoute</code> component shown below can be used as a parent for any components that are only allowed to render when there is an authenticated user.</p>
<p class="code_title"><em>src/components/PrivateRoute.js</em>: Private route component</p>

<pre><code class="language-jsx">import { useLocation, Navigate } from 'react-router-dom';
import { useUser } from '../contexts/UserProvider';

export default function PrivateRoute({ children }) {
  const { user } = useUser();
  const location = useLocation();

  if (user === undefined) {
    return null;
  }
  else if (user) {
    return children;
  }
  else {
    const url = location.pathname + location.search + location.hash;
    return &lt;Navigate to=&quot;/login&quot; state={{next: url}} /&gt;
  }
}
</code></pre>
<p>The component's render function uses the <code>useUser()</code> hook from the previous section to retrieve the <code>user</code> state variable. If this variable is <code>undefined</code>, it means that the application isn't ready to provide user information yet. In this situation, this component cannot do anything, so it returns <code>null</code> to not render anything. This isn't a problem because the <code>undefined</code> value for the user is temporary. As soon as the <code>user</code> state variable in the user context resolves to <code>null</code> or to the user's details, this component will re-render.</p>
<p>When the <code>user</code> is set to a truthy value, it means that there is an authenticated user, and in that case this component renders its children.</p>
<p>The interesting case is when <code>user</code> is <code>null</code>, indicating that the user is not authenticated. In this situation, the children of this component cannot be rendered, because they require a user to be logged in. The component renders a <code>Navigate</code> component from React-Router, which sends the user to the login page is rendered instead.</p>
<p>As mentioned earlier, the intention is to redirect the user back to the original page after authentication is completed, so it is necessary to store the current URL so that it can be used later. To determine what is the current URL, React-Router provides a <code>useLocation()</code> hook, which returns a location object, very much like the browser's own <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/location">document.location</a>. From this object, the <code>pathname</code>, <code>search</code> and <code>hash</code> attributes are concatenated to form a single URL string to save.</p>
<p>The <code>Navigate</code> component supports a <code>state</code> prop in which the application can store any custom data to be preserved in the <code>location</code> object. This is the perfect place to write the URL that the user needs to be sent back to after authentication. The URL is stored in the <code>state</code> prop in an object, under a <code>next</code> key.</p>
<h2>Public Routes</h2>
<p>The login and user registration routes have the interesting property that they have no purpose after the user logs in. To prevent a logged-in user from navigating to these routes, it is a good idea to also create a <code>PublicRoute</code> component that only allows its children to render when the user is not logged in, or else it redirects the user to the root URL of the application.</p>
<p>Below is the complete implementation of <code>PublicRoute</code>, following a style that is very similar to that of <code>PrivateRoute</code>.</p>
<p class="code_title"><em>src/components/PublicRoute.js</em>: Public route component</p>

<pre><code class="language-jsx">import { Navigate } from 'react-router-dom';
import { useUser } from '../contexts/UserProvider';

export default function PublicRoute({ children }) {
  const { user } = useUser();

  if (user === undefined) {
    return null;
  }
  else if (user) {
    return &lt;Navigate to=&quot;/&quot; /&gt;
  }
  else {
    return children;
  }
}
</code></pre>
<h2>Routing Public and Private Pages</h2>
<p>How are the <code>PrivateRoute</code> and <code>PublicRoute</code> components defined in the previous sections used? There are a couple of different options, but these components act as wrappers of the route components.</p>
<p>A simple method to use these components is to add them directly in the <code>Route</code> definitions, wrapping the intended page components. For example:</p>
<pre><code class="language-jsx">&lt;Route path=&quot;/explore&quot; element={
  &lt;PrivateRoute&gt;&lt;ExplorePage /&gt;&lt;/PrivateRoute&gt;
} /&gt;
</code></pre>
<p>Given that most pages in this application are going to be private, it can get noisy to have lots of <code>PrivateRoute</code> wrappers. A less verbose alternative is to separate the public and private routes and then use a single <code>PrivateRoute</code> wrapper for the entire group of private routes.</p>
<p>Below are the changes to <code>App</code> to apply the route wrappers:</p>
<p class="code_title"><em>src/App.js</em>: Routing of public and private routes</p>

<pre><code class="language-jsx">... // &lt;-- no changes to existing imports
import PrivateRoute from './components/PrivateRoute';
import PublicRoute from './components/PublicRoute';

export default function App() {
  return (
    ... // &lt;-- no changes to outer components

    &lt;Routes&gt;
      &lt;Route path=&quot;/login&quot; element={
        &lt;PublicRoute&gt;&lt;LoginPage /&gt;&lt;/PublicRoute&gt;
      } /&gt;
      &lt;Route path=&quot;/register&quot; element={
        &lt;PublicRoute&gt;&lt;RegistrationPage /&gt;&lt;/PublicRoute&gt;
      } /&gt;
      &lt;Route path=&quot;*&quot; element={
        &lt;PrivateRoute&gt;
          &lt;Routes&gt;
            &lt;Route path=&quot;/&quot; element={&lt;FeedPage /&gt;} /&gt;
            &lt;Route path=&quot;/explore&quot; element={&lt;ExplorePage /&gt;} /&gt;
            &lt;Route path=&quot;/user/:username&quot; element={&lt;UserPage /&gt;} /&gt;
            &lt;Route path=&quot;*&quot; element={&lt;Navigate to=&quot;/&quot; /&gt;} /&gt;
          &lt;/Routes&gt;
        &lt;/PrivateRoute&gt;
      } /&gt;
    &lt;/Routes&gt;

    ... // &lt;-- no changes to outer components
  );
}
</code></pre>
<p>With this solution, only the public routes of the application are defined as top-level routes. The two public routes that map to the login and registration pages need to be disabled once the user logs in, so both are wrapped individually with <code>PublicRoute</code>.</p>
<p>If none of the public routes are a match, then a catch-all <code>*</code> route is defined with an inner <code>&lt;Routes&gt;</code> component that includes the remaining routes, which are all private and are wrapped with a single <code>PrivateRoute</code> component.</p>
<h2>Hooking Up the Login Form</h2>
<p>Most of the low-level pieces of the authentication solution are now in place, so the <code>LoginPage</code> component can now be completed, so that it actually performs the authentication procedure.</p>
<p class="code_title"><em>src/pages/LoginPage.js</em>: Log users in</p>

<pre><code class="language-jsx">import { useState, useEffect, useRef } from 'react';
import { Link, useNavigate, useLocation } from 'react-router-dom';
import Form from 'react-bootstrap/Form';
import Button from 'react-bootstrap/Button';
import Body from '../components/Body';
import InputField from '../components/InputField';
import { useUser } from '../contexts/UserProvider';
import { useFlash } from '../contexts/FlashProvider';

export default function LoginPage() {
  ... // &lt;-- no changes to existing state and references
  const { login } = useUser();
  const flash = useFlash();
  const navigate = useNavigate();
  const location = useLocation();

  ... // &lt;-- no changes to side effect function

  const onSubmit = async (ev) =&gt; {
    ... // &lt;-- no changes to existing submit logic

    const result = await login(username, password);
    if (result === 'fail') {
      flash('Invalid username or password', 'danger');
    }
    else if (result === 'ok') {
      let next = '/';
      if (location.state &amp;&amp; location.state.next) {
        next = location.state.next;
      }
      navigate(next);
    }
  };

  ... // &lt;-- no changes to returned JSX
}
</code></pre>
<p>From the four hooks used in this function, only <code>useNavigate()</code> is new. This hook is from React-Router, and provides access to a <code>navigate()</code> function that is similar to the <code>Navigate</code> component, but in function form.</p>
<p>The new logic to log the user in is added at the end of the <code>onSubmit()</code> function, after all the validation checks have passed. Note that this function was converted to <code>async</code>, so that <code>await</code> can be used.</p>
<p>To initiate the authentication, the <code>login()</code> function from the user context is called with the <code>username</code> and <code>password</code> values entered by the user in the form. The <code>login()</code> function is asynchronous, so it is awaited. The return value is the string <code>ok</code> when the user is successfully authenticated, <code>fail</code> when the authentication fails, or <code>error</code> when an unexpected error prevented authentication to be carried out.</p>
<p>In case of an authentication failure, an error message is flashed, and the user remains on the login page to try again.</p>
<p>If the authentication call succeeds, then the API client now has an access token and the user context has the user details to share with other components, so the user can be redirected to any of the private routes of the application.</p>
<p>Normally the redirect is to the root URL, which is the user's feed page, but if <code>location.state</code> has a <code>next</code> attribute, then the redirect goes to this route, which is the one that was saved by the <code>PrivateRoute</code> component when the user attempted to access the page without being logged in.</p>
<p>The third possibility occurs when the authentication call fails due to an unexpected reason. This case is not handled by this component and will instead be handled later with an application-wide error handler.</p>
<p>The application now has a working login procedure. You should be able to register a new user (if you haven't done that already), and then log in. Once you are logged in, your feed page is going to be empty, since you aren't following any users yet. You can navigate to the Explore page to confirm that blog posts from other users are displayed.</p>
<p>As discussed above, access tokens returned by Microblog API are valid for 15 minutes, after which they expire. At this time the <code>MicroblogApiClient</code> class does not have the ability to "refresh" an expired access token, so the application may appear to stop working if you use it long enough for the access token to expire. Refresh support for tokens will be added soon, but in the meantime, if you reach the token expiration time you will need to refresh the page to trigger a new login.</p>
<h2>User Information in the Header</h2>
<p>Application components can now add logic to render themselves differently when a user is logged in versus when not. This makes it possible to add a common user interface component found in many websites: a dropdown in the top-right corner with account related options.</p>
<p>Below is the new version of <code>Header</code> that includes a dropdown with options to access the user's profile page and to logout of the application.</p>
<p class="code_title"><em>src/components/Header.js</em>: Show a user account dropdown</p>

<pre><code class="language-jsx">import Navbar from 'react-bootstrap/Navbar';
import Container from 'react-bootstrap/Container';
import Nav from 'react-bootstrap/Nav';
import NavDropdown from 'react-bootstrap/NavDropdown';
import Image from 'react-bootstrap/Image';
import Spinner from 'react-bootstrap/Spinner';
import { NavLink } from 'react-router-dom';
import { useUser } from '../contexts/UserProvider';

export default function Header() {
  const { user, logout } = useUser();

  return (
    &lt;Navbar bg=&quot;light&quot; sticky=&quot;top&quot; className=&quot;Header&quot;&gt;
      &lt;Container&gt;
        &lt;Navbar.Brand&gt;Microblog&lt;/Navbar.Brand&gt;
        &lt;Nav&gt;
          {user === undefined ?
            &lt;Spinner animation=&quot;border&quot; /&gt;
          :
            &lt;&gt;
              {user !== null &amp;&amp;
                &lt;div className=&quot;justify-content-end&quot;&gt;
                  &lt;NavDropdown title={
                    &lt;Image src={user.avatar_url + '&amp;s=32'} roundedCircle /&gt;
                  } align=&quot;end&quot;&gt;
                    &lt;NavDropdown.Item as={NavLink} to={'/user/' + user.username}&gt;
                      Profile
                    &lt;/NavDropdown.Item&gt;
                    &lt;NavDropdown.Divider /&gt;
                    &lt;NavDropdown.Item onClick={logout}&gt;
                      Logout
                    &lt;/NavDropdown.Item&gt;
                  &lt;/NavDropdown&gt;
                &lt;/div&gt;
              }
            &lt;/&gt;
          }
        &lt;/Nav&gt;
      &lt;/Container&gt;
    &lt;/Navbar&gt;
  );
}
</code></pre>
<p>The component gets the currently logged-in user from the <code>useUser()</code> hook. Right after the <code>Navbar.Brand</code> component, a conditional JSX expression is inserted. If the current user is <code>undefined</code>, meaning that the application is still trying to figure out who the user is, a <code>Spinner</code> component is rendered on the right side of the navigation bar.</p>
<p>When the <code>user</code> is not <code>undefined</code> or <code>null</code>, a dropdown is created using <a href="https://react-bootstrap.github.io/docs/components/navs/">Nav</a> components from React-Bootstrap. The case of <code>user</code> being <code>null</code> is handled by not rendering anything in this part of the navigation bar. An alternative that might work for many applications is to render a login link or button, but given that this application automatically redirects to the login form, this does not seem necessary.</p>
<p>The dropdown is created with the avatar image of the logged-in user, which is available in <code>user.avatar_url</code>. As with avatar images displayed in blog posts, the image is provided by the Gravatar service for the email registered in the account. For emails that do not have an avatar image registered with the service, Gravatar returns a unique geometric design. You can associate an image with your email address by visiting the <a href="https://en.gravatar.com/">Gravatar</a> site.</p>
<p>The "Profile" option is created using the <code>NavDropdown.Item</code> component from React-Bootstrap, customized to be a <code>NavLink</code> component from React-Router. Recall that this technique was also used to create React-Router compatible links in the sidebar. The <code>to</code> prop of the link is dynamically set to the <em>/api/user/{username}</em> URL for the logged-in user.</p>
<p>The logout option in the dropdown has an <code>onClick</code> handler that invokes the <code>logout()</code> function obtained from the <code>useUser()</code> hook, which logs the user out and then redirects to the main route of the application.</p>
<p>The <code>NavDropdown.Divider</code> component creates a divider line between the two options. In case you want to learn more about creating great looking sidebars, the design of this dropdown is based on the examples of navigation bars with dropdowns in the <a href="https://react-bootstrap.github.io/docs/components/navs/#using-dropdowns">NavDropdown documentation</a>.</p>
<p>To ensure that the options in this dropdown have a look that is consistent with the links in the sidebar, the foreground and background color definitions added earlier for the sidebar can be extended to also apply to the <code>.dropdown-item.active</code> class.</p>
<p class="code_title"><em>src/index.css</em>: Styling of dropdown options</p>

<pre><code class="language-css">... // &lt;-- no changes to other styles

.Sidebar a, .dropdown-item, .dropdown-item.active {
  color: #444;
}

.Sidebar .nav-item .active, .dropdown-item.active {
  background-color: #def;
}
</code></pre>
<p><a href="#fig8-1">Figure 8.1</a> shows the account dropdown.</p>
<div id="fig8-1"></div>
<p><center><img alt="Figure 8.1: User account dropdown" src="../static/images/react-mega-tutorial/08-dropdown.png" /></center></p>
<h2>Handling Refresh Tokens</h2>
<p>If the client receives a 401 status code while using a previously valid access token, then this indicates that the token has expired and needs to be "refreshed".</p>
<p>As mentioned before, using short-lived tokens is a well accepted security practice in APIs, designed to limit the potential damage that can be caused if an access token is compromised.</p>
<p>When the access token expires, the client can request a new access token by sending a <code>PUT</code> request to <em>/api/tokens</em>, passing the expired access token in the body of the request. In addition to the expired access token, the client must provide a refresh token through a cookie that the server set during the initial authentication flow. The cookie that stores the refresh token is secured so that it cannot be stolen via JavaScript based attacks.</p>
<p>One of the great benefits of having a dedicated API client class is that the refresh logic does not need to be known outside this class. The rest of the application can send requests normally, and whenever a token refresh is necessary, the process can be handled internally by the class without affecting the rest of the application. Using pseudocode, the request sending logic can be expanded to support transparent token refreshes as follows:</p>
<ul>
<li>Send the request</li>
<li>If the response is not 401</li>
<li>Return response to caller</li>
<li>Else</li>
<li>Refresh access token</li>
<li>Send original request again with new access token</li>
<li>Return response to caller</li>
</ul>
<p>To prevent the code in the <code>request()</code> method of the API client from getting too complicated, the refresh logic can be implemented in a separate method. Start by renaming <code>request()</code> to <code>requestInternal()</code>, and creating a new <code>request()</code> wrapper method that calls it.</p>
<p class="code_title"><em>src/MicroblogApiClient.js</em>: Request wrapper method</p>

<pre><code class="language-javascript">export default class MicroblogApiClient {
  async request(options) {
    let response = await this.requestInternal(options);
    return response;
  }

  async requestInternal(options) {
    ... // &lt;-- original request() code here
  }

  ... // &lt;-- no changes to other methods
}
</code></pre>
<p>The token refresh requests that are sent to Microblog API must include the refresh token cookie that the API set when the user first authenticated. The <code>fetch()</code> function used to make the requests does not send cookies by default, so it needs to be told to do it for this request by adding the <code>credentials</code> option. The change to add this option in the <code>requestInternal()</code> method is shown in the listing below.</p>
<p class="code_title"><em>src/MicroblogApiClient.js</em>: Include cookies in requests</p>

<pre><code class="language-javascript">      response = await fetch(this.base_url + options.url + query, {
        method: options.method,
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + localStorage.getItem('accessToken'),
          ...options.headers,
        },
        credentials: options.url === '/tokens' ? 'include' : 'omit',
        body: options.body ? JSON.stringify(options.body) : null,
      });
}
</code></pre>
<p>The <code>credentials</code> option is set to <code>include</code> only when the URL is that of the refresh token endpoint. In all other cases it is best to avoid sending unnecessary cookies by setting this option to <code>omit</code>.</p>
<p>Now the new <code>request()</code> wrapper method can be expanded to refresh the token and retry the original request when necessary.</p>
<p class="code_title"><em>src/MicroblogApiClient.js</em>: Refresh token logic</p>

<pre><code class="language-javascript">export default class MicroblogApiClient {
  async request(options) {
    let response = await this.requestInternal(options);
    if (response.status === 401 &amp;&amp; options.url !== '/tokens') {
      const refreshResponse = await this.put('/tokens', {
        access_token: localStorage.getItem('accessToken'),
      });
      if (refreshResponse.ok) {
        localStorage.setItem('accessToken', refreshResponse.body.access_token);
        response = await this.requestInternal(options);
      }
    }
    return response;
  }

  ... // &lt;-- no changes to other methods
}
</code></pre>
<p>The refresh logic is only used when the original request comes back with a 401 status code, and the URL is not the one for the refresh token endpoint already. Checking the URL is useful to avoid a possible endless loop if the refresh token endpoint also fails with a 401 status code, maybe due to an expired or missing refresh token.</p>
<p>To refresh the token, a <code>PUT</code> request to <em>/api/tokens</em> is sent with the expired access token in the body. The cookie previously set during login will be included, per the <code>credentials</code> option added in <code>requestInternal()</code>.</p>
<p>If the token refresh endpoint succeeds, then a new access token is returned. This token is written to local storage, replacing the now expired one. For added security, Microblog API will also send a new refresh token and invalidate the one that was just used, but this is in a secure cookie that is handled automatically by the browser.</p>
<p>Once the client is updated with the new access token, the original request can be retried, and this time the response is directly returned, regardless of its status code.</p>
<p>With these changes, a logged-in user should be able to stay on the system for as long as it wants, regardless of access token expirations.</p>
<h2>Chapter Summary</h2>
<ul>
<li>The logged-in user can be shared with the application through a context and custom hook.</li>
<li>For common route behaviors such as redirecting to a login form or restricting access to logged-in users, create a wrapper component.</li>
<li>Abstract the authentication logic in the methods of an API client, so that its complexity does not bleed into other parts of the application.</li>
<li>Never render contents directly to the page with DOM APIs, as this introduces a risk of XSS attacks.</li>
</ul></div>

<div class="card patreon-bar">
  <div class="card-body">
    <h5>Become a Patron!</h5>
    <p class="card-text">Hello, and thank you for visiting my blog! If you enjoyed this article, please consider supporting my work on this blog on <a href="https://patreon.com/miguelgrinberg">Patreon</a>!</p>
    <a href="https://patreon.com/miguelgrinberg" alt="Become a Patron!" title="Become a Patron!"><img src="../static/patreon-button.png"></a>
  </div>
</div>


<div class="card social-bar">
  <div class="card-body">
    <h5>Share this post:</h5>
      <!-- Sharingbutton Hacker News -->
      <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3A//blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication&amp;t=The%20React%20Mega-Tutorial%2C%20Chapter%208%3A%20Authentication" target="_blank" rel="noopener" aria-label="Hacker News">
        <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg></div>Hacker News</div>
      </a>

      <!-- Sharingbutton Reddit -->
      <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3A//blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication&amp;resubmit=true&amp;title=The%20React%20Mega-Tutorial,%20Chapter%208:%20Authentication" target="_blank" rel="noopener" aria-label="Reddit">
        <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div>Reddit</div>
      </a>

      <!-- Sharingbutton Twitter -->
      <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=The%20React%20Mega-Tutorial%2C%20Chapter%208%3A%20Authentication&amp;url=https%3A//blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication" target="_blank" rel="noopener" aria-label="Twitter">
        <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div>Twitter</div>
      </a>

      <!-- Sharingbutton LinkedIn -->
      <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A//blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication&amp;title=The%20React%20Mega-Tutorial%2C%20Chapter%208%3A%20Authentication&amp;summary=The%20React%20Mega-Tutorial%2C%20Chapter%208%3A%20Authentication&amp;source=https%3A//blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication" target="_blank" rel="noopener" aria-label="LinkedIn">
        <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div>LinkedIn</div>
      </a>

      <!-- Sharingbutton Facebook -->
      <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3A//blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication" target="_blank" rel="noopener" aria-label="Facebook">
        <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div>Facebook</div>
      </a>

      <!-- Sharingbutton E-Mail -->
      <a class="resp-sharing-button__link" href="mailto:?subject=The%20React%20Mega-Tutorial%2C%20Chapter%208%3A%20Authentication&amp;body=https%3A//blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication" target="_self" rel="noopener" aria-label="E-Mail">
        <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div>E-Mail</div>
      </a>

  </div>
</div>

<div id="comments" class="post-comment-count">
  
  <a class="btn btn-outline-secondary" href="the-react-mega-tutorial-chapter-8-authentication.html#comments">23 comments</a>
  
</div>


<div class="comments">
  <ul>
    
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/fa42cc152dce1b9171e74b29eac85d47?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#1</span> <span class="badge text-bg-warning">Erick</span> said
    
    <span class="flask-moment" data-timestamp="2022-08-15T11:38:16Z" data-function="fromNow" data-refresh="0" style="display: none">2022-08-15T11:38:16Z</span>
  </p>
  <div>
    <p>Hello. I am new in react and this is a great blog! Thank you very much.<br>
How can I change the pattern of MicroblogApiClient.js (or similar file) to use a jwt token pair (access and refresh) authentication ?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#2</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2022-08-15T13:35:00Z" data-function="fromNow" data-refresh="0" style="display: none">2022-08-15T13:35:00Z</span>
  </p>
  <div>
    <p>@Erick: the client application is not concerned with the structure or format of the token. From the client the token is just a string. The decision to use JWT or other format for the token is made by the server. The client does not need to change when the token format changes.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/a8017bfae07f335c542606e1cd688e95?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#3</span> <span class="badge text-bg-warning">DavidE</span> said
    
    <span class="flask-moment" data-timestamp="2022-08-15T22:23:11Z" data-function="fromNow" data-refresh="0" style="display: none">2022-08-15T22:23:11Z</span>
  </p>
  <div>
    <p>Thank you - this series is an amazing addition to your great Flask tutorial. </p>
<p>If I log out from a specific page when I log back in I get redirected to the same page - is there a way to reset the location.state.next to be the default route?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#4</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2022-08-15T23:12:10Z" data-function="fromNow" data-refresh="0" style="display: none">2022-08-15T23:12:10Z</span>
  </p>
  <div>
    <p>@DavidE: You can add a redirect to <code>/</code> in the logout function to reset the current page to the root.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/1d6bdfb3f25a83ac5b39f3081295db8f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#5</span> <span class="badge text-bg-warning">Abhishek</span> said
    
    <span class="flask-moment" data-timestamp="2022-09-05T10:25:05Z" data-function="fromNow" data-refresh="0" style="display: none">2022-09-05T10:25:05Z</span>
  </p>
  <div>
    <p>You can also use <code>Outlet</code> components from React Router Dom package to make code easier:<br>
Example code in PrivateRoute.jsx</p>
<pre><code>import { useLocation, Navigate, Outlet } from &quot;react-router-dom&quot;;
import { useUser } from &quot;../contexts/UserProvider&quot;;

export default function PrivateRoute({ children }) {
  const { user } = useUser();
  const location = useLocation();

  if (user === undefined) {
    return null;
  } else if (user) {
    // return children;
    return &lt;Outlet /&gt;;
  } else {
    const url = location.pathname + location.search + location.hash;
    return &lt;Navigate to=&quot;/login&quot; state={{ next: url }} /&gt;;
  }
}
</code></pre>
<p>Example code in App.jsx</p>
<pre><code>...
      &lt;BrowserRouter&gt;
        &lt;FlashProvider&gt;
          &lt;ApiProvider&gt;
            &lt;UserProvider&gt;
              &lt;Header /&gt;
              &lt;Routes&gt;
                &lt;Route element={&lt;PublicRoute /&gt;}&gt;
                  &lt;Route path=&quot;/login&quot; element={&lt;LoginPage /&gt;} /&gt;
                  &lt;Route path=&quot;/register&quot; element={&lt;RegistrationPage /&gt;} /&gt;
                &lt;/Route&gt;
                &lt;Route element={&lt;PrivateRoute /&gt;}&gt;
                  &lt;Route path=&quot;/&quot; element={&lt;FeedPage /&gt;} /&gt;
                  &lt;Route path=&quot;/explore&quot; element={&lt;ExplorePage /&gt;} /&gt;
                  &lt;Route path=&quot;/user/:username&quot; element={&lt;UserPage /&gt;} /&gt;
                  &lt;Route path=&quot;*&quot; element={&lt;Navigate to=&quot;/&quot; /&gt;} /&gt;
                &lt;/Route&gt;
              &lt;/Routes&gt;
            &lt;/UserProvider&gt;
          &lt;/ApiProvider&gt;
        &lt;/FlashProvider&gt;
      &lt;/BrowserRouter&gt;
...
</code></pre>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#6</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2022-09-06T08:11:27Z" data-function="fromNow" data-refresh="0" style="display: none">2022-09-06T08:11:27Z</span>
  </p>
  <div>
    <p>@Abhishek: I don't see how this change makes the code easier, but sure, it is another option you can use if you like it.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/a564aa5c04640357a5ac907527e8b2b1?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#7</span> <span class="badge text-bg-warning">JM</span> said
    
    <span class="flask-moment" data-timestamp="2022-09-14T08:01:32Z" data-function="fromNow" data-refresh="0" style="display: none">2022-09-14T08:01:32Z</span>
  </p>
  <div>
    <p>Hello Miguel,</p>
<p>It seems like btoa/atob have been marked as deprecated: <a href="https://nodejs.org/docs/latest-v16.x/api/buffer.html#bufferatobdata" rel="nofollow">https://nodejs.org/docs/latest-v16.x/api/buffer.html#bufferatobdata</a>. I can imagine it is not a big deal, as you would have already mentioned it if it was; nonetheless, do you think we should use the recommended Buffer.from(str, 'base64') instead?</p>
<p>Kind regards,</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#8</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2022-09-14T08:41:51Z" data-function="fromNow" data-refresh="0" style="display: none">2022-09-14T08:41:51Z</span>
  </p>
  <div>
    <p>@JM: This is incorrect. You are looking at a deprecation notice for the Node.js functions <code>btoa</code> and <code>atob</code>, but this application runs in the browser, not under Node. The functions in the browser are not deprecated, and I doubt they'll ever be.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/a8a06badac349ec0aec92c1614c3f1ff?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#9</span> <span class="badge text-bg-warning">dAresDeFi</span> said
    
    <span class="flask-moment" data-timestamp="2022-10-02T22:55:31Z" data-function="fromNow" data-refresh="0" style="display: none">2022-10-02T22:55:31Z</span>
  </p>
  <div>
    <p>My fetch requests are, as you outlined, made through the Api() context containing the following header:</p>
<p>headers: {<br>
                    'Content-Type': 'application/json',<br>
                    'Authorization': 'Bearer ' + localStorage.getItem('accessToken'),<br>
                    ...options.headers,<br>
                }</p>
<p>My flask standard token auth wrapper is as follows:<br>
def token_required(f):</p>
<pre><code>@wraps(f)
def decorator(*args, **kwargs):

    token = None

    if "Authorization" in request.headers:
        token = request.headers["Authorization"]
           .... etc
</code></pre>
<p>However, my fetch requests cannot get past @token_required routes ex:<br>
@app.route('/api/users/me', methods=['GET'])<br>
@token_required<br>
def me(token):<br>
    """Retrieve the authenticated user"""</p>
<pre><code>#return token.current_user()
return {"message":"token passed"}
</code></pre>
<p>After some Postman tests, it seems my flask doesn't like the "Bearer" in front of the token in our Authorization header.</p>
<p>For example, this request goes through successfully:</p>
<p>const response = await api.get('/api/users/me', <br>
                    {<br>
                        headers: {<br>
                            Authorization: localStorage.getItem('accessToken')<br>
                        }<br>
                    });</p>
<p>However, if I remove the "Bearer" from our Api Client request Header, the react app turns completely blank.</p>
<p>Any ideas why my flask doesn't like requests with the "Bearer" in the Authorization?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#10</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2022-10-03T21:47:18Z" data-function="fromNow" data-refresh="0" style="display: none">2022-10-03T21:47:18Z</span>
  </p>
  <div>
    <p>@dAresDeFi: You are asking me a question about your own code. I think it is dangerous that you are using security code that you don't fully understand, but in any case, the value of <code>request['authorization']</code> is <code>Bearer token</code>. If you want to only use the token, then you have to parse the value of the header to extract this part.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/67d59b41c2d43660c6d7e5f3cfcef57b?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#11</span> <span class="badge text-bg-warning">muhammad nasr</span> said
    
    <span class="flask-moment" data-timestamp="2022-10-12T08:23:19Z" data-function="fromNow" data-refresh="0" style="display: none">2022-10-12T08:23:19Z</span>
  </p>
  <div>
    <p>Hi Miguel,<br>
Thank you for React blog.<br>
I have a misunderstanding.</p>
<p>In logout function I didn't notice access token in the headers, and I see it is required in the backend api.</p>
<p>and for refresh token,<br>
which part stores the token or it is stored in cookies by backend?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#12</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2022-10-12T10:39:10Z" data-function="fromNow" data-refresh="0" style="display: none">2022-10-12T10:39:10Z</span>
  </p>
  <div>
    <p>@muhammad: The <code>logout()</code> method sends a <code>DELETE</code> request through the <code>request()</code> method of the client class. This method inserts the access token. The refresh token is stored in a http-only cookie by the server for greater security. This is all covered in this article.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/278703b8bf0092b0339ef68b59a1205f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#13</span> <span class="badge text-bg-warning">Travis P</span> said
    
    <span class="flask-moment" data-timestamp="2023-10-01T23:11:32Z" data-function="fromNow" data-refresh="0" style="display: none">2023-10-01T23:11:32Z</span>
  </p>
  <div>
    <p>Hi Miguel,</p>
<p>I noticed some strange behaviour with the Alert component / flash function on the login screen when providing incorrect credentials, and I compared this blog post against the code at the relevant tag in your Github repository. I see in your Github version of the FlashMessage component, you've passed the "show" prop to the Alert component, but you didn't do that in this blog. Without adding that prop, the alert never appears again after being manually dismissed. Could you elaborate on why that is the case? And did you add it to Github after writing this blog due to some changes in the library that required this prop?</p>
<p>Another observation regarding the alert: If the alert is flashed due to incorrect password, and then you subsequently log in with the correct password, the alert for incorrect credentials still remains after redirect. Is there a way you would recommend dismissing this alert prematurely upon successful login?</p>
<p>Thank you for the great tutorial series!</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#14</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2023-10-03T18:56:52Z" data-function="fromNow" data-refresh="0" style="display: none">2023-10-03T18:56:52Z</span>
  </p>
  <div>
    <p>@Travis: as always, if the text of the tutorial and the code differ, you should assume that the code is more up to date. I regularly update the dependencies and fix minor issues that appear as a result. Regarding your second question, the Flash context exports a <code>hideFlash()</code> function. You can call this function upon a successful login to dismiss any alert that may be visible.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/4a483cff83865086878f3b23ab976cd5?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#15</span> <span class="badge text-bg-warning">Alberto</span> said
    
    <span class="flask-moment" data-timestamp="2023-11-10T21:39:52Z" data-function="fromNow" data-refresh="0" style="display: none">2023-11-10T21:39:52Z</span>
  </p>
  <div>
    <p>Thanks a lot for this great tutorial! </p>
<p>I have a doubt, the useEffect function that set the value of the user, inside UserProvider.js, runs only once after the first render of the Private Route component? </p>
<p>I'm testing the auth logic with out refreshing token, so i expected that after the token expiration, the app redirected to login page, but instead it continuous inside the pages app and not update / set the user data to null. I must reload the page, to the user changes it's value to null, after check token expiration with the Flask End Point /me.</p>
<p>Thanks Again.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#16</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2023-11-11T12:55:41Z" data-function="fromNow" data-refresh="0" style="display: none">2023-11-11T12:55:41Z</span>
  </p>
  <div>
    <p>@Alberto: the useEffect function that you referenced has <code>[api]</code> as dependencies. That means that it will run on first render, and any time the <code>api</code> variable changes. If you want to force this function to run again, you have to ensure that when the token expires the <code>api</code> instance is regenerated to refresh the new user status as not authenticated. Then the effect function will run and reset the user to <code>null</code>.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/4a483cff83865086878f3b23ab976cd5?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#17</span> <span class="badge text-bg-warning">Alberto</span> said
    
    <span class="flask-moment" data-timestamp="2023-11-13T01:04:48Z" data-function="fromNow" data-refresh="0" style="display: none">2023-11-13T01:04:48Z</span>
  </p>
  <div>
    <p>[api] is the second argument of the useEffect Function, that comes from the MicroblogApiClient instance, implemented through the ApiProvider (ApiContext). </p>
<p>When you say "...and any time the api variable changes..." It means that any call to the Flask Back End (User Info, List of User Posts, etc...), using the the MicroblogApiClient, will cause that the api variable changes is value and forcing to run the useEffect function?</p>
<p>Or the App is not designed to force this function to run again, just when the token expires and not refreshing automatically the new user status as not authenticated? In this scenario, the app will continue working inside Private Route components, even thought the token has expired, until manual page refreshing.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#18</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2023-11-13T12:46:35Z" data-function="fromNow" data-refresh="0" style="display: none">2023-11-13T12:46:35Z</span>
  </p>
  <div>
    <p>@Alberto: All I'm saying is that you are trying to use a different authentication flow than the one I show in this tutorial. You can't expect that the code will automatically adapt to your new flow, this is something that you need to plan for. If you want the <code>PrivateRoute</code> component to redirect to the login page when the token expires, then you should make sure to call <code>setUser(null)</code> when you detect an expired token, as that is what <code>PrivateRoute</code> checks to decide if a redirect to login is needed.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/4a483cff83865086878f3b23ab976cd5?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#19</span> <span class="badge text-bg-warning">Alberto</span> said
    
    <span class="flask-moment" data-timestamp="2023-11-15T15:30:49Z" data-function="fromNow" data-refresh="0" style="display: none">2023-11-15T15:30:49Z</span>
  </p>
  <div>
    <p>It's true, i'm using a different authetication flow. I just implemented a first adapt approach: <br>
<em>All the API calls to my Back End, are redirected to a Middleware (Back End) that verify Token validation.<br>
</em>If no token is providen, the back end response status is 403.<br>
<em>Else if token  is providen, but has expired or has some mistake, the back end response status is </em>401.<br>
*Else if token is providen and succesfully validated, the back end redirect to the function that implement the logic of the original API call, and the response status is 200, attached with the metadata of the second function.</p>
<p>*If React Front End check that the repsonse status is different from 200, so it calls the logout function, redirecting the user to the login page.</p>
<p>I have to adapt the logic, for the app be able to check the token expiration  for every time the routes changes.</p>
<p>Thanks a lot Miguel.</p>
<p>first passchecks for Token validation</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/6f592589fcbaad65256b60b179f138a3?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#20</span> <span class="badge text-bg-warning">Edward Iniko</span> said
    
    <span class="flask-moment" data-timestamp="2024-01-04T15:47:26Z" data-function="fromNow" data-refresh="0" style="display: none">2024-01-04T15:47:26Z</span>
  </p>
  <div>
    <p>Maybe I'm wrong but I am expecting the 'api/me' endpoint should have an authorization header with token to retrieve a specific user from the db</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#21</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2024-01-04T15:52:47Z" data-function="fromNow" data-refresh="0" style="display: none">2024-01-04T15:52:47Z</span>
  </p>
  <div>
    <p>@Edward: That is correct. What did you see that does not agree with your statement?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/06b7b39e582c094be216c382dc039576?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#22</span> <span class="badge text-bg-warning">Yuming</span> said
    
    <span class="flask-moment" data-timestamp="2024-05-10T21:09:13Z" data-function="fromNow" data-refresh="0" style="display: none">2024-05-10T21:09:13Z</span>
  </p>
  <div>
    <p>Hi Miguel,<br>
This project includes code for requesting/generating/refreshing/storing access token in either the frontend React SPA or the backend Flask server, but your Flask Mega project doesn't include any code for handinging cookies or access token, which seems to be handled by browsers and the Flask packages behind the scene.  What is the reason for this difference?  Thanks!</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#23</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2024-05-10T23:36:10Z" data-function="fromNow" data-refresh="0" style="display: none">2024-05-10T23:36:10Z</span>
  </p>
  <div>
    <p>@Yuming: web applications where most of the work is done in the server are better suited to cookie-based authentication, which the browser handles automatically. Rich front ends are a better fit for token-based authentication, but the browser does not manage tokens, so the front end has to do it.</p>
  </div>
</div>
    </li>
    
  </ul>
</div>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item disabled"><a class="page-link" href="the-react-mega-tutorial-chapter-8-authentication/page/1.html#comments">&laquo;&laquo;</a></li>
    <li class="page-item disabled"><a class="page-link" href="the-react-mega-tutorial-chapter-8-authentication/page/0.html#comments">&laquo;</a></li>
    <li class="page-item disabled"><a class="page-link" href="the-react-mega-tutorial-chapter-8-authentication/page/0.html#comments">&raquo;</a></li>
    <li class="page-item disabled"><a class="page-link" href="the-react-mega-tutorial-chapter-8-authentication/page/0.html#comments">&raquo;&raquo;</a></li>
  </ul>
</nav>



<div id="comment-form">
  <h3>Leave a Comment</h3>

  
  
  

  
<form action="#comment-form" method="post">
  <input id="url" name="url" type="hidden" value="">
<input id="csrf_token" name="csrf_token" type="hidden" value="IjQyYjY5YzZlNTcyYjFkMTVlZGRkOWJjYjA3ZmFlYWFiNTg3YmU5ODki.ZxdmFg.bvIICqaGiy3jDGtDwX62GPQKUZ8">
    
  <div class="mb-3">
    <label class="form-label" for="name">Name</label>
    <div class="input-group has-validation">
      <input class="form-control" id="name" name="name" required type="text" value="">
    </div>
  </div>

    
    
  <div class="mb-3">
    <label class="form-label" for="email">Email</label>
    <div class="input-group has-validation">
      <input class="form-control" id="email" name="email" required type="text" value="">
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="comment">Comment</label>
    <div class="input-group has-validation">
      <textarea class="form-control" id="comment" name="comment" required>
</textarea>
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="captcha">Captcha</label>
    <div class="input-group has-validation">
      
<script src='https://www.google.com/recaptcha/api.js' async defer></script>
<div class="g-recaptcha" data-sitekey="6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S"></div>

    </div>
  </div>

    
  <input class="btn btn-primary mb-3" id="submit" name="submit" type="submit" value="Submit">

      
</form>

</div>


</div>

      </div>
    </div>
    
    <div class="col-md-4">
      <div id="sidebar">
        
          
  



<div class="card">
  
  
  
  
  <div class="card-header">The React Mega-Tutorial</div>
  <a class="card-book-cover" href="https://amzn.to/3LK7Skg">
    <img src="../static/react-book-small.png">
  </a>
  <div class="card-body">
    <p class="card-text">If you would you like to support my <a href="introducing-the-react-mega-tutorial.html">React Mega-Tutorial series</a> on this blog and as a reward have access to the complete tutorial in book and/or video formats, you can now order it from my <a href="https://courses.miguelgrinberg.com/p/react-mega-tutorial">Courses</a> site or from <a href="https://amzn.to/3LK7Skg">Amazon</a>.</p>
  </div>
  <div class="card-body">
    <a class="card-link" href="https://amzn.to/3LK7Skg">Click here to get the Book!</a><br />
    <a class="card-link" href="https://courses.miguelgrinberg.com/p/react-mega-tutorial">Click here to get the Video Course!</a>
  </div>

  
</div>
        
        <div class="card">
  <div class="card-header">About Miguel</div>
  <div class="card-body">
    <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="../static/miguel.jpg" />
    <p class="card-text">Welcome to my blog!</p>
    <p class="card-text">I'm a software engineer and technical writer, currently living in Drogheda, Ireland.</p>
    <p class="card-text">You can also find me on <a href="https://twitter.com/miguelgrinberg">Twitter</a>, <a href="https://mstdn.social/@miguelgrinberg">Mastodon</a>, <a href="https://github.com/miguelgrinberg">Github</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a>, <a href="https://youtube.com/miguelgrinberg">YouTube</a>, <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a> and <a href="https://patreon.com/miguelgrinberg">Patreon</a>.</p>
    <p class="card-text">Thank you for visiting!</p>
  </div>
</div>
        
        <div class="card" id="categories">
  <div class="card-header">Categories</div>
  <div class="card-body">
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AI/feed"><img src="../static/rss-small.png" title="AI RSS Feed" label="AI RSS Feed" alt="AI RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AI" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AI" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AWS/feed"><img src="../static/rss-small.png" title="AWS RSS Feed" label="AWS RSS Feed" alt="AWS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AWS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AWS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Arduino/feed"><img src="../static/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed" alt="Arduino RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Arduino" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Arduino" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Authentication/feed"><img src="../static/rss-small.png" title="Authentication RSS Feed" label="Authentication RSS Feed" alt="Authentication RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Authentication" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Authentication" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Blog/feed"><img src="../static/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed" alt="Blog RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Blog" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Blog" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/C++/feed"><img src="../static/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed" alt="C++ RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/C++" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="C++" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/CSS/feed"><img src="../static/rss-small.png" title="CSS RSS Feed" label="CSS RSS Feed" alt="CSS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/CSS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="CSS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Cloud/feed"><img src="../static/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed" alt="Cloud RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Cloud" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Cloud" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Database/feed"><img src="../static/rss-small.png" title="Database RSS Feed" label="Database RSS Feed" alt="Database RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Database" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Database" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Docker/feed"><img src="../static/rss-small.png" title="Docker RSS Feed" label="Docker RSS Feed" alt="Docker RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Docker" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Docker" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Filmmaking/feed"><img src="../static/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed" alt="Filmmaking RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Filmmaking" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Filmmaking" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Flask/feed"><img src="../static/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed" alt="Flask RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" /> <small><em>126</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Games/feed"><img src="../static/rss-small.png" title="Games RSS Feed" label="Games RSS Feed" alt="Games RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Games" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Games" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Heroku/feed"><img src="../static/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed" alt="Heroku RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Heroku" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Heroku" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/IoT/feed"><img src="../static/rss-small.png" title="IoT RSS Feed" label="IoT RSS Feed" alt="IoT RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/IoT" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="IoT" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/JavaScript/feed"><img src="../static/rss-small.png" title="JavaScript RSS Feed" label="JavaScript RSS Feed" alt="JavaScript RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/JavaScript" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="JavaScript" /> <small><em>35</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/MicroPython/feed"><img src="../static/rss-small.png" title="MicroPython RSS Feed" label="MicroPython RSS Feed" alt="MicroPython RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/MicroPython" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="MicroPython" /> <small><em>9</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microdot/feed"><img src="../static/rss-small.png" title="Microdot RSS Feed" label="Microdot RSS Feed" alt="Microdot RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microdot" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microdot" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microservices/feed"><img src="../static/rss-small.png" title="Microservices RSS Feed" label="Microservices RSS Feed" alt="Microservices RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microservices" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microservices" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Movie Reviews/feed"><img src="../static/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed" alt="Movie Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Movie Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Movie Reviews" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/OpenStack/feed"><img src="../static/rss-small.png" title="OpenStack RSS Feed" label="OpenStack RSS Feed" alt="OpenStack RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/OpenStack" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="OpenStack" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Personal/feed"><img src="../static/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed" alt="Personal RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Personal" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Personal" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Photography/feed"><img src="../static/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed" alt="Photography RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Photography" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Photography" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Product Reviews/feed"><img src="../static/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed" alt="Product Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Product Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Product Reviews" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Programming/feed"><img src="../static/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed" alt="Programming RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" /> <small><em>187</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Project Management/feed"><img src="../static/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed" alt="Project Management RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Project Management" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Project Management" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Python/feed"><img src="../static/rss-small.png" title="Python RSS Feed" label="Python RSS Feed" alt="Python RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" /> <small><em>169</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/REST/feed"><img src="../static/rss-small.png" title="REST RSS Feed" label="REST RSS Feed" alt="REST RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/REST" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="REST" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Rackspace/feed"><img src="../static/rss-small.png" title="Rackspace RSS Feed" label="Rackspace RSS Feed" alt="Rackspace RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Rackspace" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Rackspace" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Raspberry Pi/feed"><img src="../static/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed" alt="Raspberry Pi RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Raspberry Pi" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Raspberry Pi" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/React/feed"><img src="../static/rss-small.png" title="React RSS Feed" label="React RSS Feed" alt="React RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/React" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="React" /> <small><em>18</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Robotics/feed"><img src="../static/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed" alt="Robotics RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Robotics" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Robotics" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Security/feed"><img src="../static/rss-small.png" title="Security RSS Feed" label="Security RSS Feed" alt="Security RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Security" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Security" /> <small><em>12</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Video/feed"><img src="../static/rss-small.png" title="Video RSS Feed" label="Video RSS Feed" alt="Video RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Video" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Video" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/WebSocket/feed"><img src="../static/rss-small.png" title="WebSocket RSS Feed" label="WebSocket RSS Feed" alt="WebSocket RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/WebSocket" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="WebSocket" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Webcast/feed"><img src="../static/rss-small.png" title="Webcast RSS Feed" label="Webcast RSS Feed" alt="Webcast RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Webcast" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Webcast" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Windows/feed"><img src="../static/rss-small.png" title="Windows RSS Feed" label="Windows RSS Feed" alt="Windows RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Windows" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Windows" /> <small><em>1</em></small>
      </form>
    </div>
    
  </div>
</div>
        
      </div>
    </div>
    
  </div>
  <div id="footer">
    
    <p>&copy; 2012-<script type="text/javascript">document.write(new Date().getFullYear());</script> by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster _at_ miguelgrinberg _dot_ com">Questions?</a></p>
  </div>
</div>

  
    <script src="../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../static/prettify.js"></script>
  <script src="../../cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous"></script>

<script>
moment.locale("en");
function flask_moment_render(elem) {{
    const timestamp = moment(elem.dataset.timestamp);
    const func = elem.dataset.function;
    const format = elem.dataset.format;
    const timestamp2 = elem.dataset.timestamp2;
    const no_suffix = elem.dataset.nosuffix;
    const units = elem.dataset.units;
    let args = [];
    if (format)
        args.push(format);
    if (timestamp2)
        args.push(moment(timestamp2));
    if (no_suffix)
        args.push(no_suffix);
    if (units)
        args.push(units);
    elem.textContent = timestamp[func].apply(timestamp, args);
    elem.classList.remove('flask-moment');
    elem.style.display = "";
}}
function flask_moment_render_all() {{
    const moments = document.querySelectorAll('.flask-moment');
    moments.forEach(function(moment) {{
        flask_moment_render(moment);
        const refresh = moment.dataset.refresh;
        if (refresh && refresh > 0) {{
            (function(elem, interval) {{
                setInterval(function() {{
                    flask_moment_render(elem);
                }}, interval);
            }})(moment, refresh);
        }}
    }})
}}
document.addEventListener("DOMContentLoaded", flask_moment_render_all);
</script>

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-20EHZP9GRZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-20EHZP9GRZ');
  </script>
  
  <script type="text/javascript">
    function setThemeUI() {
      document.getElementById('select-theme-auto').classList.remove('active');
      document.getElementById('select-theme-light').classList.remove('active');
      document.getElementById('select-theme-dark').classList.remove('active');
      const theme = getPreferredTheme();
      const actualTheme = document.documentElement.getAttribute('data-bs-theme', 'light');
      document.getElementById('select-theme-' + theme).classList.add('active');
      document.getElementById('current-theme').href.baseVal = `#icon-theme-${actualTheme}`;
    };

    function updateTheme(theme) {
      if (theme === 'auto') {
        localStorage.removeItem('theme')
      }
      else {
        localStorage.setItem('theme', theme)
      }
      setTheme(getPreferredTheme());
    }

    setThemeUI();

    const darkModePreference = window.matchMedia("(prefers-color-scheme: dark)");
    darkModePreference.addEventListener("change", e => {
      if (getPreferredTheme() === 'auto') {
        setTheme('auto');
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      // add prettyprint class to all <pre><code></code></pre> blocks
      let prettify = false;
      document.querySelectorAll('div.post-body pre code').forEach((code) => {
        code.parentNode.classList.add('prettyprint');
        prettify = true;
      });
      prettyPrint();
    });
  </script>

  </body>

<!-- Mirrored from blog.miguelgrinberg.com/post/the-react-mega-tutorial-chapter-8-authentication by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 08:47:49 GMT -->
</html>