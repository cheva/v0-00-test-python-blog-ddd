<!doctype html>
<html lang="en">
  
<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic/page/1 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 09:37:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
  <script type="text/javascript">
    function getPreferredTheme() {
      const storedTheme = localStorage.getItem('theme')
      if (storedTheme) {
        return storedTheme
      }
      return 'auto';
    }

    function setTheme(theme) {
      if (theme === 'auto') {
        theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
      }
      document.documentElement.setAttribute('data-bs-theme', theme);
    };

    setTheme(getPreferredTheme());
  </script>
  
    <title>
  
    The Flask Mega-Tutorial, Part XX: Some JavaScript Magic - miguelgrinberg.com
  
</title>
  
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="description" content="miguelgrinberg.com">
  <meta name="copyright" content="Copyright (c) 2012-2024 Miguel Grinberg">
  <meta name="author" content="Miguel Grinberg">
  
  <meta name="keywords" content="flask, python, programming, javascript, client-side, jquery, bootstrap">
  
  
  <link rel="canonical" href="../../the-flask-mega-tutorial-part-xx-some-javascript-magic.html">
  

  
    <link href="../../../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&amp;display=swap" rel="stylesheet">

  <link href="../../../static/tomorrow.min.css" type="text/css" rel="stylesheet" />
  <link href="../../../static/tomorrow-night.min.css" type="text/css" rel="stylesheet" />
  <link href="../../../static/social.css" rel="stylesheet" type="text/css" />
  <link href="../../../static/style_20231230.css" rel="stylesheet" type="text/css" />

  <link rel="shortcut icon" href="https://blog.miguelgrinberg.com/static/favicon.ico">
  <link rel="alternate" type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed" title="miguelgrinberg.com RSS feed">

    <meta property="og:title" content="The Flask Mega-Tutorial, Part XX: Some JavaScript Magic">
    <meta property="og:description" content="This is the twentieth installment of the Flask Mega-Tutorial series, in which I&#39;m going to add a nice popup when you hover your mouse over a user&#39;s nickname.You are reading the 2024 edition of the…">
    <meta property="og:image" content="https://blog.miguelgrinberg.com/static/cards/the-flask-mega-tutorial-part-xx-some-javascript-magic.jpg">
    <meta property="og:url" content="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic">
    <meta name="twitter:title" content="The Flask Mega-Tutorial, Part XX: Some JavaScript Magic">
    <meta name="twitter:description" content="This is the twentieth installment of the Flask Mega-Tutorial series, in which I&#39;m going to add a nice popup when you hover your mouse over a user&#39;s nickname.You are reading the 2024 edition of the…">
    <meta name="twitter:image" content="https://blog.miguelgrinberg.com/static/cards/the-flask-mega-tutorial-part-xx-some-javascript-magic.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@miguelgrinberg">

  </head>
  <body>
    <svg style="display: none" version="2.0">
      <defs>
        <symbol id="icon-theme-auto" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-circle-half" viewBox="0 0 16 16">
          <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16"/>
        </symbol>
        <symbol id="icon-theme-light" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-brightness-high-fill" viewBox="0 0 16 16">
          <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </symbol>
        <symbol id="icon-theme-dark" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-moon-stars-fill" viewBox="0 0 16 16">
          <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"/>
          <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
        </symbol>
      </defs>
    </svg>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="https://blog.miguelgrinberg.com/index">miguelgrinberg.com</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" aria-current="page" href="https://blog.miguelgrinberg.com/index">Home</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../my-courses-and-books.html">My Courses and Books</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../hire-me.html">Consulting</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../about-me.html">About Me</a></li>
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <svg width="20" height="20" version="2.0"><use id="current-theme" href="#icon-theme-light"></svg>
          </a>
          <ul class="dropdown-menu">
            <li>
              <a id="select-theme-light" class="dropdown-item" href="javascript:updateTheme('light')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-light"></svg>&nbsp; Light Mode
              </a>
            </li>
            <li>
              <a id="select-theme-dark" class="dropdown-item" href="javascript:updateTheme('dark')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-dark"></svg>&nbsp; Dark Mode
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a id="select-theme-auto" class="dropdown-item" href="javascript:updateTheme('auto')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-auto"></svg>&nbsp; System Default
              </a>
            </li>
          </ul>
        </li>
        
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item social-icons">
          <a type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed"><img src="../../../static/social/rss.png" alt="RSS Feed" title="RSS Feed" /></a>
          <a href="https://twitter.com/miguelgrinberg"><img src="../../../static/social/twitter.png" alt="Twitter" title="Twitter" /></a>
          <a rel="me" href="https://mstdn.social/@miguelgrinberg"><img src="../../../static/social/mastodon.png" alt="Mastodon" title="Mastodon" /></a>
          <a href="http://github.com/miguelgrinberg"><img src="../../../static/social/github.png" alt="GitHub" title="GitHub" /></a>
          <a href="https://youtube.com/miguelgrinberg"><img src="../../../static/social/youtube.png" alt="YouTube" title="YouTube" /></a>
          <a href="http://www.linkedin.com/in/miguelgrinberg"><img src="../../../static/social/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
          <a href="https://patreon.com/miguelgrinberg"><img src="../../../static/social/patreon.png" alt="Patreon" title="Patreon" /></a>
          <!--<a href="https://www.facebook.com/miguelgrinbergblog"><img src="/static/social/facebook.png" alt="Facebook" title="Facebook" /></a>-->
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row">
    <div class="col-md-8">
      <div id="main">
        
        
        
        
        

<div class="post">

<div class="post-header">
  <h1><a href="../../the-flask-mega-tutorial-part-xx-some-javascript-magic.html">The Flask Mega-Tutorial, Part XX: Some JavaScript Magic</a></h1>
  <h2>
    Posted by
    <form action="https://blog.miguelgrinberg.com/author/Miguel Grinberg" method="POST">
      <input type="submit" class="btn btn-danger btn-sm" value="Miguel Grinberg" />
    </form>
    on
    <button class="btn btn-secondary btn-sm" disabled><span class="flask-moment" data-timestamp="2023-12-03T10:40:21Z" data-function="format" data-format="LL" data-refresh="0" style="display: none">2023-12-03T10:40:21Z</span></button>
    under
    
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/JavaScript" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="JavaScript" />
      </form>
    
    
  </h2>
</div>
<div class="post-body"><p>This is the twentieth installment of the Flask Mega-Tutorial series, in which I'm going to add a nice popup when you hover your mouse over a user's nickname.</p>
<p>You are reading the 2024 edition of the Flask Mega-Tutorial. The complete course is also available to order in e-book and paperback formats from <a href="https://amzn.to/3ahVnPN">Amazon</a>. Thank you for your support!</p>
<p>If you are looking for the 2018 edition of this course, you can find it <a href="../../the-flask-mega-tutorial-part-i-hello-world-2018.html">here</a>.</p>
<p>For your reference, here is the complete list of articles in this series:</p>
<ul>
<li><a href="../../the-flask-mega-tutorial-part-i-hello-world.html">Chapter 1:  Hello, World!</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ii-templates.html">Chapter 2:  Templates</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iii-web-forms.html">Chapter 3:  Web Forms</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iv-database.html">Chapter 4:  Database</a></li>
<li><a href="../../the-flask-mega-tutorial-part-v-user-logins.html">Chapter 5:  User Logins</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vi-profile-page-and-avatars.html">Chapter 6:  Profile Page and Avatars</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vii-error-handling.html">Chapter 7:  Error Handling</a></li>
<li><a href="../../the-flask-mega-tutorial-part-viii-followers.html">Chapter 8:  Followers</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ix-pagination.html">Chapter 9:  Pagination</a></li>
<li><a href="../../the-flask-mega-tutorial-part-x-email-support.html">Chapter 10:  Email Support</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xi-facelift.html">Chapter 11:  Facelift</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xii-dates-and-times.html">Chapter 12:  Dates and Times</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiii-i18n-and-l10n.html">Chapter 13:  I18n and L10n</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiv-ajax.html">Chapter 14:  Ajax</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xv-a-better-application-structure.html">Chapter 15:  A Better Application Structure</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvi-full-text-search.html">Chapter 16:  Full-Text Search</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux.html">Chapter 17:  Deployment on Linux</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xviii-deployment-on-heroku.html">Chapter 18:  Deployment on Heroku</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xix-deployment-on-docker-containers.html">Chapter 19:  Deployment on Docker Containers</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xx-some-javascript-magic.html">Chapter 20:  Some JavaScript Magic</a> (this article)</li>
<li><a href="../../the-flask-mega-tutorial-part-xxi-user-notifications.html">Chapter 21:  User Notifications</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xxii-background-jobs.html">Chapter 22:  Background Jobs</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xxiii-application-programming-interfaces-apis.html">Chapter 23:  Application Programming Interfaces (APIs)</a></li>
</ul>
<p>Nowadays, it is impossible to build a web application that doesn't use at least a bit of JavaScript. As I'm sure you know, the reason is that JavaScript is the only language that runs natively in web browsers. In <a href="../../the-flask-mega-tutorial-part-xiv-ajax.html">Chapter 14</a> you saw me add a simple JavaScript enabled link in a Flask template to provide real-time language translations of blog posts. In this chapter I'm going to dig deeper into the topic and show you another useful JavaScript trick to make the application more interesting and engaging to users.</p>
<p>A common user interface pattern for social sites in which users can interact with each other is to show a quick summary of a user in a popup panel when you hover over the user's name, anywhere it appears on the page. If you have never paid attention to this, go to Twitter, Facebook, LinkedIn, or any other major social network, and when you see a username, just leave your mouse pointer on top of it for a couple of seconds to see the popup appear. This chapter is going to be dedicated to building that feature for Microblog, of which you can see a preview below:</p>
<p><img alt="User Popup" src="../../../static/images/mega-tutorial/ch20-demo.png" /></p>
<p><em>The GitHub links for this chapter are: <a href="https://github.com/miguelgrinberg/microblog/tree/v0.20">Browse</a>, <a href="../../../../codeload.github.com/miguelgrinberg/microblog/zip/refs/tags/microblog-0.20.zip">Zip</a>, <a href="../../../../github.com/miguelgrinberg/microblog/compare/v0.19...v0.html">Diff</a>.</em></p>
<h2>Server-side Support</h2>
<p>Before we delve into the client-side, let's get the server work that is necessary to support these user popups out of the way. The contents of the user popup are going to be returned by a new route, which is going to be a simplified version of the existing user profile route. Here is the view function:</p>
<p class="code_title"><em>app/main/routes.py</em>: User popup view function.</p>

<pre><code class="language-python">@bp.route('/user/&lt;username&gt;/popup')
@login_required
def user_popup(username):
    user = db.first_or_404(sa.select(User).where(User.username == username))
    form = EmptyForm()
    return render_template('user_popup.html', user=user, form=form)
</code></pre>
<p>This route is going to be attached to the <em>/user/&lt;username&gt;/popup</em> URL, and will simply load the requested user and then render a template with it. The template is a shorter version of the one used for the user profile page:</p>
<p class="code_title"><em>app/templates/user_popup.html</em>: User popup template.</p>

<pre><code class="language-html">&lt;div&gt;
  &lt;img src=&quot;{{ user.avatar(64) }}&quot; style=&quot;margin: 5px; float: left&quot;&gt;
  &lt;p&gt;&lt;a href=&quot;{{ url_for('main.user', username=user.username) }}&quot;&gt;{{ user.username }}&lt;/a&gt;&lt;/p&gt;
  {% if user.about_me %}&lt;p&gt;{{ user.about_me }}&lt;/p&gt;{% endif %}
  &lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;
  {% if user.last_seen %}
  &lt;p&gt;{{ _('Last seen on') }}: {{ moment(user.last_seen).format('lll') }}&lt;/p&gt;
  {% endif %}
  &lt;p&gt;{{ _('%(count)d followers', count=user.followers_count()) }}, {{ _('%(count)d following', count=user.following_count()) }}&lt;/p&gt;
  {% if user != current_user %}
    {% if not current_user.is_following(user) %}
    &lt;p&gt;
      &lt;form action=&quot;{{ url_for('main.follow', username=user.username) }}&quot; method=&quot;post&quot;&gt;
        {{ form.hidden_tag() }}
        {{ form.submit(value=_('Follow'), class_='btn btn-outline-primary btn-sm') }}
      &lt;/form&gt;
    &lt;/p&gt;
    {% else %}
    &lt;p&gt;
      &lt;form action=&quot;{{ url_for('main.unfollow', username=user.username) }}&quot; method=&quot;post&quot;&gt;
        {{ form.hidden_tag() }}
        {{ form.submit(value=_('Unfollow'), class_='btn btn-outline-primary btn-sm') }}
      &lt;/form&gt;
    &lt;/p&gt;
    {% endif %}
  {% endif %}
&lt;/div&gt;
</code></pre>
<p>The popover components that I will add in the following sections will invoke this route when the user hovers the mouse pointer over a username. In response the server will return the HTML content for the popup, which the client will display. When the user moves the mouse away the popup will be removed.</p>
<h2>Introduction to the Bootstrap Popover Component</h2>
<p>In <a href="../../the-flask-mega-tutorial-part-xi-facelift.html">Chapter 11</a> I introduced you to the Bootstrap framework as a convenient way to create great looking web pages. So far, I have used only a minimal portion of this framework. Bootstrap comes bundled with many common UI elements, all of which have demos and examples in the Bootstrap documentation at <em>https://getbootstrap.com</em>. One of these components is the <a href="https://getbootstrap.com/docs/5.3/components/popovers/">Popover</a>, which is described in the documentation as a "small overlay of content, for housing secondary information". Exactly what I need!</p>
<p>Most Bootstrap components are defined through HTML markup that references the Bootstrap CSS definitions that add the nice styling. Some of the most advanced ones also require JavaScript. The standard way in which an application includes these components in a web page is by adding the HTML in the proper place, and then for the components that need scripting support, calling a JavaScript function that initializes it or activates it. The popover component does require JavaScript support.</p>
<p>To begin, I just need to decide which elements in the page are going to trigger popovers to appear. For this I'm going to use the clickable usernames that appear in each post. The <em>app/templates/_post.html</em> sub-template has the username already defined:</p>
<pre><code class="language-html">            &lt;a href=&quot;{{ url_for('main.user', username=post.author.username) }}&quot;&gt;
                {{ post.author.username }}
            &lt;/a&gt;
</code></pre>
<p>Now according to the popover documentation, I need to create an object of class <code>bootstrap.Popover</code> for each of the links like the one above that appear on the page, and this will initialize the popovers. Unfortunately, after reading this I ended up with more questions than answers, because this component does not appear to be designed to work in the way I need it to. The following is a list of problems I need to solve to implement this feature:</p>
<ul>
<li>There will be many username links in the page, one for each blog post displayed. I need to have a way to find all these links so that I can then initialize them as popovers in a JavaScript function that runs before the user has a chance to interact with the page.</li>
<li>The popover examples in the Bootstrap documentation all provide the content of the popover as a <code>data-bs-content</code> attribute added to the target HTML element. That is really inconvenient for me, because I want to make an Ajax call to the server to get the content to display in the popover.</li>
<li>When using the "hover" mode, the popup will stay visible for as long as you keep the mouse pointer within the target element. When you move the mouse away, the popup will go away. This has the ugly side effect that if the user wants to move the mouse pointer into the popup itself, the popup will disappear. I will need to figure out a way to extend the hover behavior to also include the popup, so that the user can move into the popup and, for example, click on a link there.</li>
</ul>
<p>It is actually not that uncommon when working with browser based applications that things get complicated really fast. You have to think very specifically in terms of how the DOM elements interact with each other and make them behave in a way that gives the user a good experience. In the sections that follow I will be looking at the above problems one by one.</p>
<h2>Executing a Function On Page Load</h2>
<p>The popover component needs to be explicitly initialized with JavaScript, so it is clear that I'm going to need to run some code as soon as each page loads that will search for all the links to usernames in the page, and initialize popover components from Bootstrap on them.</p>
<p>The standard way in modern browsers to run initialization code after the page finished loading is to define a handler for the <code>DOMContentLoaded</code> event. I can add this handler in the <em>app/templates/base.html</em> template, so that this runs on every page of the application:</p>
<p class="code_title"><em>app/templates/base.html</em>: Run function after page load.</p>

<pre><code class="language-html">...
&lt;script&gt;
    // ...

    function initialize_popovers() {
      // write initialization code here
    }
    document.addEventListener('DOMContentLoaded', initialize_popovers);
&lt;/script&gt;
</code></pre>
<p>As you see, I have added my initialization function inside the <code>&lt;script&gt;</code> element in which I defined the <code>translate()</code> function in <a href="../../the-flask-mega-tutorial-part-xiv-ajax.html">Chapter 14</a>.</p>
<h2>Finding DOM Elements with Selectors</h2>
<p>My next problem is to write the JavaScript logic that finds all the user links in the page.</p>
<p>If you recall from <a href="../../the-flask-mega-tutorial-part-xiv-ajax.html">Chapter 14</a>, the HTML elements that were involved in the live translations had unique IDs. For example, a post with ID=123 had a <code>id="post123"</code> attribute added. Then I could use the <code>document.getElementById()</code> function to locate this element in the DOM. This function is part of a group that allow applications running in the browser to find elements based on their characteristics.</p>
<p>For the translation feature I had to find a specific element that had an <code>id</code> attribute, which uniquely identifies elements on the page. Another search option that is more appropriate when looking for groups of elements is to add a CSS <code>class</code> to them. Unlike <code>id</code>, the <code>class</code> attribute can be assigned to multiple elements, so it is ideal for finding all the links that need popovers. What I'm going to do is mark all the user links with a <code>class="user_popup"</code> attribute, and then I will get the list of links from JavaScript with <code>document.getElementsByClassName('user_popup')</code>. The return value in this case would be a collection of all the elements that have the class.</p>
<p class="code_title"><em>app/templates/base.html</em>: Run function after page load.</p>

<pre><code class="language-html">...
&lt;script&gt;
    // ...

    function initialize_popovers() {
      const popups = document.getElementsByClassName('user_popup');
      for (let i = 0; i &lt; popups.length; i++) {
        // create popover here
      }
    }
    document.addEventListener('DOMContentLoaded', initialize_popovers);
&lt;/script&gt;
</code></pre>
<h2>Popovers and the DOM</h2>
<p>In the previous section I've added initialization code that looks for all the elements in the page that have been assigned the class <code>user_popup</code>. This class needs to be added to the username links, which are defined in the <em>_post.html</em> template page.</p>
<p class="code_title"><em>app/templates/_post.html</em>: User popup template.</p>

<pre><code class="language-html">...
        {% set user_link %}
            &lt;a class=&quot;user_popup&quot;
            href=&quot;{{ url_for('main.user', username=post.author.username) }}&quot;&gt;
                {{ post.author.username }}
            &lt;/a&gt;
        {% endset %}
...
</code></pre>
<p>If you are wondering where the popover HTML elements are defined, the good news is that I don't have to worry about that. When I create the <code>Popover</code> object the Bootstrap framework will dynamically insert the elements associated with the popup for me.</p>
<h2>Creating the Popover Components</h2>
<p>Now I'm ready to create the Popover components for all the username links found on the page.</p>
<p class="code_title"><em>app/templates/base.html</em>: Hover delay.</p>

<pre><code class="language-javascript">      function initialize_popovers() {
        const popups = document.getElementsByClassName('user_popup');
        for (let i = 0; i &lt; popups.length; i++) {
          const popover = new bootstrap.Popover(popups[i], {
            content: 'Loading...',
            trigger: 'hover focus',
            placement: 'right',
            html: true,
            sanitize: false,
            delay: {show: 500, hide: 0},
            container: popups[i],
            customClass: 'd-inline',
          });
        }
      }
      document.addEventListener('DOMContentLoaded', initialize_popovers);
</code></pre>
<p>The <code>bootstrap.Popover</code> constructor takes the element that is getting a popover as first argument, and an object with options as second argument. Options include the content that will appear in the popup, what method to use to trigger the popup to appear or disappear (a click, hovering over the element, etc.), the placement of the popover, if the content is plain text or HTML, and a few more options.</p>
<p>I mentioned above that a big problem with this popover implementation is that the HTML contents that need to be displayed are obtained by making a request to the server. For that reason, I initialize the content with a <code>Loading...</code> text, which is going to be dynamically replaced once the HTML contents of the user are received from the server. In preparation for this, I set the <code>html</code> option to <code>true</code>, and also disable an option to sanitize the HTML content. Sanitizing HTML is a security feature that is very important to use when the content comes from users. In this use case, the HTML content is generated by the Flask server through a Jinja template, which sanitizes all dynamic contents by default.</p>
<p>The <code>delay</code> option configures the popover component to appear after half a second of hovering. No delay is configured when the popover is removed as a result of the user moving the mouse pointer away. The <code>container</code> option tells Bootstrap to insert the popover component as a child of the link element. This is a frequently recommended trick to allow the user to move the mouse pointer into the popover without causing the popover to disappear. The <code>customClass</code> option gives the <code>&lt;div&gt;</code> element that represents the popover component a display style of <code>inline</code>. This ensures that when the component is inserted it does not indirectly adds a line break at that place in the page due to the default display style for <code>&lt;div&gt;</code> elements being <code>block</code>.</p>
<h2>Ajax Requests</h2>
<p>Ajax requests are not a new topic, as I have introduced this topic back in <a href="../../the-flask-mega-tutorial-part-xiv-ajax.html">Chapter 14</a> as part of the live language translation feature. As before, I'm going to use the <code>fetch()</code> function to send an asynchronous request to the server.</p>
<p>The request needs to have the <em>/user/&lt;username&gt;/popup</em> URL, which I added to the application at the start of this chapter. The response from this request is going to contain the HTML that I need to insert in the popover component, replacing the initial "Loading..." message.</p>
<p>My first problem is how to trigger the request at the time a popover is requested by the user by hovering over a user link. Going through the Popover documentation, the section that describes the events this component supports includes one called <code>show.bs.popover</code>, which fires when the popover component is about to be shown.</p>
<p class="code_title"><em>app/templates/base.html</em>: Hover delay.</p>

<pre><code class="language-javascript">      function initialize_popovers() {
        const popups = document.getElementsByClassName('user_popup');
        for (let i = 0; i &lt; popups.length; i++) {
          const popover = new bootstrap.Popover(popups[i], {
            ...
          });
          popups[i].addEventListener('show.bs.popover', async (ev) =&gt; {
            // send request here
          });
        }
      }
      document.addEventListener('DOMContentLoaded', initialize_popovers);
</code></pre>
<p>The next issue is how to know what is the username that I need to include in the URL of this request. This name is in the text of the <code>&lt;a&gt;</code> link. The show event for the popover component receives an <code>ev</code> argument, with the event object. The element that triggered the event can be obtained with <code>ev.target</code>, and the expression to extract the text of this link is:</p>
<pre><code class="language-javascript">ev.target.innerText.trim()
</code></pre>
<p>The <code>innerText</code> property of a page element returns the text contents of the node. The text is returned without any trimming, so for example, if you have the <code>&lt;a&gt;</code> in one line, the text in the following line, and the closing <code>&lt;/a&gt;</code> in another line, <code>innerText</code> will return the newlines and extra whitespace that surrounds the text. To eliminate all that whitespace and leave just the text, I use the <code>trim()</code> JavaScript function.</p>
<p>And that is all the information I need to be able to issue the request to the server:</p>
<p class="code_title"><em>app/templates/base.html</em>: XHR request.</p>

<pre><code class="language-javascript">      function initialize_popovers() {
        const popups = document.getElementsByClassName('user_popup');
        for (let i = 0; i &lt; popups.length; i++) {
          const popover = new bootstrap.Popover(popups[i], {
            ...
          });
          popups[i].addEventListener('show.bs.popover', async (ev) =&gt; {
            const response = await fetch('/user/' + ev.target.innerText.trim() + '/popup');
            const data = await response.text();
            // update popover here
          });
        }
      }
      document.addEventListener('DOMContentLoaded', initialize_popovers);
</code></pre>
<p>Here I'm using the <code>fetch()</code> function to request the <em>/popup</em> URL for the user represented by the link element. Unfortunately when building URLs directly in the JavaScript side I cannot use the <code>url_for()</code> from Flask, so in this case I have to concatenate the URL parts explicitly. Once I have the response, I extract the text from it in <code>data</code>. This is the HTML that needs to be stored in the popover component.</p>
<h2>Popover Update</h2>
<p>So finally I can now update my popover component with the HTML that was received from the server and that is stored in the <code>data</code> constant:</p>
<p class="code_title"><em>app/templates/base.html</em>: Display popover.</p>

<pre><code class="language-javascript">      function initialize_popovers() {
        const popups = document.getElementsByClassName('user_popup');
        for (let i = 0; i &lt; popups.length; i++) {
          const popover = new bootstrap.Popover(popups[i], {
            ...
          });
          popups[i].addEventListener('show.bs.popover', async (ev) =&gt; {
            if (ev.target.popupLoaded) {
              return;
            }
            const response = await fetch('/user/' + ev.target.innerText.trim() + '/popup');
            const data = await response.text();
            const popover = bootstrap.Popover.getInstance(ev.target);
            if (popover &amp;&amp; data) {
              ev.target.popupLoaded = true;
              popover.setContent({'.popover-body': data});
              flask_moment_render_all();
            }
          });
        }
      }
      document.addEventListener('DOMContentLoaded', initialize_popovers);
</code></pre>
<p>To do this update I first obtain the popover component, which Bootstrap makes available through the <code>getInstance()</code> method. If I have a popover component and HTML contents, then I call the popover's <code>setContent()</code> method to update its body.</p>
<p>As an optimization, I also set a <code>popupLoaded</code> attribute to <code>true</code> in the link element. This is so that I don't resend the same request if the popover is opened a second time. Note how I updated the start of the <code>show</code> event handler to check for this <code>popupLoaded</code> attribute and if it is set, then just return, since the contents of the popover were already updated.</p>
<p>One last detail that needs to be taken care of is the dates and times that are included in the HTML contents that are inserted in the popover components. These timestamps are generated with Flask-Moment's <code>moment()</code> function in the Jinja template. Flask-Moment adds JavaScript code to the page that renders all the timestamps when the page is loaded. When new timestamps are added dynamically after the page has loaded, the <code>flask_moment_render_all()</code> function needs to be called manually render them, so I inserted a call to this function after updating the HTML content.</p>
<p>Continue on to the <a href="../../the-flask-mega-tutorial-part-xxi-user-notifications.html">next chapter</a>.</p></div>

<div class="card patreon-bar">
  <div class="card-body">
    <h5>Become a Patron!</h5>
    <p class="card-text">Hello, and thank you for visiting my blog! If you enjoyed this article, please consider supporting my work on this blog on <a href="https://patreon.com/miguelgrinberg">Patreon</a>!</p>
    <a href="https://patreon.com/miguelgrinberg" alt="Become a Patron!" title="Become a Patron!"><img src="../../../static/patreon-button.png"></a>
  </div>
</div>


<div class="card social-bar">
  <div class="card-body">
    <h5>Share this post:</h5>
      <!-- Sharingbutton Hacker News -->
      <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic&amp;t=The%20Flask%20Mega-Tutorial%2C%20Part%20XX%3A%20Some%20JavaScript%20Magic" target="_blank" rel="noopener" aria-label="Hacker News">
        <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg></div>Hacker News</div>
      </a>

      <!-- Sharingbutton Reddit -->
      <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic&amp;resubmit=true&amp;title=The%20Flask%20Mega-Tutorial,%20Part%20XX:%20Some%20JavaScript%20Magic" target="_blank" rel="noopener" aria-label="Reddit">
        <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div>Reddit</div>
      </a>

      <!-- Sharingbutton Twitter -->
      <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=The%20Flask%20Mega-Tutorial%2C%20Part%20XX%3A%20Some%20JavaScript%20Magic&amp;url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic" target="_blank" rel="noopener" aria-label="Twitter">
        <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div>Twitter</div>
      </a>

      <!-- Sharingbutton LinkedIn -->
      <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic&amp;title=The%20Flask%20Mega-Tutorial%2C%20Part%20XX%3A%20Some%20JavaScript%20Magic&amp;summary=The%20Flask%20Mega-Tutorial%2C%20Part%20XX%3A%20Some%20JavaScript%20Magic&amp;source=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic" target="_blank" rel="noopener" aria-label="LinkedIn">
        <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div>LinkedIn</div>
      </a>

      <!-- Sharingbutton Facebook -->
      <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic" target="_blank" rel="noopener" aria-label="Facebook">
        <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div>Facebook</div>
      </a>

      <!-- Sharingbutton E-Mail -->
      <a class="resp-sharing-button__link" href="mailto:?subject=The%20Flask%20Mega-Tutorial%2C%20Part%20XX%3A%20Some%20JavaScript%20Magic&amp;body=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic" target="_self" rel="noopener" aria-label="E-Mail">
        <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div>E-Mail</div>
      </a>

  </div>
</div>

<div id="comments" class="post-comment-count">
  
  <a class="btn btn-outline-secondary" href="../../the-flask-mega-tutorial-part-xx-some-javascript-magic.html#comments">3 comments</a>
  
</div>


<div class="comments">
  <ul>
    
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/d1c4b329b8ed0f5de077b1ab6cfdff6f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#1</span> <span class="badge text-bg-warning">Kirill Egupov</span> said
    
    <span class="flask-moment" data-timestamp="2024-05-06T18:34:07Z" data-function="fromNow" data-refresh="0" style="display: none">2024-05-06T18:34:07Z</span>
  </p>
  <div>
    <p>Hello, Miguel!<br>
I implemented feature from this chapter but some strange thing happened. When I hover user link first time I see when user was last time but when I hover link second time this information not displayed.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#2</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2024-05-12T22:16:54Z" data-function="fromNow" data-refresh="0" style="display: none">2024-05-12T22:16:54Z</span>
  </p>
  <div>
    <p>@Kirill: did you add the call to <code>flask_moment_render_all()</code>? That call needs to be made every time you update the page with flask-moment elements.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/cd8587ed92213407a35c70faa496da30?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#3</span> <span class="badge text-bg-warning">Chris</span> said
    
    <span class="flask-moment" data-timestamp="2024-10-15T22:21:43Z" data-function="fromNow" data-refresh="0" style="display: none">2024-10-15T22:21:43Z</span>
  </p>
  <div>
    <p>Yo, Miguel!</p>
<p>Just popping in to say how absolutely thrilled I am that someone like you is willing to put out free ressources on the internet to help others learn and grow. And on top of that you update the ressources frequently and answer questions people might have.</p>
<p>People like you are what really drives evolution in a modern society. </p>
<p>If i someday contribute even a fraction of what you have to the generation that comes ofter me, I will consider my life well spend. </p>
<p>Well, that is all.</p>
<p>Thank you so much for all the amazing ressources.</p>
<p>Stay awesome. </p>
<p>br<br>
Chris</p>
  </div>
</div>
    </li>
    
  </ul>
</div>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item disabled"><a class="page-link" href="1.html#comments">&laquo;&laquo;</a></li>
    <li class="page-item disabled"><a class="page-link" href="0.html#comments">&laquo;</a></li>
    <li class="page-item disabled"><a class="page-link" href="0.html#comments">&raquo;</a></li>
    <li class="page-item disabled"><a class="page-link" href="0.html#comments">&raquo;&raquo;</a></li>
  </ul>
</nav>



<div id="comment-form">
  <h3>Leave a Comment</h3>

  
  
  

  
<form action="#comment-form" method="post">
  <input id="url" name="url" type="hidden" value="">
<input id="csrf_token" name="csrf_token" type="hidden" value="IjQyYjY5YzZlNTcyYjFkMTVlZGRkOWJjYjA3ZmFlYWFiNTg3YmU5ODki.ZxdyJA.NVEyAP0MSx_sSqTxQds6wvRIizk">
    
  <div class="mb-3">
    <label class="form-label" for="name">Name</label>
    <div class="input-group has-validation">
      <input class="form-control" id="name" name="name" required type="text" value="">
    </div>
  </div>

    
    
  <div class="mb-3">
    <label class="form-label" for="email">Email</label>
    <div class="input-group has-validation">
      <input class="form-control" id="email" name="email" required type="text" value="">
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="comment">Comment</label>
    <div class="input-group has-validation">
      <textarea class="form-control" id="comment" name="comment" required>
</textarea>
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="captcha">Captcha</label>
    <div class="input-group has-validation">
      
<script src='https://www.google.com/recaptcha/api.js' async defer></script>
<div class="g-recaptcha" data-sitekey="6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S"></div>

    </div>
  </div>

    
  <input class="btn btn-primary mb-3" id="submit" name="submit" type="submit" value="Submit">

      
</form>

</div>


</div>

      </div>
    </div>
    
    <div class="col-md-4">
      <div id="sidebar">
        
          
  



<div class="card">
  
  
  
  
  <div class="card-header">
    <div class="row">
      <div class="col">The Flask Mega-Tutorial</div>
      <div class="col text-end">
        <a href="../../announcing-the-flask-mega-tutorial-2024-edition.html">
          <h5 style="margin-bottom: 0px"><span class="badge text-bg-warning">New 2024 Edition!</span></h5>
        </a>
      </div>
    </div>
  </div>
  <a class="card-book-cover" href="https://amzn.to/3MQffrm">
    <img src="../../../static/mega-tutorial-2024-small.png" alt="The New Flask Mega-Tutorial">
  </a>
  <div class="card-body">
    <p class="card-text">If you would you like to support my work on my <a href="../../the-flask-mega-tutorial-part-i-hello-world.html">Flask Mega-Tutorial series</a> on this blog and as a reward have access to the complete tutorial nicely structured as a book and/or a set of videos, you can now order it from my <a href="https://courses.miguelgrinberg.com/p/flask-mega-tutorial">Courses</a> site or from <a href="https://amzn.to/3MQffrm">Amazon</a>.</p>
  </div>
  <div class="card-body">
    <a class="card-link" href="https://amzn.to/3MQffrm">Click here to get the Book!</a><br />
    <a class="card-link" href="https://courses.miguelgrinberg.com/p/flask-mega-tutorial">Click here to get the Video Course!</a>
  </div>

  
</div>
        
        <div class="card">
  <div class="card-header">About Miguel</div>
  <div class="card-body">
    <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="../../../static/miguel.jpg" />
    <p class="card-text">Welcome to my blog!</p>
    <p class="card-text">I'm a software engineer and technical writer, currently living in Drogheda, Ireland.</p>
    <p class="card-text">You can also find me on <a href="https://twitter.com/miguelgrinberg">Twitter</a>, <a href="https://mstdn.social/@miguelgrinberg">Mastodon</a>, <a href="https://github.com/miguelgrinberg">Github</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a>, <a href="https://youtube.com/miguelgrinberg">YouTube</a>, <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a> and <a href="https://patreon.com/miguelgrinberg">Patreon</a>.</p>
    <p class="card-text">Thank you for visiting!</p>
  </div>
</div>
        
        <div class="card" id="categories">
  <div class="card-header">Categories</div>
  <div class="card-body">
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AI/feed"><img src="../../../static/rss-small.png" title="AI RSS Feed" label="AI RSS Feed" alt="AI RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AI" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AI" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AWS/feed"><img src="../../../static/rss-small.png" title="AWS RSS Feed" label="AWS RSS Feed" alt="AWS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AWS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AWS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Arduino/feed"><img src="../../../static/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed" alt="Arduino RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Arduino" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Arduino" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Authentication/feed"><img src="../../../static/rss-small.png" title="Authentication RSS Feed" label="Authentication RSS Feed" alt="Authentication RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Authentication" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Authentication" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Blog/feed"><img src="../../../static/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed" alt="Blog RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Blog" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Blog" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/C++/feed"><img src="../../../static/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed" alt="C++ RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/C++" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="C++" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/CSS/feed"><img src="../../../static/rss-small.png" title="CSS RSS Feed" label="CSS RSS Feed" alt="CSS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/CSS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="CSS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Cloud/feed"><img src="../../../static/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed" alt="Cloud RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Cloud" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Cloud" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Database/feed"><img src="../../../static/rss-small.png" title="Database RSS Feed" label="Database RSS Feed" alt="Database RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Database" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Database" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Docker/feed"><img src="../../../static/rss-small.png" title="Docker RSS Feed" label="Docker RSS Feed" alt="Docker RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Docker" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Docker" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Filmmaking/feed"><img src="../../../static/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed" alt="Filmmaking RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Filmmaking" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Filmmaking" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Flask/feed"><img src="../../../static/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed" alt="Flask RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" /> <small><em>126</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Games/feed"><img src="../../../static/rss-small.png" title="Games RSS Feed" label="Games RSS Feed" alt="Games RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Games" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Games" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Heroku/feed"><img src="../../../static/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed" alt="Heroku RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Heroku" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Heroku" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/IoT/feed"><img src="../../../static/rss-small.png" title="IoT RSS Feed" label="IoT RSS Feed" alt="IoT RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/IoT" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="IoT" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/JavaScript/feed"><img src="../../../static/rss-small.png" title="JavaScript RSS Feed" label="JavaScript RSS Feed" alt="JavaScript RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/JavaScript" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="JavaScript" /> <small><em>35</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/MicroPython/feed"><img src="../../../static/rss-small.png" title="MicroPython RSS Feed" label="MicroPython RSS Feed" alt="MicroPython RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/MicroPython" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="MicroPython" /> <small><em>9</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microdot/feed"><img src="../../../static/rss-small.png" title="Microdot RSS Feed" label="Microdot RSS Feed" alt="Microdot RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microdot" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microdot" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microservices/feed"><img src="../../../static/rss-small.png" title="Microservices RSS Feed" label="Microservices RSS Feed" alt="Microservices RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microservices" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microservices" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Movie Reviews/feed"><img src="../../../static/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed" alt="Movie Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Movie Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Movie Reviews" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/OpenStack/feed"><img src="../../../static/rss-small.png" title="OpenStack RSS Feed" label="OpenStack RSS Feed" alt="OpenStack RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/OpenStack" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="OpenStack" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Personal/feed"><img src="../../../static/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed" alt="Personal RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Personal" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Personal" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Photography/feed"><img src="../../../static/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed" alt="Photography RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Photography" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Photography" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Product Reviews/feed"><img src="../../../static/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed" alt="Product Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Product Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Product Reviews" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Programming/feed"><img src="../../../static/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed" alt="Programming RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" /> <small><em>187</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Project Management/feed"><img src="../../../static/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed" alt="Project Management RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Project Management" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Project Management" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Python/feed"><img src="../../../static/rss-small.png" title="Python RSS Feed" label="Python RSS Feed" alt="Python RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" /> <small><em>169</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/REST/feed"><img src="../../../static/rss-small.png" title="REST RSS Feed" label="REST RSS Feed" alt="REST RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/REST" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="REST" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Rackspace/feed"><img src="../../../static/rss-small.png" title="Rackspace RSS Feed" label="Rackspace RSS Feed" alt="Rackspace RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Rackspace" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Rackspace" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Raspberry Pi/feed"><img src="../../../static/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed" alt="Raspberry Pi RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Raspberry Pi" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Raspberry Pi" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/React/feed"><img src="../../../static/rss-small.png" title="React RSS Feed" label="React RSS Feed" alt="React RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/React" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="React" /> <small><em>18</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Robotics/feed"><img src="../../../static/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed" alt="Robotics RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Robotics" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Robotics" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Security/feed"><img src="../../../static/rss-small.png" title="Security RSS Feed" label="Security RSS Feed" alt="Security RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Security" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Security" /> <small><em>12</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Video/feed"><img src="../../../static/rss-small.png" title="Video RSS Feed" label="Video RSS Feed" alt="Video RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Video" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Video" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/WebSocket/feed"><img src="../../../static/rss-small.png" title="WebSocket RSS Feed" label="WebSocket RSS Feed" alt="WebSocket RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/WebSocket" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="WebSocket" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Webcast/feed"><img src="../../../static/rss-small.png" title="Webcast RSS Feed" label="Webcast RSS Feed" alt="Webcast RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Webcast" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Webcast" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Windows/feed"><img src="../../../static/rss-small.png" title="Windows RSS Feed" label="Windows RSS Feed" alt="Windows RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Windows" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Windows" /> <small><em>1</em></small>
      </form>
    </div>
    
  </div>
</div>
        
      </div>
    </div>
    
  </div>
  <div id="footer">
    
    <p>&copy; 2012-<script type="text/javascript">document.write(new Date().getFullYear());</script> by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster _at_ miguelgrinberg _dot_ com">Questions?</a></p>
  </div>
</div>

  
    <script src="../../../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../../../static/prettify.js"></script>
  <script src="../../../../cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous"></script>

<script>
moment.locale("en");
function flask_moment_render(elem) {{
    const timestamp = moment(elem.dataset.timestamp);
    const func = elem.dataset.function;
    const format = elem.dataset.format;
    const timestamp2 = elem.dataset.timestamp2;
    const no_suffix = elem.dataset.nosuffix;
    const units = elem.dataset.units;
    let args = [];
    if (format)
        args.push(format);
    if (timestamp2)
        args.push(moment(timestamp2));
    if (no_suffix)
        args.push(no_suffix);
    if (units)
        args.push(units);
    elem.textContent = timestamp[func].apply(timestamp, args);
    elem.classList.remove('flask-moment');
    elem.style.display = "";
}}
function flask_moment_render_all() {{
    const moments = document.querySelectorAll('.flask-moment');
    moments.forEach(function(moment) {{
        flask_moment_render(moment);
        const refresh = moment.dataset.refresh;
        if (refresh && refresh > 0) {{
            (function(elem, interval) {{
                setInterval(function() {{
                    flask_moment_render(elem);
                }}, interval);
            }})(moment, refresh);
        }}
    }})
}}
document.addEventListener("DOMContentLoaded", flask_moment_render_all);
</script>

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-20EHZP9GRZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-20EHZP9GRZ');
  </script>
  
  <script type="text/javascript">
    function setThemeUI() {
      document.getElementById('select-theme-auto').classList.remove('active');
      document.getElementById('select-theme-light').classList.remove('active');
      document.getElementById('select-theme-dark').classList.remove('active');
      const theme = getPreferredTheme();
      const actualTheme = document.documentElement.getAttribute('data-bs-theme', 'light');
      document.getElementById('select-theme-' + theme).classList.add('active');
      document.getElementById('current-theme').href.baseVal = `#icon-theme-${actualTheme}`;
    };

    function updateTheme(theme) {
      if (theme === 'auto') {
        localStorage.removeItem('theme')
      }
      else {
        localStorage.setItem('theme', theme)
      }
      setTheme(getPreferredTheme());
    }

    setThemeUI();

    const darkModePreference = window.matchMedia("(prefers-color-scheme: dark)");
    darkModePreference.addEventListener("change", e => {
      if (getPreferredTheme() === 'auto') {
        setTheme('auto');
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      // add prettyprint class to all <pre><code></code></pre> blocks
      let prettify = false;
      document.querySelectorAll('div.post-body pre code').forEach((code) => {
        code.parentNode.classList.add('prettyprint');
        prettify = true;
      });
      prettyPrint();
    });
  </script>

  </body>

<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xx-some-javascript-magic/page/1 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 09:37:48 GMT -->
</html>