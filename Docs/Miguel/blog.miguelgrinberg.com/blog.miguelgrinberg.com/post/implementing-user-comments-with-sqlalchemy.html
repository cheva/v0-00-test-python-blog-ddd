<!doctype html>
<html lang="en">
  
<!-- Mirrored from blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 09:40:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
  <script type="text/javascript">
    function getPreferredTheme() {
      const storedTheme = localStorage.getItem('theme')
      if (storedTheme) {
        return storedTheme
      }
      return 'auto';
    }

    function setTheme(theme) {
      if (theme === 'auto') {
        theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
      }
      document.documentElement.setAttribute('data-bs-theme', theme);
    };

    setTheme(getPreferredTheme());
  </script>
  
    <title>
  
    Implementing User Comments with SQLAlchemy - miguelgrinberg.com
  
</title>
  
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="description" content="miguelgrinberg.com">
  <meta name="copyright" content="Copyright (c) 2012-2024 Miguel Grinberg">
  <meta name="author" content="Miguel Grinberg">
  
  <meta name="keywords" content="python, database, programming, sqlalchemy, relational, comments, threads, tree, data structures">
  
  
  <link rel="canonical" href="implementing-user-comments-with-sqlalchemy.html">
  

  
    <link href="../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&amp;display=swap" rel="stylesheet">

  <link href="../static/tomorrow.min.css" type="text/css" rel="stylesheet" />
  <link href="../static/tomorrow-night.min.css" type="text/css" rel="stylesheet" />
  <link href="../static/social.css" rel="stylesheet" type="text/css" />
  <link href="../static/style_20231230.css" rel="stylesheet" type="text/css" />

  <link rel="shortcut icon" href="https://blog.miguelgrinberg.com/static/favicon.ico">
  <link rel="alternate" type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed" title="miguelgrinberg.com RSS feed">

    <meta property="og:title" content="Implementing User Comments with SQLAlchemy">
    <meta property="og:description" content="One of the most basic ways to keep the users of your web application engaged is to give them a space to write comments. These days, there are third-party services pretty much for everything, and…">
    <meta property="og:image" content="https://blog.miguelgrinberg.com/static/cards/implementing-user-comments-with-sqlalchemy.jpg">
    <meta property="og:url" content="https://blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy">
    <meta name="twitter:title" content="Implementing User Comments with SQLAlchemy">
    <meta name="twitter:description" content="One of the most basic ways to keep the users of your web application engaged is to give them a space to write comments. These days, there are third-party services pretty much for everything, and…">
    <meta name="twitter:image" content="https://blog.miguelgrinberg.com/static/cards/implementing-user-comments-with-sqlalchemy.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@miguelgrinberg">

  </head>
  <body>
    <svg style="display: none" version="2.0">
      <defs>
        <symbol id="icon-theme-auto" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-circle-half" viewBox="0 0 16 16">
          <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16"/>
        </symbol>
        <symbol id="icon-theme-light" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-brightness-high-fill" viewBox="0 0 16 16">
          <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </symbol>
        <symbol id="icon-theme-dark" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-moon-stars-fill" viewBox="0 0 16 16">
          <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"/>
          <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
        </symbol>
      </defs>
    </svg>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="https://blog.miguelgrinberg.com/index">miguelgrinberg.com</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" aria-current="page" href="https://blog.miguelgrinberg.com/index">Home</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="my-courses-and-books.html">My Courses and Books</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="hire-me.html">Consulting</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="about-me.html">About Me</a></li>
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <svg width="20" height="20" version="2.0"><use id="current-theme" href="#icon-theme-light"></svg>
          </a>
          <ul class="dropdown-menu">
            <li>
              <a id="select-theme-light" class="dropdown-item" href="javascript:updateTheme('light')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-light"></svg>&nbsp; Light Mode
              </a>
            </li>
            <li>
              <a id="select-theme-dark" class="dropdown-item" href="javascript:updateTheme('dark')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-dark"></svg>&nbsp; Dark Mode
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a id="select-theme-auto" class="dropdown-item" href="javascript:updateTheme('auto')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-auto"></svg>&nbsp; System Default
              </a>
            </li>
          </ul>
        </li>
        
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item social-icons">
          <a type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed"><img src="../static/social/rss.png" alt="RSS Feed" title="RSS Feed" /></a>
          <a href="https://twitter.com/miguelgrinberg"><img src="../static/social/twitter.png" alt="Twitter" title="Twitter" /></a>
          <a rel="me" href="https://mstdn.social/@miguelgrinberg"><img src="../static/social/mastodon.png" alt="Mastodon" title="Mastodon" /></a>
          <a href="http://github.com/miguelgrinberg"><img src="../static/social/github.png" alt="GitHub" title="GitHub" /></a>
          <a href="https://youtube.com/miguelgrinberg"><img src="../static/social/youtube.png" alt="YouTube" title="YouTube" /></a>
          <a href="http://www.linkedin.com/in/miguelgrinberg"><img src="../static/social/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
          <a href="https://patreon.com/miguelgrinberg"><img src="../static/social/patreon.png" alt="Patreon" title="Patreon" /></a>
          <!--<a href="https://www.facebook.com/miguelgrinbergblog"><img src="/static/social/facebook.png" alt="Facebook" title="Facebook" /></a>-->
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row">
    <div class="col-md-8">
      <div id="main">
        
        
        
        
        

<div class="post">

<div class="post-header">
  <h1><a href="implementing-user-comments-with-sqlalchemy.html">Implementing User Comments with SQLAlchemy</a></h1>
  <h2>
    Posted by
    <form action="https://blog.miguelgrinberg.com/author/Miguel Grinberg" method="POST">
      <input type="submit" class="btn btn-danger btn-sm" value="Miguel Grinberg" />
    </form>
    on
    <button class="btn btn-secondary btn-sm" disabled><span class="flask-moment" data-timestamp="2017-10-10T15:22:43Z" data-function="format" data-format="LL" data-refresh="0" style="display: none">2017-10-10T15:22:43Z</span></button>
    under
    
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Database" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Database" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" />
      </form>
    
    
  </h2>
</div>
<div class="post-body"><p>One of the most basic ways to keep the users of your web application engaged is to give them a space to write comments. These days, there are third-party services pretty much for everything, and comments is not an exception. <a href="https://disqus.com/">Disqus</a> and <a href="https://facebook.com/">Facebook</a> are popular services that allow you to embed comments into your site.</p>
<p>But what if you don't want to use an external service? In this article, I'm going to show you how I implement comments in Python, using the SQLAlchemy ORM and any of the database engines it supports. I'm going to start with an extremely simple approach, and then will go on to discuss a few advanced implementations with support for multiple levels of replies.</p>
<h2>The Issues with Comment Services</h2>
<p>While offloading your comments to an external service is tempting, there are many reasons why you may not want to do it. The user interface that these services embed into your pages is usually not very flexible, so it may not look well with your site layout. Also, some of your users may find it odd that even though they have an account for your web application, they need to create a second account with another service to write comments.</p>
<p>A valid concern I also heard many other developers mention is the fact that you do not own the comments that appear on your site, and there potential difficulties in exporting this data, should you decide to leave your current provider, or worse the provider deciding to leave you by going out of business.</p>
<p>There is also a security aspect. You may not feel safe trusting information about your users to these large companies that are constantly being attacked by hackers. Just a few days ago, Disqus announced that it has suffered a <a href="https://blog.disqus.com/security-alert-user-info-breach">data breach</a>.</p>
<h2>Base Comment Platform</h2>
<p>If you are not very picky, you can create a basic comment solution with very little effort. Here is a basic SQLAlchemy model that gets the job done:</p>
<pre><code>from datetime import datetime

class Comment(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    text = db.Column(db.String(140))
    author = db.Column(db.String(32))
    timestamp = db.Column(db.DateTime(), default=datetime.utcnow, index=True)
</code></pre>
<p>With this simple model you can keep track of a list of comments. Quick disclaimer: if you are used to working with SQLAlchemy on its own, you will not recognize the <code>db</code> instance that I've used above. For convenience, all the examples in this article use the Flask-SQLAlchemy extension which builds on top of SQLAlchemy, and exposes all the SQLAlchemy attributes from a <code>db</code> database instance. If you are using SQLAlchemy without the Flask extension, you will need to make minor changes to import all the attributes attached to <code>db</code> from their native SQLAlchemy modules.</p>
<p>To add a new comment, you simply create a new <code>Comment</code> instance and write it to the database:</p>
<pre><code>comment = Comment(text='Hello, world!', author='alice')
db.session.add(comment)
db.session.commit()
</code></pre>
<p>Note how I do not worry about the <code>timestamp</code> field, because in the model definition I have it getting the current UTC time by default. Thanks to the auto-timestamping, I can efficiently retrieve all comments sorted by date in ascending or descending order:</p>
<pre><code># oldest comments first
for comment in Comment.query.order_by(Comment.timestamp.asc()):
    print('{}: {}'.format(comment.author, comment.text))

# newest comments first
for comment in Comment.query.order_by(Comment.timestamp.desc()):
    print('{}: {}'.format(comment.author, comment.text))
</code></pre>
<p>To integrate this solution with your application, you may need to change the <code>author</code> field to be a foreign key into your <code>User</code> model instead of being just a string. If you accept comments on many different pages, you may also need to add an additional field that links each comment to the page of your application it belongs, and then that will allow you to retrieve comments for each page by filtering on that field. This is actually the implementation that I have chosen for the comments on this blog.</p>
<p>A simple, yet complete implementation of this technique is available in <a href="https://gist.github.com/miguelgrinberg/39503aabef376dbe215788770b5ae839#file-basic_comments-py">this gist</a>.</p>
<h2>Implementing Comment Replies</h2>
<p>If all you need is a flat list of comments, then the simple implementation in the previous section should do the job nicely. But what if that isn't enough?</p>
<p>For many applications, you may want users to be able to reply to comments made by other users, and then display all these linked comments as hierarchical threads. Believe it or not, this is extremely difficult to do in a relational database.</p>
<p>There are two fairly well-known implementations that address the problem of representing a tree structure in relational form, but unfortunately both have severe limitations. I'll first describe them to you, along with their problems, and then I'll tell you about my own solution, which also has some limitations but they are not as bad as those of the others.</p>
<h3>Adjacency Lists</h3>
<p>The first approach is called <a href="https://en.wikipedia.org/wiki/Adjacency_list">Adjacency List</a> and is actually very simple to implement. The idea is to add a column to the <code>Comment</code> model that tracks the parent of each comment. If each comment has a relationship to its parent, then you can figure out the entire tree structure.</p>
<p>For the model, you would have something like this:</p>
<pre><code>class Comment(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    text = db.Column(db.String(140))
    author = db.Column(db.String(32))
    timestamp = db.Column(db.DateTime(), default=datetime.utcnow, index=True)
    parent_id = db.Column(db.Integer, db.ForeignKey('comment.id'))
    replies = db.relationship(
        'Comment', backref=db.backref('parent', remote_side=[id]),
        lazy='dynamic')
</code></pre>
<p>What I did here is add a self-referential one-to-many relationship to the model I used above. Since each comment now has a <code>parent_id</code> foreign key, I can easily find the direct replies to a given comment just by looking for all comments that have their parent set to that comment.</p>
<p>For example, let's say I want to represent the following comment thread:</p>
<pre><code>alice: hello1
  bob: reply11
    susan: reply111
  susan: reply12
bob: hello2
  alice: reply21
</code></pre>
<p>The code to add the comments with the above structure is shown below:</p>
<pre><code>c1 = Comment(text='hello1', author='alice')
c2 = Comment(text='hello2', author='bob')
c11 = Comment(text='reply11', author='bob', parent=c1)
c12 = Comment(text='reply12', author='susan', parent=c1)
c111 = Comment(text='reply111', author='susan', parent=c11)
c21 = Comment(text='reply21', author='alice', parent=c2)
db.session.add_all([c1, c2, c11, c12, c111, c21])
db.session.commit()
</code></pre>
<p>So far, this is all fairly easy. The problem comes when you need to retrieve the comments in a way that is proper for presentation. There is actually no possible query to retrieve these comments in the correct threaded order. The only way to do it is by issuing recursive queries. The following code uses recursive queries to print the comment thread to the terminal with the proper indentation:</p>
<pre><code>def display_comment(comment, level=0):
    print('{}{}: {}'.format('  ' * level, comment.author, comment.text))
    for reply in comment.replies:
        display_comment(reply, level + 1)

for comment in Comment.query.filter_by(parent=None).order_by(Comment.timestamp.asc()):
    display_comment(comment)
</code></pre>
<p>The for-loop at the bottom retrieves all the top-level comments (those that have no parent), and then for each of them it recursively retrieves their replies in the <code>display_comment()</code> function.</p>
<p>This solution is extremely inefficient. If you have a comment thread with a hundred comments, you will need to issue a hundred additional database queries after the one that gets the top-level comments to reconstruct the entire tree. And if you wanted to paginate your comments, the only thing you can do is paginate the top-level-comments, you can't really paginate the comment thread as a whole.</p>
<p>So while this solution is extremely elegant, in practice you can't really use it unless your dataset is small. You can see a complete implementation of this technique in <a href="https://gist.github.com/miguelgrinberg/39503aabef376dbe215788770b5ae839#file-comments_with_adjacency_list-py">this gist</a>.</p>
<h3>Nested Sets</h3>
<p>The second technique is called <a href="https://en.wikipedia.org/wiki/Nested_set_model">Nested Set</a>. This is a fairly complex solution that adds two columns to the table called <code>left</code> and <code>right</code>, and a third optional one called <code>level</code>. All columns store numbers, and are used to describe the traversal order for the tree structure. When you go down the three you assign sequential numbers to the <code>left</code> field, and when you go up you assigned them to the <code>right</code> field. As a result of this numbering, comments that have no replies have consecutive numbers for their <code>left</code> and <code>right</code>. The <code>level</code> column keeps track of how many levels of parents each comment has.</p>
<p>For example, the comment thread above would be given the following <code>left</code>, <code>right</code> and <code>level</code> values:</p>
<pre><code>alice: hello1        left:  1  right:  8  level: 0
  bob: reply11       left:  2  right:  5  level: 1
    susan: reply111  left:  3  right:  4  level: 2
  susan: reply12     left:  6  right:  7  level: 1
bob: hello2          left:  9  right: 12  level: 0
  alice: reply21     left: 10  right: 11  level: 1
</code></pre>
<p>With this structure, if you want to obtain the replies to a given comment, all you need to do is look for all comments where their <code>left</code> is greater than the parent's <code>left</code> and their <code>right</code> is less than the parent's <code>right</code>. For example, the children of the top post by <code>alice</code> are those with <code>left &gt; 1 and right &lt; 8</code>. The children of the post by bob in the second line are those with <code>left &gt; 2 and right &lt; 5</code>. If you sort the results by <code>left</code>, you get them in the correct threaded order, and then you can use <code>level</code> to determine the indentation to use when you render them on a web page. The big advantage of this method versus adjacency lists is that you can get the comments in the correct threaded order with a single database query, and even use pagination to get a subset of the thread.</p>
<p>You may be thinking that this is actually a pretty clever solution that nicely addresses this problem, but have you considered what the algorithm looks like to assign these three numbers to each comment? That is where the problem with this solution lies. Each time a new comment is added, a potentially large portion of the comments table will have to be updated with new <code>left</code> and <code>right</code> values. When you work with adjacency lists, the insertions are cheap and the queries are expensive. With nested sets it is the reverse, insertions are expensive and queries are cheap.</p>
<p>I have never implemented this algorithm myself, so I do not have example code readily available to show you how it looks, but if you want to see a real-world implementation, the <a href="https://github.com/uralbash/sqlalchemy_mptt">django-mptt</a> project is a great example that works with the Django ORM. You can probably guess that queries are fairly simple from the examples above, but the logic required to insert a new comment is complex and highly inefficient, as a large number of comments might need to be updated depending on where in the tree the new comment is inserted. This solution only makes sense in cases where insertions are uncommon and queries are frequent.</p>
<h3>Thinking Outside the Box</h3>
<p>Unfortunately none of the solutions above worked well for my needs. I came up with a completely different approach that has both efficient inserts and queries, but in exchange has other, less severe limitations.</p>
<p>This solution adds a single column of type text, which I'm going to name <code>path</code>:</p>
<pre><code>class Comment(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    text = db.Column(db.String(140))
    author = db.Column(db.String(32))
    timestamp = db.Column(db.DateTime(), default=datetime.utcnow, index=True)
    path = db.Column(db.Text, index=True)
</code></pre>
<p>Each comment gets assigned a unique, increasing value when it is inserted, pretty much in the same way each comment gets the auto-incrementing <code>id</code> by the database. So the first comment gets a 1, the second gets a 2, and so on. The contents of <code>path</code> for a top-level comment is the value of this counter. But for a reply, <code>path</code> is set to the path of the parent with the counter appended at the end. Using the same comment hierarchy from above examples, here are those comments in the random order they may have been entered, with their <code>path</code> values assigned:</p>
<pre><code>alice: hello1        path: '1'
bob: reply11         path: '1.2'
bob: hello2          path: '3'
susan: reply12       path: '1.4'
susan: reply111      path: '1.2.5'
alice: reply21       path: '3.6'
</code></pre>
<p>For clarity, I have inserted a period in between each path component, but in a real implementation that is not necessary. Now if I run a query on this table that sorts rows by path, I get the correct threaded order. And to know what level of indentation each comment needs to have, I can look at how many components the path have.</p>
<pre><code>alice: hello1        path: '1'    &lt;-- top-level
bob: reply11         path: '1.2'    &lt;-- second-level
susan: reply111      path: '1.2.5'    &lt;-- third-level
susan: reply12       path: '1.4'    &lt;-- second-level
bob: hello2          path: '3'    &lt;-- top-level
alice: reply21       path: '3.6'    &lt;-- second-level
</code></pre>
<p>Inserting a new comment using this method is fairly cheap. I just need to have a way to generate a unique and increasing value to assign to the new comment, which I can, for example, steal from the database assigned <code>id</code>. I also need to know the parent of the comment, so that I can take its <code>path</code> and use it when creating the <code>path</code> of the child comment.</p>
<p>Queries are also cheap. By adding an index on the <code>path</code> column, I can get the comments in the correct threaded order very efficiently, just by sorting by <code>path</code>. And I can also paginate the list.</p>
<p>So if this is all so great, what are the bad news? Take a look at the <code>path</code> assignments in the example above and see if you can spot the limitation.</p>
<p>Did you find it? How many comments do you think this system supports? In the way I constructed this example, you can't really have more than 10 comments (or actually 9, unless you start counting from 0). Sorting by <code>path</code> only works when the numbers that are used in the <code>path</code> field have all the same number of digits, in this example just one. Once a <code>10</code> appears, the sorting breaks, because I'm using strings, so <code>10</code> sorts between <code>1</code> and <code>2</code> and not after <code>9</code>.</p>
<p>So what's the solution? Let's allocate two digits for each component in the path:</p>
<pre><code>alice: hello1        path: '01'
bob: reply11         path: '01.02'
susan: reply111      path: '01.02.05'
susan: reply12       path: '01.04'
bob: hello2          path: '03'
alice: reply21       path: '03.06'
</code></pre>
<p>Now I can go up to 99 comments, if I'm careful to right align and zero-pad each component. But of course this is still too limiting, so instead of two digits you will probably want to use more. If you use six digits, for example, you can have up to a million comments before you run into problems. And if you find that you are approaching the limit with the number of digits that you used, you could take the comments offline for maintenance, regenerate the paths with more digits and then you would be okay again.</p>
<p>The implementation is actually not that bad. I decided to combine this solution with the adjacency list option I presented above, as that gives me an easy and efficient way to obtain the parent given a comment (I could do away with the adjacency list and extract the parent <code>id</code> from the <code>path</code> field, but that seems overly complicated). I encapsulated the comment insertion logic in a <code>save()</code> method in the <code>Comment</code> model, so that it can be invoked easily from any part of the application. Here is the updated model, including the reintroduced adjacency list, the <code>save()</code> method, and as a bonus, a <code>level()</code> method that returns the indentation level of any comment:</p>
<pre><code>class Comment(db.Model):
    _N = 6

    id = db.Column(db.Integer, primary_key=True)
    text = db.Column(db.String(140))
    author = db.Column(db.String(32))
    timestamp = db.Column(db.DateTime(), default=datetime.utcnow, index=True)
    path = db.Column(db.Text, index=True)
    parent_id = db.Column(db.Integer, db.ForeignKey('comment.id'))
    replies = db.relationship(
        'Comment', backref=db.backref('parent', remote_side=[id]),
        lazy='dynamic')

    def save(self):
        db.session.add(self)
        db.session.commit()
        prefix = self.parent.path + '.' if self.parent else ''
        self.path = prefix + '{:0{}d}'.format(self.id, self._N)
        db.session.commit()

    def level(self):
        return len(self.path) // self._N - 1
</code></pre>
<p>The <code>_N</code> class variable stores the number of digits I'm using for each component. For this example I set it to 6, which supports up to a million comments. To obtain a unique and auto-incrementing number to use in the <code>path</code>, I just steal the <code>id</code> assigned by the database, so for that reason I have to save the comment twice. First I save it without the <code>path</code> to have the database assign the <code>id</code>, then a second time with the <code>path</code> set. Saving the comment twice is not ideal, but I think it is a good compromise, considering all the benefits I get. It would also be possible to avoid the double save if you come up with a different way to generate auto-incrementing numbers, but that requires a very careful design to avoid race conditions, so I decided to stick with the double save solution.</p>
<p>In this implementation I used the dot separators between components, but that isn't really needed. I left them there because it makes the <code>path</code> more readable, but if you prefer to save space, it is totally fine to not include the periods and make <code>path</code> a packed sequence of digits.</p>
<p>The <code>level()</code> method is very easy to implement, by taking the length of the <code>path</code> attribute and dividing it by the number of digits in each component. This method can be extremely useful to generate the proper indentation when you render these comments as a thread.</p>
<p>Below you can see how I can insert the comments with the structure I've been using in the examples above. Basically I had to stop referencing the database session directly and instead call to <code>save()</code> for each comment:</p>
<pre><code>c1 = Comment(text='hello1', author='alice')
c2 = Comment(text='hello2', author='bob')
c11 = Comment(text='reply11', author='bob', parent=c1)
c12 = Comment(text='reply12', author='susan', parent=c1)
c111 = Comment(text='reply111', author='susan', parent=c11)
c21 = Comment(text='reply21', author='alice', parent=c2)
for comment in [c1, c2, c11, c12, c111, c21]:
    comment.save()
</code></pre>
<p>And here is how I can print the comments to the terminal with the correct indentation:</p>
<pre><code>for comment in Comment.query.order_by(Comment.path):
    print('{}{}: {}'.format('  ' * comment.level(), comment.author, comment.text))
</code></pre>
<p>The complete and runnable example for this implementation is in <a href="https://gist.github.com/miguelgrinberg/39503aabef376dbe215788770b5ae839#file-comments_with_path-py">this gist</a>.</p>
<h3>Possible Improvements</h3>
<p>I think this solution is very decent, but depending on the application you may find that you need to tweak things a little bit to achieve what you want.</p>
<p>As I presented it above, this solution can manage a single set of comments. Unfortunately, this isn't that useful, as most applications have many pages on which users can write comments. To be able to retrieve just the comments that apply to a single page, all you need to do is add another column to the the <code>Comment</code> model that links to the page on which the comment should appear. For example, in a blog application, this could be a foreign key to the post <code>id</code>. This <code>id</code> needs to be copied in all the comments, including replies, so that you can run a query similar to the following:</p>
<pre><code>for comment in Comment.query.filter_by(post_id=post.id).order_by(Comment.path.asc()):
    print('{}{}: {}'.format('  ' * comment.level(), comment.author, comment.text))
</code></pre>
<p>The <code>save()</code> method can copy the <code>post_id</code> field from the parent into the child comment so that you don't have to manually copy these IDs all the time.</p>
<p>Another limitation with this solution is that it can only retrieve the comments in the order the top-level comments were made, from oldest to newest. For many applications you may want to sort the top-level comments from newest to oldest, while still have all the replies in threaded order under each parent comment. In other cases, your users could be voting top-level comments up or down, and you want to show the most voted comments first.</p>
<p>To implement these alternative sorting strategies you have to use an additional column. If you want to be able to sort by the timestamps of the top-level comments, you can just add a <code>thread_timestamp</code> column, which has the timestamp of the top-level comment duplicated in each reply. The <code>save()</code> method can pass this timestamp down from parent to children, so that it does not become a burden to manage this additional column. Then you can sort by timestamp with a secondary sort by <code>path</code> to preserve the order of the replies:</p>
<pre><code>for comment in Comment.query.order_by(Comment.thread_timestamp.desc(), Comment.path.asc()):
    print('{}{}: {}'.format('  ' * comment.level(), comment.author, comment.text))
</code></pre>
<p>If you want to sort by the votes users make on top-level comments, the solution is similar. Instead of a <code>thread_timestamp</code>, you have to use a <code>thread_votes</code> column. For this solution to work, you still need to have the value of this column duplicated in all the replies associated with the parent comment. If you wanted to show most voted top-level comments first, you would do something like this:</p>
<pre><code>for comment in Comment.query.order_by(Comment.votes.desc(), Comment.path.asc()):
    print('{}{}: {}'.format('  ' * comment.level(), comment.author, comment.text))
</code></pre>
<p>The voting solution has a twist, however. Users will be voting top-level comments up or down, so each time a top-level comment receives a vote, the new vote score needs to be written not only on the top-level comment, but also on all the replies, to ensure that the sorting keeps the threads sorted correctly. You could do this update in two steps, first by getting the list of children, and then updating the vote score on all of them:</p>
<pre><code>class Comment(db.Model):
    def change_vote(vote):
        for comment in Comment.query.filter(Comment.path.like(self.path + '%')):
            self.thread_vote = vote
            db.session.add(self)
        db.session.commit()
</code></pre>
<p>If you prefer something a little bit more efficient, you can do it with a <code>update()</code> call bypassing the ORM.</p>
<h2>Conclusion</h2>
<p>I hope this was a useful overview that helps you find the best solution for your application's comment platform. As I indicated above, I have a <a href="https://gist.github.com/miguelgrinberg/39503aabef376dbe215788770b5ae839">gist</a> with example code for flat comments, adjacency lists, and the last solution based on comment paths.  Do you use a different solution? I'd like to know, so please let me know below in the comments.</p></div>

<div class="card patreon-bar">
  <div class="card-body">
    <h5>Become a Patron!</h5>
    <p class="card-text">Hello, and thank you for visiting my blog! If you enjoyed this article, please consider supporting my work on this blog on <a href="https://patreon.com/miguelgrinberg">Patreon</a>!</p>
    <a href="https://patreon.com/miguelgrinberg" alt="Become a Patron!" title="Become a Patron!"><img src="../static/patreon-button.png"></a>
  </div>
</div>


<div class="card social-bar">
  <div class="card-body">
    <h5>Share this post:</h5>
      <!-- Sharingbutton Hacker News -->
      <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3A//blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy&amp;t=Implementing%20User%20Comments%20with%20SQLAlchemy" target="_blank" rel="noopener" aria-label="Hacker News">
        <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg></div>Hacker News</div>
      </a>

      <!-- Sharingbutton Reddit -->
      <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3A//blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy&amp;resubmit=true&amp;title=Implementing%20User%20Comments%20with%20SQLAlchemy" target="_blank" rel="noopener" aria-label="Reddit">
        <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div>Reddit</div>
      </a>

      <!-- Sharingbutton Twitter -->
      <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Implementing%20User%20Comments%20with%20SQLAlchemy&amp;url=https%3A//blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy" target="_blank" rel="noopener" aria-label="Twitter">
        <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div>Twitter</div>
      </a>

      <!-- Sharingbutton LinkedIn -->
      <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A//blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy&amp;title=Implementing%20User%20Comments%20with%20SQLAlchemy&amp;summary=Implementing%20User%20Comments%20with%20SQLAlchemy&amp;source=https%3A//blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy" target="_blank" rel="noopener" aria-label="LinkedIn">
        <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div>LinkedIn</div>
      </a>

      <!-- Sharingbutton Facebook -->
      <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3A//blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy" target="_blank" rel="noopener" aria-label="Facebook">
        <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div>Facebook</div>
      </a>

      <!-- Sharingbutton E-Mail -->
      <a class="resp-sharing-button__link" href="mailto:?subject=Implementing%20User%20Comments%20with%20SQLAlchemy&amp;body=https%3A//blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy" target="_self" rel="noopener" aria-label="E-Mail">
        <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div>E-Mail</div>
      </a>

  </div>
</div>

<div id="comments" class="post-comment-count">
  
  <a class="btn btn-outline-secondary" href="implementing-user-comments-with-sqlalchemy.html#comments">59 comments</a>
  
</div>


<div class="comments">
  <ul>
    
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/626c168140dbee7010f6c225bf6108ca?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#1</span> <span class="badge text-bg-warning">Fernando </span> said
    
    <span class="flask-moment" data-timestamp="2017-10-10T18:43:30Z" data-function="fromNow" data-refresh="0" style="display: none">2017-10-10T18:43:30Z</span>
  </p>
  <div>
    <p>Nice post!<br>
Comments on a real application as shown above definitely are non trivial.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/9a49ff7e17df05021085e868ffc84a29?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#2</span> <span class="badge text-bg-warning">Matt</span> said
    
    <span class="flask-moment" data-timestamp="2017-10-11T13:22:42Z" data-function="fromNow" data-refresh="0" style="display: none">2017-10-11T13:22:42Z</span>
  </p>
  <div>
    <p>Fun and inventive exploration of maintaining trees in flat RDBs— and insightful, as always!</p>
<p>I’d been puzzling over similar trade-offs for a different application before deciding I should just use MongoDB. This article reminded me how much fun it would’ve been to hack something together, instead. Good times.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/44090fd9e2332fae04c28cb208af1f34?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#3</span> <span class="badge text-bg-warning">Paul Everitt</span> said
    
    <span class="flask-moment" data-timestamp="2017-10-11T13:55:44Z" data-function="fromNow" data-refresh="0" style="display: none">2017-10-11T13:55:44Z</span>
  </p>
  <div>
    <p>We use Adjacency List quite a bit with recursive CTEs which can walk the list in one query.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#4</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2017-10-11T21:50:48Z" data-function="fromNow" data-refresh="0" style="display: none">2017-10-11T21:50:48Z</span>
  </p>
  <div>
    <p>@Paul: I have not really considered CTEs due to not having uniform support across popular DB engines (i.e. MySQL). But it looks like MySQL 8 is going to have CTEs so I may need to revisit this topic.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/a9e322b8b8ba5d781eafd2764671f0e9?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#5</span> <span class="badge text-bg-warning">Kevin</span> said
    
    <span class="flask-moment" data-timestamp="2017-10-31T10:17:30Z" data-function="fromNow" data-refresh="0" style="display: none">2017-10-31T10:17:30Z</span>
  </p>
  <div>
    <p>Awesome! Thanks<br>
But I think save() method should be "return len(self.path.split('.')) - 1"</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/37d35597add9692ae6529d065bdcdfb6?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#6</span> <span class="badge text-bg-warning">Alex</span> said
    
    <span class="flask-moment" data-timestamp="2017-11-09T02:44:17Z" data-function="fromNow" data-refresh="0" style="display: none">2017-11-09T02:44:17Z</span>
  </p>
  <div>
    <p>So I see you've implemented these models in SQL. But how do I create a web form that handles all this? I have a feeling it has to do with WTForms and wtf.quickform but I'm not sure...</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#7</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2017-11-09T06:58:26Z" data-function="fromNow" data-refresh="0" style="display: none">2017-11-09T06:58:26Z</span>
  </p>
  <div>
    <p>@Alex: Have you see my beginner-level articles, like the Flask Mega-Tutorial, or my book, or the PyCon tutorials on youtube? This article is about the technique to do threaded comments, if you want to learn the more basic topics such as how to create a web form, look for those.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/2068907249ef1afd7169777fcfaf5c1b?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#8</span> <span class="badge text-bg-warning">Kyle Lawlor</span> said
    
    <span class="flask-moment" data-timestamp="2017-11-25T22:52:33Z" data-function="fromNow" data-refresh="0" style="display: none">2017-11-25T22:52:33Z</span>
  </p>
  <div>
    <p>This may be a situation where using a graph database could offer some value. If I can get around to implementing something I will come back to share :)</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/27e878ee760f6f9e7ec59fd054a3fe13?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#9</span> <span class="badge text-bg-warning">oneohthree</span> said
    
    <span class="flask-moment" data-timestamp="2017-12-08T01:00:23Z" data-function="fromNow" data-refresh="0" style="display: none">2017-12-08T01:00:23Z</span>
  </p>
  <div>
    <p>I'm sorry to ask here. How can I specify a PostgreSQL schema in Flask SQLAlchemy connection? I dropped Public schema and I'm using a custom one.</p>
<p>Thank you for this great blog.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#10</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2017-12-08T23:28:37Z" data-function="fromNow" data-refresh="0" style="display: none">2017-12-08T23:28:37Z</span>
  </p>
  <div>
    <p>@dd: You can add the schema as a <strong>table_args</strong> attribute in your model declaration. Example:</p>
<p>class MyModel(db.Model):<br>
<strong>table_args</strong> = {'schema':'my_schema'}</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/3566dd306d0ba01771412dbb401a77c5?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#11</span> <span class="badge text-bg-warning">Jnnk</span> said
    
    <span class="flask-moment" data-timestamp="2018-04-07T10:54:04Z" data-function="fromNow" data-refresh="0" style="display: none">2018-04-07T10:54:04Z</span>
  </p>
  <div>
    <p>Hi,</p>
<p>when I try to run your example implementation with mysql instead of sqlite as the database engine, i get the following error:</p>
<p>sqlalchemy.exc.OperationalError: (_mysql_exceptions.OperationalError) (1170, "BLOB/TEXT column 'path' used in key specification without a key length") [SQL: 'CREATE INDEX ix_comment_path ON comment (path)'] (Background on this error at: <a href="http://sqlalche.me/e/e3q8" rel="nofollow">http://sqlalche.me/e/e3q8</a>)</p>
<p>How could I solve this?</p>
<p>Thanks</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#12</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-04-07T15:29:33Z" data-function="fromNow" data-refresh="0" style="display: none">2018-04-07T15:29:33Z</span>
  </p>
  <div>
    <p>@Jnnk: add a length to the offending column, like the error suggests?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/3566dd306d0ba01771412dbb401a77c5?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#13</span> <span class="badge text-bg-warning">Jnnk</span> said
    
    <span class="flask-moment" data-timestamp="2018-04-08T20:20:50Z" data-function="fromNow" data-refresh="0" style="display: none">2018-04-08T20:20:50Z</span>
  </p>
  <div>
    <p>@Miguel Grinberg: Yes but even with you get the error - but just if you use flask_migrate instead of db.create_all(). I solved this by using String(1000) instead of Text()</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/927031b9f3961b72670c3ea895c00491?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#14</span> <span class="badge text-bg-warning">Ogah</span> said
    
    <span class="flask-moment" data-timestamp="2018-05-27T15:49:08Z" data-function="fromNow" data-refresh="0" style="display: none">2018-05-27T15:49:08Z</span>
  </p>
  <div>
    <p>I tried implementing this tutorial with flasky comment but the system sees replies to a comment as another comment. How can add the parent-id as hiddenField so that the system will be able to differentiate the two forms</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#15</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-05-27T16:51:11Z" data-function="fromNow" data-refresh="0" style="display: none">2018-05-27T16:51:11Z</span>
  </p>
  <div>
    <p>@Ogah: if you have two or more forms in the same page, you can opt for two ways to handle it. One way would be to use different POST routes for the forms. A form that is an original comment would go to one route, and a form that replies to another comment would go to a different one. With this solution, you can send the parent comment id as a hidden field, or as part of the POST url, which you will include in the action attribute of the form. The other option is to send all forms to the same url, but then in the server check the list of fields that you have in the form. If the hidden field with the parent id is found then assume it is a reply, else it is a top-level comment.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/d4e73cf58588cd2b4b53d872aad2b449?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#16</span> <span class="badge text-bg-warning">harvey</span> said
    
    <span class="flask-moment" data-timestamp="2018-05-28T21:33:28Z" data-function="fromNow" data-refresh="0" style="display: none">2018-05-28T21:33:28Z</span>
  </p>
  <div>
    <p>sir, i cannot get this two line code correctly<br>
prefix = self.parent.path + '.' if self.parent else ''<br>
self.path = prefix + '{:0{}d}'.format(<a href="http://self.id/" rel="nofollow">self.id</a>, self._N)<br>
given that self.parent.path = 1, ie value for first top level comment.<br>
what will be the value of self.path<br>
sorry for my slow learning ability</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#17</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-05-29T06:09:50Z" data-function="fromNow" data-refresh="0" style="display: none">2018-05-29T06:09:50Z</span>
  </p>
  <div>
    <p>@harvey: the value of path in your example would be 1.2, assuming there were no other comments entered in between these two.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/d4e73cf58588cd2b4b53d872aad2b449?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#18</span> <span class="badge text-bg-warning">harvey</span> said
    
    <span class="flask-moment" data-timestamp="2018-05-31T13:39:54Z" data-function="fromNow" data-refresh="0" style="display: none">2018-05-31T13:39:54Z</span>
  </p>
  <div>
    <p>sir i am trying to add this implementation to comment on mega-tutorial but am having issues iterating parent to past comments to as to get the replies. here is what i added</p>
<p>@main.route('/blog/&lt;slug&gt;/', methods=['GET', 'POST'])<br>
def detail(slug):<br>
    post = Post.query.filter_by(slug=slug).first_or_404()<br>
    comments = Comment.query.filter_by(post_id=<a href="http://post.id/" rel="nofollow">post.id</a>).order_by(Comment.path.asc())<br>
    form = CommentForm()<br>
    form1 = ReplyForm()<br>
    if form.validate_on_submit():<br>
        comment = Comment(body=form.body.data, post=post,<br>
                          author=current_user._get_current_object())<br>
        comment.save()<br>
        flash('Your comment has been published.')<br>
    elif form.validate_on_submit() and request.method =='POST':<br>
        comment = Comment(reply=form1.reply.data,author=current_user._get_current_object()<br>
                                      ,parent=comments)<br>
        comment.save()<br>
        flash('Your reply has been published.')<br>
        return redirect(url_for('main.detail', slug=post.slug, page=-1))<br>
the code doesn't accept replies.<br>
when viewed from sqlite3, parent_id have not value</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#19</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-05-31T22:43:04Z" data-function="fromNow" data-refresh="0" style="display: none">2018-05-31T22:43:04Z</span>
  </p>
  <div>
    <p>@harvey: I don't understand what you are trying to do. You seem to have two forms for comments and replies, but how do you know which form the user submitted? As a suggestion, maybe you should send the POST request for the comment and reply forms to different routes, so that you can handle those two cases separately in the server.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/d4e73cf58588cd2b4b53d872aad2b449?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#20</span> <span class="badge text-bg-warning">Harvey</span> said
    
    <span class="flask-moment" data-timestamp="2018-06-09T12:20:32Z" data-function="fromNow" data-refresh="0" style="display: none">2018-06-09T12:20:32Z</span>
  </p>
  <div>
    <p>Hello sir,<br>
i am still trying  to implement this tutorial to my flasky app.<br>
i can now write reply but the problem is that instead of the reply displaying below the comment,the comment display. But when the database is viewee through sqlite3 app.db, i see the content of the  replies and its parent_ids.  Also each time i write comment, the comment.replies.count() increments. i dont know where i am geting it wrong. Here is the codes:<br>
<a href="http://forms.py/" rel="nofollow">FORMS.PY</a><br>
class CommentForm(FlaskForm):<br>
    body = StringField('Enter your Comment ', validators=[DataRequired()])<br>
    submit = SubmitField('Submit')<br>
class ReplyForm(FlaskForm):<br>
    reply = StringField('Enter your Reply ', validators=[DataRequired()])<br>
    submit = SubmitField('Submit')</p>
<p><a href="http://routes.py/" rel="nofollow">ROUTES.PY</a><br>
@main.route('/blog/&lt;slug&gt;/', methods=['GET', 'POST'])<br>
def detail(slug):<br>
    post = Post.query.filter_by(slug=slug).first_or_404()<br>
    comment = Comment.query.filter_by(post_id=<a href="http://post.id/" rel="nofollow">post.id</a>).order_by(Comment.path.asc()).first()<br>
    form1 = CommentForm()<br>
    form2 = ReplyForm()<br>
    if form1.validate_on_submit() and form1.body.data:<br>
        comm = Comment(body=form1.body.data, post=post,<br>
                          author=current_user._get_current_object())<br>
        comm.save()<br>
         flash('Your comment has been published.')<br>
    elif form2.validate_on_submit() and form2.reply.data:<br>
        commentt = Comment(body=form2.reply.data, author=current_user._get_current_object(),<br>
                                       parent=comment)<br>
        commentt.save()<br>
        flash('Your reply has been published')<br>
        return redirect(url_for('main.detail', slug=post.slug, page=-1))<br>
    page = request.args.get('page', 1, type=int)<br>
    if page == -1:<br>
        page = (post.comments.count() - 1) // current_app.config['COMMENTS_PER_PAGE'] + 1<br>
    pagination = post.comments.order_by(Comment.timestamp.asc()).paginate(page, <br>
                                        current_app.config['COMMENTS_PER_PAGE'],False)<br>
    comments = pagination.items<br>
    return render_template('detail.html',post=post, form1=form1,form2=form2,<br>
                           pagination=pagination,comments=comments,comment=comment)</p>
<p>_comment.html:<br>
    {% import "bootstrap/wtf.html" as wtf %}</p>
&lt;table class="table table-hover"&gt;
{% for comment in comments %}
&lt;div class="comment-content" &gt;
{% if comment.body_html %}
                        {{ comment.body_html | safe }}
                   {% else %}
                        {{ comment.body }}
                    {% endif %}
        <ul>
        <li><a href="https://blog.miguelgrinberg.com/index#Replies" rel="nofollow">
              &amp;lt;span class="label label-primary"&amp;gt;{{comment.replies.count()}}Replies&amp;lt;/span&amp;gt;</a></li>
{% include '_reply.html' %}
{% endfor %}
&lt;/table&gt;

<p>-reply.html:</p>
&lt;table class="table table-hover"&gt;
{% for reply in comment.replies %}
&lt;div class="reply-content"&gt;
{% if comment.body_html %}
                        {{ comment.body_html | safe }}
                        {% else %}
                        {{ comment.body }}
                    {% endif %}
{% endfor %}
&lt;/div&gt;
&lt;form action="." method="post"&gt;
                {{ wtf.quick_form(form2) }}
            &lt;input type="hidden" name="parent_id" value="{{ <a href="http://comment.id/" rel="nofollow">comment.id</a> }}"&gt;
&lt;/form&gt;
&lt;/table&gt;</ul>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#21</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-06-09T15:04:21Z" data-function="fromNow" data-refresh="0" style="display: none">2018-06-09T15:04:21Z</span>
  </p>
  <div>
    <p>@Harvey: in reply.html you need to use "reply" instead of "comment" inside the for loop.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/d4e73cf58588cd2b4b53d872aad2b449?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#22</span> <span class="badge text-bg-warning">Harvey</span> said
    
    <span class="flask-moment" data-timestamp="2018-06-10T15:06:20Z" data-function="fromNow" data-refresh="0" style="display: none">2018-06-10T15:06:20Z</span>
  </p>
  <div>
    <p>sir i have only comment class in my <a href="http://models.py/" rel="nofollow">models.py</a>  with replies as a referential object variable<br>
<a href="http://model.py/" rel="nofollow">model.py</a>:<br>
class Comment(db.Model):<br>
    id = db.Column(db.Integer, primary_key=True)<br>
    body = db.Column(db.Text)<br>
    body_html = db.Column(db.Text)<br>
    path = db.Column(db.Text, index=True)<br>
    timestamp = db.Column(db.DateTime, index=True, default=datetime.utcnow)<br>
    disabled = db.Column(db.Boolean)<br>
    author_id = db.Column(db.Integer, db.ForeignKey('<a href="http://user.id/" rel="nofollow">user.id</a>'))<br>
    post_id = db.Column(db.Integer, db.ForeignKey('<a href="http://post.id/" rel="nofollow">post.id</a>'))<br>
    parent_id = db.Column(db.Integer,db.ForeignKey('<a href="http://comment.id/" rel="nofollow">comment.id</a>'))<br>
    replies = db.relationship('Comment', backref = db.backref('parent',remote_side=[id]),        lazy='dynamic')<br>
     def save(self):<br>
       db.session.add(self)<br>
       db.session.commit()<br>
       prefix = self.parent.path + '.' if self.parent else ''<br>
       self.path = prefix + '{:0{}d}'.format(<a href="http://self.id/" rel="nofollow">self.id</a>, self._N)<br>
       db.session.commit()</p>
<pre><code>def level(self):
    return len(self.path) // self._N - 1
</code></pre>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#23</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-06-10T18:18:17Z" data-function="fromNow" data-refresh="0" style="display: none">2018-06-10T18:18:17Z</span>
  </p>
  <div>
    <p>@Harvey: your for loop says "for reply in comment.replies", so the loop variable is called "reply".</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/d4e73cf58588cd2b4b53d872aad2b449?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#24</span> <span class="badge text-bg-warning">Harvey</span> said
    
    <span class="flask-moment" data-timestamp="2018-06-11T09:01:04Z" data-function="fromNow" data-refresh="0" style="display: none">2018-06-11T09:01:04Z</span>
  </p>
  <div>
    <p>Thanks you sir.<br>
it worked.</p>
<p>sir,<br>
it is possible to link this reply form:</p>
&lt;form action="." method="post"&gt; {{ wtf.quick_form(form2) }} &lt;input type="hidden" name="parent_id" value="{{ <a href="http://comment.id/" rel="nofollow">comment.id</a> }}"&gt; &lt;/form&gt;

<p>To a html button(Reply)  such that the Replyform appears only when someone clicks reply.</p>
<p>something similar to this:<br>
<br>
</p><li><a href="https://blog.miguelgrinberg.com/index#Replyform" rel="nofollow"> 
&amp;lt;span class="label label-primary"&amp;gt;Reply&amp;lt;/span&amp;gt;</a></li>
<p></p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#25</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-06-11T19:00:05Z" data-function="fromNow" data-refresh="0" style="display: none">2018-06-11T19:00:05Z</span>
  </p>
  <div>
    <p>@Harvey: there are many ways to implement a reply button. My guess is that you will need to use some JavaScript to make it work. The reply button can create the reply form and display it right below the intended comment, for example.</p>
  </div>
</div>
    </li>
    
  </ul>
</div>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item disabled"><a class="page-link" href="implementing-user-comments-with-sqlalchemy/page/1.html#comments">&laquo;&laquo;</a></li>
    <li class="page-item disabled"><a class="page-link" href="implementing-user-comments-with-sqlalchemy/page/0.html#comments">&laquo;</a></li>
    <li class="page-item"><a class="page-link" href="implementing-user-comments-with-sqlalchemy/page/2.html#comments">&raquo;</a></li>
    <li class="page-item"><a class="page-link" href="implementing-user-comments-with-sqlalchemy/page/0.html#comments">&raquo;&raquo;</a></li>
  </ul>
</nav>



<div id="comment-form">
  <h3>Leave a Comment</h3>

  
  
  

  
<form action="#comment-form" method="post">
  <input id="url" name="url" type="hidden" value="">
<input id="csrf_token" name="csrf_token" type="hidden" value="IjQyYjY5YzZlNTcyYjFkMTVlZGRkOWJjYjA3ZmFlYWFiNTg3YmU5ODki.ZxdySw.4xNbiqDZP0mks0lMKHo5IflZP3Q">
    
  <div class="mb-3">
    <label class="form-label" for="name">Name</label>
    <div class="input-group has-validation">
      <input class="form-control" id="name" name="name" required type="text" value="">
    </div>
  </div>

    
    
  <div class="mb-3">
    <label class="form-label" for="email">Email</label>
    <div class="input-group has-validation">
      <input class="form-control" id="email" name="email" required type="text" value="">
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="comment">Comment</label>
    <div class="input-group has-validation">
      <textarea class="form-control" id="comment" name="comment" required>
</textarea>
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="captcha">Captcha</label>
    <div class="input-group has-validation">
      
<script src='https://www.google.com/recaptcha/api.js' async defer></script>
<div class="g-recaptcha" data-sitekey="6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S"></div>

    </div>
  </div>

    
  <input class="btn btn-primary mb-3" id="submit" name="submit" type="submit" value="Submit">

      
</form>

</div>


</div>

      </div>
    </div>
    
    <div class="col-md-4">
      <div id="sidebar">
        
          
  



<div class="card">
  
  
  
  <div class="card-header">SQLAlchemy 2 In Practice</div>
  <a class="card-book-cover" href="https://amzn.to/3S0diwc">
    <img src="../static/sqlalchemy-small.png">
  </a>
  <div class="card-body">
    <p class="card-text">If you want to learn the ins and outs of relational database programming with Python and SQLAlchemy, consider my <a href="https://amzn.to/3S0diwc">SQLAlchemy 2 In Practice</a> book, available on <a href="https://amzn.to/3S0diwc">Amazon</a>.</p>
  </div>
  <div class="card-body">
    <a class="card-link" href="https://amzn.to/3S0diwc">Click here to get this Book!</a><br />
  </div>

  
</div>
        
        <div class="card">
  <div class="card-header">About Miguel</div>
  <div class="card-body">
    <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="../static/miguel.jpg" />
    <p class="card-text">Welcome to my blog!</p>
    <p class="card-text">I'm a software engineer and technical writer, currently living in Drogheda, Ireland.</p>
    <p class="card-text">You can also find me on <a href="https://twitter.com/miguelgrinberg">Twitter</a>, <a href="https://mstdn.social/@miguelgrinberg">Mastodon</a>, <a href="https://github.com/miguelgrinberg">Github</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a>, <a href="https://youtube.com/miguelgrinberg">YouTube</a>, <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a> and <a href="https://patreon.com/miguelgrinberg">Patreon</a>.</p>
    <p class="card-text">Thank you for visiting!</p>
  </div>
</div>
        
        <div class="card" id="categories">
  <div class="card-header">Categories</div>
  <div class="card-body">
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AI/feed"><img src="../static/rss-small.png" title="AI RSS Feed" label="AI RSS Feed" alt="AI RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AI" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AI" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AWS/feed"><img src="../static/rss-small.png" title="AWS RSS Feed" label="AWS RSS Feed" alt="AWS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AWS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AWS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Arduino/feed"><img src="../static/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed" alt="Arduino RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Arduino" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Arduino" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Authentication/feed"><img src="../static/rss-small.png" title="Authentication RSS Feed" label="Authentication RSS Feed" alt="Authentication RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Authentication" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Authentication" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Blog/feed"><img src="../static/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed" alt="Blog RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Blog" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Blog" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/C++/feed"><img src="../static/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed" alt="C++ RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/C++" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="C++" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/CSS/feed"><img src="../static/rss-small.png" title="CSS RSS Feed" label="CSS RSS Feed" alt="CSS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/CSS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="CSS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Cloud/feed"><img src="../static/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed" alt="Cloud RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Cloud" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Cloud" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Database/feed"><img src="../static/rss-small.png" title="Database RSS Feed" label="Database RSS Feed" alt="Database RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Database" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Database" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Docker/feed"><img src="../static/rss-small.png" title="Docker RSS Feed" label="Docker RSS Feed" alt="Docker RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Docker" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Docker" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Filmmaking/feed"><img src="../static/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed" alt="Filmmaking RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Filmmaking" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Filmmaking" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Flask/feed"><img src="../static/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed" alt="Flask RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" /> <small><em>126</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Games/feed"><img src="../static/rss-small.png" title="Games RSS Feed" label="Games RSS Feed" alt="Games RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Games" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Games" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Heroku/feed"><img src="../static/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed" alt="Heroku RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Heroku" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Heroku" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/IoT/feed"><img src="../static/rss-small.png" title="IoT RSS Feed" label="IoT RSS Feed" alt="IoT RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/IoT" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="IoT" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/JavaScript/feed"><img src="../static/rss-small.png" title="JavaScript RSS Feed" label="JavaScript RSS Feed" alt="JavaScript RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/JavaScript" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="JavaScript" /> <small><em>35</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/MicroPython/feed"><img src="../static/rss-small.png" title="MicroPython RSS Feed" label="MicroPython RSS Feed" alt="MicroPython RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/MicroPython" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="MicroPython" /> <small><em>9</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microdot/feed"><img src="../static/rss-small.png" title="Microdot RSS Feed" label="Microdot RSS Feed" alt="Microdot RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microdot" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microdot" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microservices/feed"><img src="../static/rss-small.png" title="Microservices RSS Feed" label="Microservices RSS Feed" alt="Microservices RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microservices" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microservices" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Movie Reviews/feed"><img src="../static/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed" alt="Movie Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Movie Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Movie Reviews" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/OpenStack/feed"><img src="../static/rss-small.png" title="OpenStack RSS Feed" label="OpenStack RSS Feed" alt="OpenStack RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/OpenStack" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="OpenStack" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Personal/feed"><img src="../static/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed" alt="Personal RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Personal" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Personal" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Photography/feed"><img src="../static/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed" alt="Photography RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Photography" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Photography" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Product Reviews/feed"><img src="../static/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed" alt="Product Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Product Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Product Reviews" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Programming/feed"><img src="../static/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed" alt="Programming RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" /> <small><em>187</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Project Management/feed"><img src="../static/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed" alt="Project Management RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Project Management" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Project Management" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Python/feed"><img src="../static/rss-small.png" title="Python RSS Feed" label="Python RSS Feed" alt="Python RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" /> <small><em>169</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/REST/feed"><img src="../static/rss-small.png" title="REST RSS Feed" label="REST RSS Feed" alt="REST RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/REST" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="REST" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Rackspace/feed"><img src="../static/rss-small.png" title="Rackspace RSS Feed" label="Rackspace RSS Feed" alt="Rackspace RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Rackspace" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Rackspace" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Raspberry Pi/feed"><img src="../static/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed" alt="Raspberry Pi RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Raspberry Pi" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Raspberry Pi" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/React/feed"><img src="../static/rss-small.png" title="React RSS Feed" label="React RSS Feed" alt="React RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/React" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="React" /> <small><em>18</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Robotics/feed"><img src="../static/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed" alt="Robotics RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Robotics" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Robotics" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Security/feed"><img src="../static/rss-small.png" title="Security RSS Feed" label="Security RSS Feed" alt="Security RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Security" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Security" /> <small><em>12</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Video/feed"><img src="../static/rss-small.png" title="Video RSS Feed" label="Video RSS Feed" alt="Video RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Video" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Video" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/WebSocket/feed"><img src="../static/rss-small.png" title="WebSocket RSS Feed" label="WebSocket RSS Feed" alt="WebSocket RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/WebSocket" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="WebSocket" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Webcast/feed"><img src="../static/rss-small.png" title="Webcast RSS Feed" label="Webcast RSS Feed" alt="Webcast RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Webcast" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Webcast" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Windows/feed"><img src="../static/rss-small.png" title="Windows RSS Feed" label="Windows RSS Feed" alt="Windows RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Windows" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Windows" /> <small><em>1</em></small>
      </form>
    </div>
    
  </div>
</div>
        
      </div>
    </div>
    
  </div>
  <div id="footer">
    
    <p>&copy; 2012-<script type="text/javascript">document.write(new Date().getFullYear());</script> by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster _at_ miguelgrinberg _dot_ com">Questions?</a></p>
  </div>
</div>

  
    <script src="../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../static/prettify.js"></script>
  <script src="../../cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous"></script>

<script>
moment.locale("en");
function flask_moment_render(elem) {{
    const timestamp = moment(elem.dataset.timestamp);
    const func = elem.dataset.function;
    const format = elem.dataset.format;
    const timestamp2 = elem.dataset.timestamp2;
    const no_suffix = elem.dataset.nosuffix;
    const units = elem.dataset.units;
    let args = [];
    if (format)
        args.push(format);
    if (timestamp2)
        args.push(moment(timestamp2));
    if (no_suffix)
        args.push(no_suffix);
    if (units)
        args.push(units);
    elem.textContent = timestamp[func].apply(timestamp, args);
    elem.classList.remove('flask-moment');
    elem.style.display = "";
}}
function flask_moment_render_all() {{
    const moments = document.querySelectorAll('.flask-moment');
    moments.forEach(function(moment) {{
        flask_moment_render(moment);
        const refresh = moment.dataset.refresh;
        if (refresh && refresh > 0) {{
            (function(elem, interval) {{
                setInterval(function() {{
                    flask_moment_render(elem);
                }}, interval);
            }})(moment, refresh);
        }}
    }})
}}
document.addEventListener("DOMContentLoaded", flask_moment_render_all);
</script>

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-20EHZP9GRZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-20EHZP9GRZ');
  </script>
  
  <script type="text/javascript">
    function setThemeUI() {
      document.getElementById('select-theme-auto').classList.remove('active');
      document.getElementById('select-theme-light').classList.remove('active');
      document.getElementById('select-theme-dark').classList.remove('active');
      const theme = getPreferredTheme();
      const actualTheme = document.documentElement.getAttribute('data-bs-theme', 'light');
      document.getElementById('select-theme-' + theme).classList.add('active');
      document.getElementById('current-theme').href.baseVal = `#icon-theme-${actualTheme}`;
    };

    function updateTheme(theme) {
      if (theme === 'auto') {
        localStorage.removeItem('theme')
      }
      else {
        localStorage.setItem('theme', theme)
      }
      setTheme(getPreferredTheme());
    }

    setThemeUI();

    const darkModePreference = window.matchMedia("(prefers-color-scheme: dark)");
    darkModePreference.addEventListener("change", e => {
      if (getPreferredTheme() === 'auto') {
        setTheme('auto');
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      // add prettyprint class to all <pre><code></code></pre> blocks
      let prettify = false;
      document.querySelectorAll('div.post-body pre code').forEach((code) => {
        code.parentNode.classList.add('prettyprint');
        prettify = true;
      });
      prettyPrint();
    });
  </script>

  </body>

<!-- Mirrored from blog.miguelgrinberg.com/post/implementing-user-comments-with-sqlalchemy by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 09:40:10 GMT -->
</html>