<!doctype html>
<html lang="en">
  
<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018/page/5 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 08:51:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
  <script type="text/javascript">
    function getPreferredTheme() {
      const storedTheme = localStorage.getItem('theme')
      if (storedTheme) {
        return storedTheme
      }
      return 'auto';
    }

    function setTheme(theme) {
      if (theme === 'auto') {
        theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
      }
      document.documentElement.setAttribute('data-bs-theme', theme);
    };

    setTheme(getPreferredTheme());
  </script>
  
    <title>
  
    The Flask Mega-Tutorial Part XVI: Full-Text Search (2018) - miguelgrinberg.com
  
</title>
  
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="description" content="miguelgrinberg.com">
  <meta name="copyright" content="Copyright (c) 2012-2024 Miguel Grinberg">
  <meta name="author" content="Miguel Grinberg">
  
  <meta name="keywords" content="flask, python, programming, database, elasticsearch, full-text search">
  
  
  <link rel="canonical" href="../../the-flask-mega-tutorial-part-xvi-full-text-search-2018.html">
  

  
    <link href="../../../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&amp;display=swap" rel="stylesheet">

  <link href="../../../static/tomorrow.min.css" type="text/css" rel="stylesheet" />
  <link href="../../../static/tomorrow-night.min.css" type="text/css" rel="stylesheet" />
  <link href="../../../static/social.css" rel="stylesheet" type="text/css" />
  <link href="../../../static/style_20231230.css" rel="stylesheet" type="text/css" />

  <link rel="shortcut icon" href="https://blog.miguelgrinberg.com/static/favicon.ico">
  <link rel="alternate" type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed" title="miguelgrinberg.com RSS feed">

    <meta property="og:title" content="The Flask Mega-Tutorial Part XVI: Full-Text Search (2018)">
    <meta property="og:description" content="(Great news! There is a new version of this tutorial!)This is the sixteenth installment of the Flask Mega-Tutorial series, in which I&#39;m going to add a full-text search capability to Microblog.For…">
    <meta property="og:image" content="https://blog.miguelgrinberg.com/static/cards/the-flask-mega-tutorial-part-xvi-full-text-search-2018.jpg">
    <meta property="og:url" content="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018">
    <meta name="twitter:title" content="The Flask Mega-Tutorial Part XVI: Full-Text Search (2018)">
    <meta name="twitter:description" content="(Great news! There is a new version of this tutorial!)This is the sixteenth installment of the Flask Mega-Tutorial series, in which I&#39;m going to add a full-text search capability to Microblog.For…">
    <meta name="twitter:image" content="https://blog.miguelgrinberg.com/static/cards/the-flask-mega-tutorial-part-xvi-full-text-search-2018.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@miguelgrinberg">

  </head>
  <body>
    <svg style="display: none" version="2.0">
      <defs>
        <symbol id="icon-theme-auto" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-circle-half" viewBox="0 0 16 16">
          <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16"/>
        </symbol>
        <symbol id="icon-theme-light" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-brightness-high-fill" viewBox="0 0 16 16">
          <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </symbol>
        <symbol id="icon-theme-dark" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-moon-stars-fill" viewBox="0 0 16 16">
          <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"/>
          <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
        </symbol>
      </defs>
    </svg>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="https://blog.miguelgrinberg.com/index">miguelgrinberg.com</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" aria-current="page" href="https://blog.miguelgrinberg.com/index">Home</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../my-courses-and-books.html">My Courses and Books</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../hire-me.html">Consulting</a></li>
        <li class="nav-item"><a class="nav-link" aria-current="page" href="../../about-me.html">About Me</a></li>
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <svg width="20" height="20" version="2.0"><use id="current-theme" href="#icon-theme-light"></svg>
          </a>
          <ul class="dropdown-menu">
            <li>
              <a id="select-theme-light" class="dropdown-item" href="javascript:updateTheme('light')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-light"></svg>&nbsp; Light Mode
              </a>
            </li>
            <li>
              <a id="select-theme-dark" class="dropdown-item" href="javascript:updateTheme('dark')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-dark"></svg>&nbsp; Dark Mode
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a id="select-theme-auto" class="dropdown-item" href="javascript:updateTheme('auto')">
                <svg width="16" height="16" version="2.0"><use href="#icon-theme-auto"></svg>&nbsp; System Default
              </a>
            </li>
          </ul>
        </li>
        
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item social-icons">
          <a type="application/rss+xml" href="https://blog.miguelgrinberg.com/feed"><img src="../../../static/social/rss.png" alt="RSS Feed" title="RSS Feed" /></a>
          <a href="https://twitter.com/miguelgrinberg"><img src="../../../static/social/twitter.png" alt="Twitter" title="Twitter" /></a>
          <a rel="me" href="https://mstdn.social/@miguelgrinberg"><img src="../../../static/social/mastodon.png" alt="Mastodon" title="Mastodon" /></a>
          <a href="http://github.com/miguelgrinberg"><img src="../../../static/social/github.png" alt="GitHub" title="GitHub" /></a>
          <a href="https://youtube.com/miguelgrinberg"><img src="../../../static/social/youtube.png" alt="YouTube" title="YouTube" /></a>
          <a href="http://www.linkedin.com/in/miguelgrinberg"><img src="../../../static/social/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
          <a href="https://patreon.com/miguelgrinberg"><img src="../../../static/social/patreon.png" alt="Patreon" title="Patreon" /></a>
          <!--<a href="https://www.facebook.com/miguelgrinbergblog"><img src="/static/social/facebook.png" alt="Facebook" title="Facebook" /></a>-->
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row">
    <div class="col-md-8">
      <div id="main">
        
        
        
        
        

<div class="post">

<div class="post-header">
  <h1><a href="../../the-flask-mega-tutorial-part-xvi-full-text-search-2018.html">The Flask Mega-Tutorial Part XVI: Full-Text Search (2018)</a></h1>
  <h2>
    Posted by
    <form action="https://blog.miguelgrinberg.com/author/Miguel Grinberg" method="POST">
      <input type="submit" class="btn btn-danger btn-sm" value="Miguel Grinberg" />
    </form>
    on
    <button class="btn btn-secondary btn-sm" disabled><span class="flask-moment" data-timestamp="2018-03-20T18:20:43Z" data-function="format" data-format="LL" data-refresh="0" style="display: none">2018-03-20T18:20:43Z</span></button>
    under
    
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" />
      </form>
    
      <form action="https://blog.miguelgrinberg.com/category/Database" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Database" />
      </form>
    
    
  </h2>
</div>
<div class="post-body"><p><em>(Great news! There is a <a href="../../the-flask-mega-tutorial-part-i-hello-world.html">new version of this tutorial</a>!)</em></p>
<p>This is the sixteenth installment of the Flask Mega-Tutorial series, in which I'm going to add a full-text search capability to Microblog.</p>
<p>For your reference, below is a list of the articles in this series.</p>
<ul>
<li><a href="../../the-flask-mega-tutorial-part-i-hello-world-2018.html">Chapter 1: Hello, World!</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ii-templates-2018.html">Chapter 2: Templates</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iii-web-forms-2018.html">Chapter 3: Web Forms</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iv-database-2018.html">Chapter 4: Database</a></li>
<li><a href="../../the-flask-mega-tutorial-part-v-user-logins-2018.html">Chapter 5: User Logins</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vi-profile-page-and-avatars-2018.html">Chapter 6: Profile Page and Avatars</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vii-error-handling-2018.html">Chapter 7: Error Handling</a></li>
<li><a href="../../the-flask-mega-tutorial-part-viii-followers-2018.html">Chapter 8: Followers</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ix-pagination-2018.html">Chapter 9: Pagination</a></li>
<li><a href="../../the-flask-mega-tutorial-part-x-email-support-2018.html">Chapter 10: Email Support</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xi-facelift-2018.html">Chapter 11: Facelift</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xii-dates-and-times-2018.html">Chapter 12: Dates and Times</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiii-i18n-and-l10n-2018.html">Chapter 13: I18n and L10n</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiv-ajax-2018.html">Chapter 14: Ajax</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xv-a-better-application-structure-2018.html">Chapter 15: A Better Application Structure</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvi-full-text-search-2018.html">Chapter 16: Full-Text Search</a> (this article)</li>
<li><a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-2018.html">Chapter 17: Deployment on Linux</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xviii-deployment-on-heroku-2018.html">Chapter 18: Deployment on Heroku</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xix-deployment-on-docker-containers-2018.html">Chapter 19: Deployment on Docker Containers</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xx-some-javascript-magic-2018.html">Chapter 20: Some JavaScript Magic</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xxi-user-notifications-2018.html">Chapter 21: User Notifications</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xxii-background-jobs-2018.html">Chapter 22: Background Jobs</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xxiii-application-programming-interfaces-apis-2018.html">Chapter 23: Application Programming Interfaces (APIs)</a></li>
</ul>
<p>The goal of this chapter is to implement a search feature for Microblog, so that users can find interesting posts using natural language. For many types of web sites, it is possible to just let Google, Bing, etc. index all the content and provide search results through their search APIs. This works well for sites that have mostly static pages, like a forum. But in my application the basic unit of content is a user post, which is a small portion of the entire web page. The type of search results that I want are for these individual blog posts and not entire pages. For example, if I search for the word "dog" I want to see blog posts from any users that include that word. Obviously a page that shows all blog posts that have the word "dog" (or any other possible search term) does not really exist as a page that the big search engines can find and index, so clearly I have no choice other than to roll my own search feature.</p>
<p><em>The GitHub links for this chapter are: <a href="https://github.com/miguelgrinberg/microblog/tree/v0.16">Browse</a>, <a href="https://github.com/miguelgrinberg/microblog-2018/archive/v0.16.zip">Zip</a>, <a href="https://github.com/miguelgrinberg/microblog/compare/v0.15...v0.16">Diff</a>.</em></p>
<h2>Introduction to Full-Text Search Engines</h2>
<p>Support for full-text search is not standardized like relational databases are. There are several open-source full-text engines: <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a>, <a href="http://lucene.apache.org/solr/">Apache Solr</a>, <a href="http://whoosh.readthedocs.io/">Whoosh</a>, <a href="https://xapian.org/">Xapian</a>, <a href="http://sphinxsearch.com/">Sphinx</a>, etc. As if this isn't enough choice, there are several databases that also provide searching capabilities that are comparable to dedicated search engines like the ones I enumerated above. <a href="https://www.sqlite.org/">SQLite</a>, <a href="https://www.mysql.com/">MySQL</a> and <a href="https://www.postgresql.org/">PostgreSQL</a> all offer some support for searching text, and NoSQL databases such as <a href="https://www.mongodb.com/">MongoDB</a> and <a href="http://couchdb.apache.org/">CouchDB</a> do too.</p>
<p>If you are wondering which of these can work within a Flask application, the answer is all of them! That is one of the strengths of Flask, it does its job while not being opinionated. So what's the best choice?</p>
<p>From the list of dedicated search engines, Elasticsearch is one that stands out to me as being fairly popular, in part due to its popularity as the "E" in the ELK stack for indexing logs, along with Logstash and Kibana. Using the searching capabilities of one of the relational databases could also be a good choice, but given the fact that SQLAlchemy does not support this functionality, I would have to handle the searching with raw SQL statements, or else find a package that provides high-level access to text searches while being able to coexist with SQLAlchemy.</p>
<p>Based on the above analysis, I'm going to use Elasticsearch, but I'm going to implement all the text indexing and searching functions in a way that is very easy to switch to another engine. That will allow you to replace my implementation with an alternative one based on a different engine just by rewriting a few functions in a single module.</p>
<h2>Installing Elasticsearch</h2>
<p>There are several ways to install Elasticsearch, including one-click installers, zip file with the binaries that you need to install yourself, and even a Docker image. The documentation has an <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html">Installation</a> page with detailed information on all these options. If you are using Linux, you will likely have a package available for your distribution. If you are using a Mac and have Homebrew installed, then you can simply run <code>brew install elasticsearch</code>.</p>
<p>Once you install Elasticsearch on your computer, you can verify that it is running by typing <code>http://localhost:9200</code> in your browser's address bar, which should return some basic information about the service in JSON format.</p>
<p>Since I will be managing Elasticsearch from Python, I will also be using the Python client library:</p>
<pre><code>(venv) $ pip install elasticsearch
</code></pre>
<p>You may also want to update your <em>requirements.txt</em> file:</p>
<pre><code>(venv) $ pip freeze &gt; requirements.txt
</code></pre>
<h2>Elasticsearch Tutorial</h2>
<p>I'm going to start by showing you the basics of working with Elasticsearch from a Python shell. This will help you familiarize with this service, so that you can understand the implementation that I will discuss later.</p>
<p>To create a connection to Elasticsearch, create an instance of class <code>Elasticsearch</code>, passing a connection URL as an argument:</p>
<pre><code class="language-python">&gt;&gt;&gt; from elasticsearch import Elasticsearch
&gt;&gt;&gt; es = Elasticsearch('http://localhost:9200')
</code></pre>
<p>Data in Elasticsearch is written to <em>indexes</em>. Unlike a relational database, the data is just a <a href="http://www.json.org/">JSON</a> object. The following example writes an object with a field called <code>text</code> to an index called <code>my_index</code>:</p>
<pre><code class="language-python">&gt;&gt;&gt; es.index(index='my_index', id=1, body={'text': 'this is a test'})
</code></pre>
<p>For each document stored, Elasticsearch takes a unique id and a dictionary with the data to be stored.</p>
<p>Let's store a second document on this index:</p>
<pre><code class="language-python">&gt;&gt;&gt; es.index(index='my_index', id=2, body={'text': 'a second test'})
</code></pre>
<p>And now that there are two documents in this index, I can issue a free-form search. In this example, I'm going to search for <code>this test</code>:</p>
<pre><code class="language-python">&gt;&gt;&gt; es.search(index='my_index', body={'query': {'match': {'text': 'this test'}}})
</code></pre>
<p>The response from the <code>es.search()</code> call is a Python dictionary with the search results:</p>
<pre><code class="language-python">{
    'took': 309,
    'timed_out': False,
    '_shards': {'total': 1, 'successful': 5, 'skipped': 0, 'failed': 0},
    'hits': {
        'total': {'value': 2, 'relation': 'eq'},
        'max_score': 0.82713,
        'hits': [
            {
                '_index': 'my_index',
                '_type': '_doc',
                '_id': '1',
                '_score': 0.82713,
                '_source': {'text': 'this is a test'}
            },
            {
                '_index': 'my_index',
                '_type': '_doc',
                '_id': '2',
                '_score': 0.1936807,
                '_source': {'text': 'a second test'}
            }
        ]
    }
}
</code></pre>
<p>Here you can see that the search returned the two documents, each with an assigned score. The document with the highest score contains the two words I searched for, and the other document contains only one. You can see that even the best result does not have a perfect score of 1, because the words do not exactly match the text.</p>
<p>Now this is the result if I search for the word <code>second</code>:</p>
<pre><code class="language-python">&gt;&gt;&gt; es.search(index='my_index', body={'query': {'match': {'text': 'second'}}})
{
    'took': 6,
    'timed_out': False,
    '_shards': {'total': 1, 'successful': 1, 'skipped': 0, 'failed': 0},
    'hits': {
        'total': {'value': 1, 'relation': 'eq'},
        'max_score': 0.7361701,
        'hits': [
            {
                '_index': 'my_index',
                '_type': '_doc',
                '_id': '2',
                '_score': 0.7361701,
                '_source': {'text': 'a second test'}
            }
        ]
    }
}
</code></pre>
<p>I still get a less than perfect score because my search does not exactly match the text in this document, but since only one of the two documents contains the word "second", the other document does not show up at all.</p>
<p>The Elasticsearch query object has more options, all well <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-body.html">documented</a>, and includes options such as pagination and sorting, just like relational databases.</p>
<p>Feel free to add more entries to this index and try different searches. When you are done experimenting, you can delete the index with the following command:</p>
<pre><code class="language-python">&gt;&gt;&gt; es.indices.delete(index='my_index')
</code></pre>
<h2>Elasticsearch Configuration</h2>
<p>Integrating Elasticsearch into the application is a great example of the power of Flask. This is a service and Python package that does not have anything to do with Flask, yet, I'm going to get a pretty good level of integration, starting from the configuration, which I'm going to write in the <code>app.config</code> dictionary from Flask:</p>
<p class="code_title"><i>config.py</i>: Elasticsearch configuration.</p>

<pre><code class="language-python">class Config(object):
    # ...
    ELASTICSEARCH_URL = os.environ.get('ELASTICSEARCH_URL')
</code></pre>
<p>Like with many other configuration entries, the connection URL for Elasticsearch is going to be sourced from an environment variable. If the variable is not defined, I'm going to let the setting be set to <code>None</code>, and I'll use that as a signal to disable Elasticsearch. This is mainly for convenience, so that you are not forced to always have the Elasticsearch service up and running when you work on the application, and in particular when you run unit tests. So to make sure the service is used, I need to define the <code>ELASTICSEARCH_URL</code> environment variable, either directly in the terminal or by adding it to the <em>.env</em> file as follows:</p>
<pre><code>ELASTICSEARCH_URL=http://localhost:9200
</code></pre>
<p>Elasticsearch presents the challenge that it isn't wrapped by a Flask extension. I cannot create the Elasticsearch instance in the global scope like I did in the examples above because to initialize it I need access to <code>app.config</code>, which only becomes available after the <code>create_app()</code> function is invoked. So I decided to add a <code>elasticsearch</code> attribute to the <code>app</code> instance in the application factory function:</p>
<p class="code_title"><i>app/__init__.py</i>: Elasticsearch instance.</p>

<pre><code class="language-python"># ...
from elasticsearch import Elasticsearch

# ...

def create_app(config_class=Config):
    app = Flask(__name__)
    app.config.from_object(config_class)

    # ...
    app.elasticsearch = Elasticsearch([app.config['ELASTICSEARCH_URL']]) \
        if app.config['ELASTICSEARCH_URL'] else None

    # ...
</code></pre>
<p>Adding a new attribute to the <code>app</code> instance may seem a little strange, but Python objects are not strict in their structure, and new attributes can be added to them at any time. An alternative that you may also consider is to create a subclass of <code>Flask</code> (maybe called <code>Microblog</code>), with the <code>elasticsearch</code> attribute defined in its <code>__init__()</code> function.</p>
<p>Note how I use a <a href="https://docs.python.org/3/reference/expressions.html#conditional-expressions">conditional expression</a> to make the Elasticsearch instance <code>None</code> when a URL for the Elasticsearch service wasn't defined in the environment.</p>
<h2>A Full-Text Search Abstraction</h2>
<p>As I said in the chapter's introduction, I want to make it easy to switch from Elasticsearch to other search engines, and I also don't want to code this feature specifically for searching blog posts, I prefer to design a solution that in the future I can easily extend to other models if I need to. For all these reasons, I decided to create an <em>abstraction</em> for the search functionality. The idea is to design the feature in generic terms, so I will not be assuming that the <code>Post</code> model is the only one that needs to be indexed, and I will also not be assuming that Elasticsearch is the index engine of choice. But if I can't make any assumptions about anything, how can I get this work done?</p>
<p>The first thing that I need, is to somehow find a generic way to indicate which model and which field or fields in it are to be indexed. I'm going to say that any model that needs indexing needs to define a <code>__searchable__</code> class attribute that lists the fields that need to be included in the index. For the <code>Post</code> model, these are the changes:</p>
<p class="code_title"><i>app/models.py</i>: Add a \_\_searchable\_\_ attribute to the Post model.</p>

<pre><code class="language-python">class Post(db.Model):
    __searchable__ = ['body']
    # ...
</code></pre>
<p>So here I'm saying that this model needs to have its <code>body</code> field indexed. But just to make sure this is perfectly clear, this <code>__searchable__</code> attribute that I added is just a variable, it does not have any behavior associated with it. It will just help me write my indexing functions in a generic way.</p>
<p>I'm going to write all the code that interacts with the Elasticsearch index in a <em>app/search.py</em> module. The idea is to keep all the Elasticsearch code in this module. The rest of the application will use the functions in this new module to access the index and will not have direct access to Elasticsearch. This is important, because if one day I decided I don't like Elasticsearch anymore and want to switch to a different engine, all I need to do is rewrite the functions in this module, and the application will continue to work as before.</p>
<p>For this application, I decided that I need three supporting functions related to text indexing: I need to add entries to a full-text index, I need to remove entries from the index (assuming one day I will support deleting blog posts), and I need to execute a search query. Here is the <em>app/search.py</em> module that implements these three functions for Elasticsearch, using the functionality I showed you above from the Python console:</p>
<p class="code_title"><i>app/search.py</i>: Search functions.</p>

<pre><code class="language-python">from flask import current_app

def add_to_index(index, model):
    if not current_app.elasticsearch:
        return
    payload = {}
    for field in model.__searchable__:
        payload[field] = getattr(model, field)
    current_app.elasticsearch.index(index=index, id=model.id, body=payload)

def remove_from_index(index, model):
    if not current_app.elasticsearch:
        return
    current_app.elasticsearch.delete(index=index, id=model.id)

def query_index(index, query, page, per_page):
    if not current_app.elasticsearch:
        return [], 0
    search = current_app.elasticsearch.search(
        index=index,
        body={'query': {'multi_match': {'query': query, 'fields': ['*']}},
              'from': (page - 1) * per_page, 'size': per_page})
    ids = [int(hit['_id']) for hit in search['hits']['hits']]
    return ids, search['hits']['total']['value']
</code></pre>
<p>These functions all start by checking if <code>app.elasticsearch</code> is <code>None</code>, and in that case return without doing anything. This is so that when the Elasticsearch server isn't configured, the application continues to run without the search capability and without giving any errors. This is just as a matter of convenience during development or when running unit tests.</p>
<p>The functions accept the index name as an argument. In all the calls I'm passing down to Elasticsearch, I'm using this name as the index name and also as the document type, as I did in the Python console examples.</p>
<p>The functions that add and remove entries from the index take the SQLAlchemy model as a second argument. The <code>add_to_index()</code> function uses the <code>__searchable__</code> class variable I added to the model to build the document that is inserted into the index. If you recall, Elasticsearch documents also needed a unique identifier. For that I'm using the <code>id</code> field of the SQLAlchemy model, which is also conveniently unique. Using the same <code>id</code> value for SQLAlchemy and Elasticsearch is very useful when running the searches, as it allows me to link entries in the two databases. Something I did not mention above is that if you attempt to add an entry with an existing <code>id</code>, then Elasticsearch replaces the old entry with the new one, so <code>add_to_index()</code> can be used for new objects as well as for modified ones.</p>
<p>I did not show you the <code>es.delete()</code> function that I'm using in <code>remove_from_index()</code> before. This function deletes the document stored under the given <code>id</code>. Here is a good example of the convenience of using the same <code>id</code> to link entries in both databases.</p>
<p>The <code>query_index()</code> function takes the index name and a text to search for, along with pagination controls, so that search results can be paginated like Flask-SQLAlchemy results are. You have already seen an example usage of the <code>es.search()</code> function from the Python console. The call I'm issuing here is fairly similar, but instead of using a <code>match</code> query type, I decided to use <code>multi_match</code>, which can search across multiple fields. By passing a field name of <code>*</code>, I'm telling Elasticsearch to look in all the fields, so basically I'm searching the entire index. This is useful to make this function generic, since different models can have different field names in the index.</p>
<p>The <code>body</code> argument to <code>es.search()</code> includes pagination arguments in addition to the query itself. The <code>from</code> and <code>size</code> arguments control what subset of the entire result set needs to be returned. Elasticsearch does not provide a nice <code>Pagination</code> object like the one from Flask-SQLAlchemy, so I have to do the pagination math to calculate the <code>from</code> value.</p>
<p>The <code>return</code> statement in the <code>query_index()</code> function is somewhat complex. It returns two values: the first is a list of <code>id</code> elements for the search results, and the second is the total number of results. Both are obtained from the Python dictionary returned by the <code>es.search()</code> function. If you are not familiar with the expression that I'm using to obtain the list of IDs, this is called a <em>list comprehension</em>, and is a fantastic feature of the Python language that allows you to transform lists from one format to another. In this case I'm using the list comprehension to extract the <code>id</code> values from the much larger list of results provided by Elasticsearch.</p>
<p>Is this too confusing? Maybe a demonstration of these functions from the Python console can help you understand them a bit more. In the following session, I manually add all the posts from the database to the Elasticsearch index. In my test database, I had a few posts that had the numbers "one", "two", "three", "four" and "five" in them, so I used that as a search query. You may need to adapt your query to match the contents of your database:</p>
<pre><code class="language-python">&gt;&gt;&gt; from app.search import add_to_index, remove_from_index, query_index
&gt;&gt;&gt; for post in Post.query.all():
...     add_to_index('posts', post)
&gt;&gt;&gt; query_index('posts', 'one two three four five', 1, 100)
([15, 13, 12, 4, 11, 8, 14], 7)
&gt;&gt;&gt; query_index('posts', 'one two three four five', 1, 3)
([15, 13, 12], 7)
&gt;&gt;&gt; query_index('posts', 'one two three four five', 2, 3)
([4, 11, 8], 7)
&gt;&gt;&gt; query_index('posts', 'one two three four five', 3, 3)
([14], 7)
</code></pre>
<p>The query that I issued returned seven results. When I asked for page 1 with 100 items per page I get all seven, but then the next three examples shows how I can paginate the results in a way that is very similar to what I did for Flask-SQLAlchemy, with the exception that the results come as a list of IDs instead of SQLAlchemy objects.</p>
<p>If you want to keep things clean, delete the <code>posts</code> index after you are doing experimenting with it:</p>
<pre><code class="language-python">&gt;&gt;&gt; app.elasticsearch.indices.delete('posts')
</code></pre>
<h2>Integrating Searches with SQLAlchemy</h2>
<p>The solution that I showed you in the previous section is decent, but it still has a couple of problems. The most obvious problem is that results come as a list of numeric IDs. This is highly inconvenient, I need SQLAlchemy models so that I can pass them down to templates for rendering, and I need a way to replace that list of numbers with the corresponding models from the database. The second problem is that this solution requires the application to explicitly issue indexing calls as posts are added or removed, which is not terrible, but less than ideal, since a bug that causes a missed indexing call when making a change on the SQLAlchemy side is not going to be easily detected, the two databases will get out of sync more and more each time the bug occurs and you will probably not notice for a while. A better solution would be for these calls to be triggered automatically as changes are made on the SQLAlchemy database.</p>
<p>The problem of replacing the IDs with objects can be addressed by creating a SQLAlchemy query that reads those objects from the database. This sounds easy in practice, but doing it efficiently with a single query is actually a bit tricky to implement.</p>
<p>For the problem of triggering the indexing changes automatically, I decided to drive updates to the Elasticsearch index from SQLAlchemy <em>events</em>. SQLAlchemy provides a large list of <a href="http://docs.sqlalchemy.org/en/latest/core/event.html">events</a> that applications can be notified about. For example, each time a session is committed, I can have a function in the application invoked by SQLAlchemy, and in that function I can apply the same updates that were made on the SQLAlchemy session to the Elasticsearch index.</p>
<p>To implement the solutions to these two problems I'm going to write a <em>mixin</em> class. Remember mixin classes? In <a href="../../the-flask-mega-tutorial-part-v-user-logins-2018.html">Chapter 5</a>, I added the <code>UserMixin</code> class from Flask-Login to the <code>User</code> model, to give it some features that were required by Flask-Login. For the search support I'm going to define my own <code>SearchableMixin</code> class, that when attached to a model, will give it the ability to automatically manage an associated full-text index. The mixin class will act as a "glue" layer between the SQLAlchemy and Elasticsearch worlds, providing solutions to the two problems I stated above.</p>
<p>Let me show you the implementation, then I'll go over some interesting details. Note that this makes use of several advanced techniques, so you will need to study this code carefully to fully understand it.</p>
<p class="code_title"><i>app/models.py</i>: SearchableMixin class.</p>

<pre><code class="language-python">from app.search import add_to_index, remove_from_index, query_index

class SearchableMixin(object):
    @classmethod
    def search(cls, expression, page, per_page):
        ids, total = query_index(cls.__tablename__, expression, page, per_page)
        if total == 0:
            return cls.query.filter_by(id=0), 0
        when = []
        for i in range(len(ids)):
            when.append((ids[i], i))
        return cls.query.filter(cls.id.in_(ids)).order_by(
            db.case(when, value=cls.id)), total

    @classmethod
    def before_commit(cls, session):
        session._changes = {
            'add': list(session.new),
            'update': list(session.dirty),
            'delete': list(session.deleted)
        }

    @classmethod
    def after_commit(cls, session):
        for obj in session._changes['add']:
            if isinstance(obj, SearchableMixin):
                add_to_index(obj.__tablename__, obj)
        for obj in session._changes['update']:
            if isinstance(obj, SearchableMixin):
                add_to_index(obj.__tablename__, obj)
        for obj in session._changes['delete']:
            if isinstance(obj, SearchableMixin):
                remove_from_index(obj.__tablename__, obj)
        session._changes = None

    @classmethod
    def reindex(cls):
        for obj in cls.query:
            add_to_index(cls.__tablename__, obj)

db.event.listen(db.session, 'before_commit', SearchableMixin.before_commit)
db.event.listen(db.session, 'after_commit', SearchableMixin.after_commit)
</code></pre>
<p>There are four functions in this mixin class, all class methods. Just as a refresher, a class method is a special method that is associated with the class and not a particular instance. Note how I renamed the <code>self</code> argument used in regular instance methods to <code>cls</code>, to make it clear that this method receives a class and not an instance as its first argument. Once attached to the <code>Post</code> model for example, the <code>search()</code> method above would be invoked as <code>Post.search()</code>, without having to have an actual instance of class <code>Post</code>.</p>
<p>The <code>search()</code> class method wraps the <code>query_index()</code> function from <em>app/search.py</em> to replace the list of object IDs with actual objects. You can see that the first thing this function does is call <code>query_index()</code>, passing <code>cls.__tablename__</code> as the index name. This is going to be a convention, all indexes will be named with the name Flask-SQLAlchemy assigned to the relational table. The function returns the list of result IDs, and the total number of results. The SQLAlchemy query that retrieves the list of objects by their IDs is based on a <code>CASE</code> statement from the SQL language, which needs to be used to ensure that the results from the database come in the same order as the IDs are given. This is important because the Elasticsearch query returns results sorted from more to less relevant. If you want to learn more about the way this query works, you can consult the accepted answer to this <a href="https://stackoverflow.com/a/6332081/904393">StackOverflow question</a>. The <code>search()</code> function returns the query that replaces the list of IDs, and also passes through the total number of search results as a second return value.</p>
<p>The <code>before_commit()</code> and <code>after_commit()</code> methods are going to respond to two events from SQLAlchemy, which are triggered before and after a commit takes place respectively. The before handler is useful because the session hasn't been committed yet, so I can look at it and figure out what objects are going to be added, modified and deleted, available as <code>session.new</code>, <code>session.dirty</code> and <code>session.deleted</code> respectively. These objects are not going to be available anymore after the session is committed, so I need to save them before the commit takes place. I'm using a <code>session._changes</code> dictionary to write these objects in a place that is going to survive the session commit, because as soon as the session is committed I will be using them to update the Elasticsearch index.</p>
<p>When the <code>after_commit()</code> handler is invoked, the session has been successfully committed, so this is the proper time to make changes on the Elasticsearch side. The session object has the <code>_changes</code> variable that I added in <code>before_commit()</code>, so now I can iterate over the added, modified and deleted objects, and make the corresponding calls to the indexing functions in <em>app/search.py</em> for the objects that have the <code>SearchableMixin</code> class.</p>
<p>The <code>reindex()</code> class method is a simple helper method that you can use to refresh an index with all the data from the relational side. You saw me do something similar from the Python shell session above to do an initial load of all the posts into a test index. With this method in place, I can issue <code>Post.reindex()</code> to add all the posts in the database to the search index.</p>
<p>After the class definition I made two calls to SQLALchemy's function <code>db.event.listen()</code>. Note that these calls are not inside the class, but after it. The purpose of these two statements is to set up the event handlers that will make SQLAlchemy call the <code>before_commit()</code> and <code>after_commit()</code> methods before and after each commit respectively.</p>
<p>To incorporate the <code>SearchableMixin</code> class into the <code>Post</code> model I have to add it as a subclass, and I also need to hook up the before and after commit events:</p>
<p class="code_title"><i>app/models.py</i>: Adding the SearchableMixin class to the Post model.</p>

<pre><code class="language-python">class Post(SearchableMixin, db.Model):
    # ...
</code></pre>
<p>Now the <code>Post</code> model is automatically maintaining a full-text search index for posts. I can use the <code>reindex()</code> method to initialize the index from all the posts currently in the database:</p>
<pre><code class="language-python">&gt;&gt;&gt; Post.reindex()
</code></pre>
<p>And I can search posts working with SQLAlchemy models by running <code>Post.search()</code>. In the following example, I ask for the first page of five elements for my query:</p>
<pre><code class="language-python">&gt;&gt;&gt; query, total = Post.search('one two three four five', 1, 5)
&gt;&gt;&gt; total
7
&gt;&gt;&gt; query.all()
[&lt;Post five&gt;, &lt;Post two&gt;, &lt;Post one&gt;, &lt;Post one more&gt;, &lt;Post one&gt;]
</code></pre>
<h2>Search Form</h2>
<p>This was very intense. The work that I've done above to keep things generic touches on several advanced topics, so it may take you time to fully understand it. But now I have a complete system to work with natural language searches for blog posts. What I need to do now is integrate all this functionality with the application.</p>
<p>A fairly standard approach for web-based searches is to have the search term as a <code>q</code> argument in the query string of the URL. For example, if you wanted to search for <code>Python</code> on Google, and you want to save a couple of seconds, you can just type the following URL in your browser's address bar to go directly to the results:</p>
<pre><code>https://www.google.com/search?q=python
</code></pre>
<p>Allowing searches to be completely encapsulated in a URL is nice, because these can be shared with other people, who just by clicking on the link have access to the search results.</p>
<p>This introduces a change in the way I showed you to handle web forms in the past. I have used <code>POST</code> requests to submit form data for all the forms the application has so far, but to implement searches as above, the form submission will have to go as a <code>GET</code> request, which is the request method that is used when you type a URL in your browser or click a link. Another interesting difference is that the search form is going to be in the navigation bar, so it needs to be present in all pages of the application.</p>
<p>Here is the search form class, with just the <code>q</code> text field:</p>
<p class="code_title"><i>app/main/forms.py</i>: Search form.</p>

<pre><code class="language-python">from flask import request

class SearchForm(FlaskForm):
    q = StringField(_l('Search'), validators=[DataRequired()])

    def __init__(self, *args, **kwargs):
        if 'formdata' not in kwargs:
            kwargs['formdata'] = request.args
        if 'meta' not in kwargs:
            kwargs['meta'] = {'csrf': False}
        super(SearchForm, self).__init__(*args, **kwargs)
</code></pre>
<p>The <code>q</code> field does not require any explanation, as it is similar to other text fields I've used in the past. For this form, I decided not to have a submit button. For a form that has a text field, the browser will submit the form when you press Enter with the focus on the field, so a button is not needed. I have also added a <code>__init__</code> constructor function, which provides values for the <code>formdata</code> and <code>meta</code> arguments if they are not provided by the caller. The <code>formdata</code> argument determines from where Flask-WTF gets form submissions. The default is to use <code>request.form</code>, which is where Flask puts form values that are submitted via <code>POST</code> request. Forms that are submitted via <code>GET</code> request have the field values in the query string, so I need to point Flask-WTF at <code>request.args</code>, which is where Flask writes the query string arguments. And as you remember, forms have CSRF protection added by default, with the inclusion of a CSRF token that is added to the form via the <code>form.hidden_tag()</code> construct in templates. For clickable search links to work, CSRF needs to be disabled, so I'm setting <code>meta</code> to <code>{'csrf': False}</code> so that Flask-WTF knows that it needs to bypass CSRF validation for this form.</p>
<p>Since I'm going to need to have this form visible in all pages, I need to create an instance of the <code>SearchForm</code> class regardless of the page the user is viewing. The only requirement is that the user is logged in, because for anonymous users I am not currently showing any content. Instead of creating a form object in every route, and then passing the form to all the templates, I'm going to show you a very useful trick that eliminates duplication of code when you need to implement a feature across the entire application. I already used a <code>before_request</code> handler before, back in <a href="../../the-flask-mega-tutorial-part-vi-profile-page-and-avatars-2018.html">Chapter 6</a>, to record the time of last visit for each user. What I'm going to do is create my search form in that same function, but with a twist:</p>
<p class="code_title"><i>app/main/routes.py</i>: Instantiate the search form in the before\_request handler.</p>

<pre><code class="language-python">from flask import g
from app.main.forms import SearchForm

@bp.before_app_request
def before_request():
    if current_user.is_authenticated:
        current_user.last_seen = datetime.utcnow()
        db.session.commit()
        g.search_form = SearchForm()
    g.locale = str(get_locale())
</code></pre>
<p>Here I create an instance of the search form class when I have an authenticated user. But of course, I need this form object to persist until it can be rendered at the end of the request, so I need to store it somewhere. That somewhere is going to be the <code>g</code> container, provided by Flask. This <code>g</code> variable provided by Flask is a place where the application can store data that needs to persist through the life of a request. Here I'm storing the form in <code>g.search_form</code>, so then when the before request handler ends and Flask invokes the view function that handles the requested URL, the <code>g</code> object is going to be the same, and will still have the form attached to it. It's important to note that this <code>g</code> variable is specific to each request and each client, so even if your web server is handling multiple requests at a time for different clients, you can still rely on <code>g</code> to work as private storage for each request, independently of what goes on in other requests that are handled concurrently.</p>
<p>The next step is to render the form to the page. I said above that I wanted this form in all pages, so what makes more sense is to render it as part of the navigation bar. This is, in fact, simple, because templates can also see the data stored in the <code>g</code> variable, so I don't need to worry about adding the form as an explicit template argument in all the <code>render_template()</code> calls in the application. Here is how I can render the form in the base template:</p>
<p class="code_title"><i>app/templates/base.html</i>: Render the search form in the navigation bar.</p>

<pre><code class="language-html">            ...
            &lt;div class=&quot;collapse navbar-collapse&quot; id=&quot;bs-example-navbar-collapse-1&quot;&gt;
                &lt;ul class=&quot;nav navbar-nav&quot;&gt;
                    ... home and explore links ...
                &lt;/ul&gt;
                {% if g.search_form %}
                &lt;form class=&quot;navbar-form navbar-left&quot; method=&quot;get&quot;
                        action=&quot;{{ url_for('main.search') }}&quot;&gt;
                    &lt;div class=&quot;form-group&quot;&gt;
                        {{ g.search_form.q(size=20, class='form-control',
                            placeholder=g.search_form.q.label.text) }}
                    &lt;/div&gt;
                &lt;/form&gt;
                {% endif %}
                ...
</code></pre>
<p>The form is rendered only if <code>g.search_form</code> is defined. This check is necessary because some pages, such as error pages, may not have it defined. This form is slightly different than the ones I did previously. I'm setting its <code>method</code> attribute to <code>get</code>, because I want the form data to be submitted on the query string with a <code>GET</code> request. Also, the other forms I created had the <code>action</code> attribute empty, because they were submitted to the same page that rendered the form. This form is special because it appears in all pages, so I need to tell it explicitly where it needs to be submitted, which is a new route that is specifically dedicated to handling searches.</p>
<h2>Search View Function</h2>
<p>The last bit of functionality to complete the search feature is the view function that receives the search form submission. This view function is going to be attached to the <em>/search</em> route, so that you can send a search request with a <em>http://localhost:5000/search?q=search-words</em>, just like Google.</p>
<p class="code_title"><i>app/main/routes.py</i>: Search view function.</p>

<pre><code class="language-python">@bp.route('/search')
@login_required
def search():
    if not g.search_form.validate():
        return redirect(url_for('main.explore'))
    page = request.args.get('page', 1, type=int)
    posts, total = Post.search(g.search_form.q.data, page,
                               current_app.config['POSTS_PER_PAGE'])
    next_url = url_for('main.search', q=g.search_form.q.data, page=page + 1) \
        if total &gt; page * current_app.config['POSTS_PER_PAGE'] else None
    prev_url = url_for('main.search', q=g.search_form.q.data, page=page - 1) \
        if page &gt; 1 else None
    return render_template('search.html', title=_('Search'), posts=posts,
                           next_url=next_url, prev_url=prev_url)
</code></pre>
<p>You have seen that in the other forms I used the <code>form.validate_on_submit()</code> method to check if the form submission was valid. Unfortunately that method only works for forms submitted via <code>POST</code> request, so for this form I need to use <code>form.validate()</code> which just validates field values, without checking how the data was submitted. If the validation fails, it is because the user submitted an empty search form, so in that case I just redirect to the explore page, which shows all blog posts.</p>
<p>The <code>Post.search()</code> method from my <code>SearchableMixin</code> class is used to obtain the list of search results. The pagination is handled in a very similar way to that of the index and explore pages, but generating the next and previous links is a little bit trickier without the help of the <code>Pagination</code> object from Flask-SQLAlchemy. This is where the total number of results passed as a second return value from <code>Post.search()</code> is useful.</p>
<p>Once the page of search results and pagination links are calculated, all that is left is to render a template with all this data. I could have figured out a way to reuse the <em>index.html</em> template to display search results, but given that there are a few differences I decided to create a dedicated <em>search.html</em> template that is dedicated to show search results, taking advantage of the <em>_post.html</em> sub-template to render the search results:</p>
<p class="code_title"><i>app/templates/search.html</i>: Search results template.</p>

<pre><code class="language-html">{% extends &quot;base.html&quot; %}

{% block app_content %}
    &lt;h1&gt;{{ _('Search Results') }}&lt;/h1&gt;
    {% for post in posts %}
        {% include '_post.html' %}
    {% endfor %}
    &lt;nav aria-label=&quot;...&quot;&gt;
        &lt;ul class=&quot;pager&quot;&gt;
            &lt;li class=&quot;previous{% if not prev_url %} disabled{% endif %}&quot;&gt;
                &lt;a href=&quot;{{ prev_url or '#' }}&quot;&gt;
                    &lt;span aria-hidden=&quot;true&quot;&gt;&amp;larr;&lt;/span&gt;
                    {{ _('Previous results') }}
                &lt;/a&gt;
            &lt;/li&gt;
            &lt;li class=&quot;next{% if not next_url %} disabled{% endif %}&quot;&gt;
                &lt;a href=&quot;{{ next_url or '#' }}&quot;&gt;
                    {{ _('Next results') }}
                    &lt;span aria-hidden=&quot;true&quot;&gt;&amp;rarr;&lt;/span&gt;
                &lt;/a&gt;
            &lt;/li&gt;
        &lt;/ul&gt;
    &lt;/nav&gt;
{% endblock %}
</code></pre>
<p>If the rendering logic for the previous and next links gets a bit confusing it might help to review the Bootstrap documentation for the <a href="https://getbootstrap.com/docs/3.3/components/#pagination">pagination component</a>.</p>
<p><img alt="Search Results" src="../../../static/images/mega-tutorial/ch10-search-results.png" /></p>
<p>What do you think? This was an intense chapter, where I presented some fairly advanced techniques. Some of the concepts in this chapter may take some time to sink in. The most important take away from this chapter is that if you want to use a different search engine than Elasticsearch, all you need to do is re-implement the three functions in <em>app/search.py</em>. The other important benefit of going through this effort is that in the future, if I need to add search support for a different database model, I can simply do so by adding the <code>SearchableMixin</code> class to it, the <code>__searchable__</code> attribute with the list of fields to index and the SQLAlchemy event handler connections. I think it was well worth the effort, because from now on, it is going to be easy to deal with full-text indexes.</p></div>

<div class="card patreon-bar">
  <div class="card-body">
    <h5>Become a Patron!</h5>
    <p class="card-text">Hello, and thank you for visiting my blog! If you enjoyed this article, please consider supporting my work on this blog on <a href="https://patreon.com/miguelgrinberg">Patreon</a>!</p>
    <a href="https://patreon.com/miguelgrinberg" alt="Become a Patron!" title="Become a Patron!"><img src="../../../static/patreon-button.png"></a>
  </div>
</div>


<div class="card social-bar">
  <div class="card-body">
    <h5>Share this post:</h5>
      <!-- Sharingbutton Hacker News -->
      <a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018&amp;t=The%20Flask%20Mega-Tutorial%20Part%20XVI%3A%20Full-Text%20Search%20%282018%29" target="_blank" rel="noopener" aria-label="Hacker News">
        <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 140"><path fill-rule="evenodd" d="M60.94 82.314L17 0h20.08l25.85 52.093c.397.927.86 1.888 1.39 2.883.53.994.995 2.02 1.393 3.08.265.4.463.764.596 1.095.13.334.262.63.395.898.662 1.325 1.26 2.618 1.79 3.877.53 1.26.993 2.42 1.39 3.48 1.06-2.254 2.22-4.673 3.48-7.258 1.26-2.585 2.552-5.27 3.877-8.052L103.49 0h18.69L77.84 83.308v53.087h-16.9v-54.08z"></path></svg></div>Hacker News</div>
      </a>

      <!-- Sharingbutton Reddit -->
      <a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018&amp;resubmit=true&amp;title=The%20Flask%20Mega-Tutorial%20Part%20XVI:%20Full-Text%20Search%20(2018)" target="_blank" rel="noopener" aria-label="Reddit">
        <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.5c0-1.65-1.35-3-3-3-.96 0-1.86.48-2.42 1.24-1.64-1-3.75-1.64-6.07-1.72.08-1.1.4-3.05 1.52-3.7.72-.4 1.73-.24 3 .5C17.2 6.3 18.46 7.5 20 7.5c1.65 0 3-1.35 3-3s-1.35-3-3-3c-1.38 0-2.54.94-2.88 2.22-1.43-.72-2.64-.8-3.6-.25-1.64.94-1.95 3.47-2 4.55-2.33.08-4.45.7-6.1 1.72C4.86 8.98 3.96 8.5 3 8.5c-1.65 0-3 1.35-3 3 0 1.32.84 2.44 2.05 2.84-.03.22-.05.44-.05.66 0 3.86 4.5 7 10 7s10-3.14 10-7c0-.22-.02-.44-.05-.66 1.2-.4 2.05-1.54 2.05-2.84zM2.3 13.37C1.5 13.07 1 12.35 1 11.5c0-1.1.9-2 2-2 .64 0 1.22.32 1.6.82-1.1.85-1.92 1.9-2.3 3.05zm3.7.13c0-1.1.9-2 2-2s2 .9 2 2-.9 2-2 2-2-.9-2-2zm9.8 4.8c-1.08.63-2.42.96-3.8.96-1.4 0-2.74-.34-3.8-.95-.24-.13-.32-.44-.2-.68.15-.24.46-.32.7-.18 1.83 1.06 4.76 1.06 6.6 0 .23-.13.53-.05.67.2.14.23.06.54-.18.67zm.2-2.8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5.7-2.13c-.38-1.16-1.2-2.2-2.3-3.05.38-.5.97-.82 1.6-.82 1.1 0 2 .9 2 2 0 .84-.53 1.57-1.3 1.87z"/></svg></div>Reddit</div>
      </a>

      <!-- Sharingbutton Twitter -->
      <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=The%20Flask%20Mega-Tutorial%20Part%20XVI%3A%20Full-Text%20Search%20%282018%29&amp;url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018" target="_blank" rel="noopener" aria-label="Twitter">
        <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg></div>Twitter</div>
      </a>

      <!-- Sharingbutton LinkedIn -->
      <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018&amp;title=The%20Flask%20Mega-Tutorial%20Part%20XVI%3A%20Full-Text%20Search%20%282018%29&amp;summary=The%20Flask%20Mega-Tutorial%20Part%20XVI%3A%20Full-Text%20Search%20%282018%29&amp;source=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018" target="_blank" rel="noopener" aria-label="LinkedIn">
        <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg></div>LinkedIn</div>
      </a>

      <!-- Sharingbutton Facebook -->
      <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018" target="_blank" rel="noopener" aria-label="Facebook">
        <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg></div>Facebook</div>
      </a>

      <!-- Sharingbutton E-Mail -->
      <a class="resp-sharing-button__link" href="mailto:?subject=The%20Flask%20Mega-Tutorial%20Part%20XVI%3A%20Full-Text%20Search%20%282018%29&amp;body=https%3A//blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018" target="_self" rel="noopener" aria-label="E-Mail">
        <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--medium"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9 0 6v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17 0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1 0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08 0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"/></svg></div>E-Mail</div>
      </a>

  </div>
</div>

<div id="comments" class="post-comment-count">
  
  <a class="btn btn-outline-secondary" href="../../the-flask-mega-tutorial-part-xvi-full-text-search-2018.html#comments">415 comments</a>
  
</div>


<div class="comments">
  <ul>
    
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#101</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-11-20T10:05:54Z" data-function="fromNow" data-refresh="0" style="display: none">2018-11-20T10:05:54Z</span>
  </p>
  <div>
    <p>@Krzysztof: I do not know how any of these new Flask-Whooshalchemy clones work, all I know is that the original was flawed. The error that you get appears to be because you are using "current_app" in a place where there is an app context. If you replace that with the actual application instance I think you will bypass the error.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/52e878e99f35b8c1b8d4d0210f4d82b8?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#102</span> <span class="badge text-bg-warning">Philip Nwaobasi</span> said
    
    <span class="flask-moment" data-timestamp="2018-11-27T00:07:36Z" data-function="fromNow" data-refresh="0" style="display: none">2018-11-27T00:07:36Z</span>
  </p>
  <div>
    <p>Hello Miguel/Everyone. Can anyone help with this if they have previously encountered it? My understanding of this line: </p>
<p>app.elasticsearch = Elasticsearch([app.config['ELASTICSEARCH_URL']]) \<br>
        if app.config['ELASTICSEARCH_URL'] else None</p>
<p>Was that if the ELASTICSEARCH_URL was not provided in the app.config file, it will stop the Elasticsearch functionality. However, when i comment out the URL, i get the traceback below:</p>
<p>Traceback (most recent call last):<br>
  File "c:\users\workstation\appdata\local\programs\python\python36\lib\site-packages\<a href="http://flask_compat.py/" rel="nofollow">flask_compat.py</a>", line 35, in reraise<br>
    raise value<br>
  File "D:\Projects\truthspearmint\<a href="http://spearmint.py/" rel="nofollow">spearmint.py</a>", line 2, in &lt;module&gt;<br>
    app = create_app()<br>
  File "D:\Projects\truthspearmint\<a href="http://app__init__.py/" rel="nofollow">app__init__.py</a>", line 35, in create_app<br>
    if app.config['ELASTICSEARCH_URL'] else None<br>
KeyError: 'ELASTICSEARCH_URL'</p>
<p>Which seems to be suggesting that the URL must be provided. I am having trouble with the Elasticsearch functionality, as i constantly get this error:</p>
<p>elasticsearch.exceptions.AuthorizationException: TransportError(403, 'cluster_block_exception', 'blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];')</p>
<p>Nothing i have tried so far has remedied this, so i wanted to switch off Elasticsearch for the time being, so i can continuing working on my app.</p>
<p>Any help will be sincerely appreciated. Thank you</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#103</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-11-27T10:17:51Z" data-function="fromNow" data-refresh="0" style="display: none">2018-11-27T10:17:51Z</span>
  </p>
  <div>
    <p>@Philip: the configuration variable needs to always exist. What you can omit is the environment variable from where its value comes from. If the env variable is missing the configuration variable is going to be set to None, and that is what disables the search code.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/11f90d112afc2e487c5bea1505536d55?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#104</span> <span class="badge text-bg-warning">bonny</span> said
    
    <span class="flask-moment" data-timestamp="2018-11-29T20:55:41Z" data-function="fromNow" data-refresh="0" style="display: none">2018-11-29T20:55:41Z</span>
  </p>
  <div>
    <p>Hey Mr Miguel, thank you for the tutorial it's I really love it. I would like you to help me explain what could be the cause of this error</p>
<p>RequestError: TransportError(400, u'search_phase_execution_exception', u'For input string: "kampala"')</p>
<p>Thank you</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#105</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-11-29T22:30:07Z" data-function="fromNow" data-refresh="0" style="display: none">2018-11-29T22:30:07Z</span>
  </p>
  <div>
    <p>@bonny: you need to check the Elasticsearch logs to see if there are any errors or clues. You can also try recreating your database by deleting the index, and then using the reindex() method shown in this article to repopulate the index again.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/83601d44993da43cf18bf27c98cdc3d9?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#106</span> <span class="badge text-bg-warning">Krzysztof </span> said
    
    <span class="flask-moment" data-timestamp="2018-12-02T23:17:35Z" data-function="fromNow" data-refresh="0" style="display: none">2018-12-02T23:17:35Z</span>
  </p>
  <div>
    <p>Hello Miguel,</p>
<p>I managed to bypass an error and a .toc file has been created on a startup. However, having applied all these changes in the Models, flask_whooshalchemy is supposed to hook up into flask_sqlalchemy, e.g. to modify its classes. Without it, there is no possibility of searching via Model.query.seach(). The necessary changes are stored in the QueryProxy class in the <strong>init</strong> file for flask_whooshalchemy: <a href="https://github.com/blakev/Flask-WhooshAlchemy3/blob/master/flask_whooshalchemy/" rel="nofollow">https://github.com/blakev/Flask-WhooshAlchemy3/blob/master/flask_whooshalchemy/</a><strong>init</strong>.py Would you be able to suggest a way to implement these changes? <br>
I might be wrong, but I assumed that by simply importing a module such as flask_whooshalchemy we prompt the <strong>init</strong> to be run, thus importing all the elements contained within. Please let me know if these assumptions were incorrect.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#107</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-12-03T09:33:44Z" data-function="fromNow" data-refresh="0" style="display: none">2018-12-03T09:33:44Z</span>
  </p>
  <div>
    <p>@Krzysztof: I really don't know. The flask-whooshalchemy extension is old, it may not even work with recent versions of Flask. I suggest you use my new solution, which you can implement using whoosh instead of elasticsearch, without relying on flask-whooshalchemy.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/5a0abf27d91c5078af1f6c1f7bbe9617?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#108</span> <span class="badge text-bg-warning">xccx</span> said
    
    <span class="flask-moment" data-timestamp="2018-12-16T04:45:08Z" data-function="fromNow" data-refresh="0" style="display: none">2018-12-16T04:45:08Z</span>
  </p>
  <div>
    <p>Hi Miguel, thanks for this tutorial. <br>
I want to ask a question:<br>
The  g.search_form.validate()  is always false.<br>
But if I delete the two sentences:<br>
if not g.search_form.validate():<br>
        return redirect(url_for('main.explore'))</p>
<p>I can get the right results.<br>
So,  is the validate()  is still available?</p>
<p>Thank you very much!</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#109</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-12-16T12:28:16Z" data-function="fromNow" data-refresh="0" style="display: none">2018-12-16T12:28:16Z</span>
  </p>
  <div>
    <p>@xccx: the validate() method for the search form should return False only when the search field is empty. You may want to check how you defined and rendered your form versus my version, you may have differences there. In particular, this form is different than others in that it disables CSRF token validation, the reason is discussed in the article. Maybe you missed that part?</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/3bcfb06412adc201a697aa7048e4f28a?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#110</span> <span class="badge text-bg-warning">Rohit Dalal</span> said
    
    <span class="flask-moment" data-timestamp="2018-12-17T07:17:23Z" data-function="fromNow" data-refresh="0" style="display: none">2018-12-17T07:17:23Z</span>
  </p>
  <div>
    <p>Hello Sir,</p>
<p>I have two queries - </p>
<p>1) <br>
class SearchableMixin(object):<br>
    @classmethod<br>
    def search(cls, expression, page, per_page):<br>
        ids, total = query_index(cls.<strong>tablename</strong>, expression, page, per_page)<br>
        if total == 0:<br>
            return cls.query.filter_by(id=0), 0</p>
<p>if total == 0 why not just return [], 0 is there any specific need to make one extra db query searching id = 0 which will always be empty</p>
<p>2) When searching some random text which is not there in posts getting following error - <br>
elasticsearch.exceptions.RequestError<br>
elasticsearch.exceptions.RequestError: RequestError(400, 'search_phase_execution_exception', 'For input string: "adawdwadawwd"')</p>
<p>Please tell a way to resolve this issue.</p>
<p>Thank you for this awesome tutorials.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#111</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-12-17T09:26:17Z" data-function="fromNow" data-refresh="0" style="display: none">2018-12-17T09:26:17Z</span>
  </p>
  <div>
    <p>@Rohit: 1) the return value must be a database query, not a list of results. 2) what version of elasticsearch are you using? I do not see those errors here.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/e6d9400c115713d374cedf36c9ec2f16?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#112</span> <span class="badge text-bg-warning">Dima</span> said
    
    <span class="flask-moment" data-timestamp="2018-12-17T18:24:50Z" data-function="fromNow" data-refresh="0" style="display: none">2018-12-17T18:24:50Z</span>
  </p>
  <div>
    <p>Miguel, this is a great tutorial. I heavily use it on my work.<br>
One question - could you please explain how to update nginx config if I want to use elasticsearch?<br>
So far I have the following, but it does work. I have error <code>(111: Connection refused) while connecting to upstream</code><br>
```<br>
upstream elasticsearch {<br>
    server 127.0.0.1:9200;<br>
    keepalive 64;<br>
}</p>
<p>server {<br>
    listen 8080;<br>
    location /search {<br>
    proxy_pass http://elasticsearch;<br>
    proxy_http_version 1.1;<br>
    proxy_set_header Connection "Keep-Alive";<br>
    proxy_set_header Proxy-Connection "Keep-Alive";<br>
    }<br>
}</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#113</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2018-12-17T23:30:53Z" data-function="fromNow" data-refresh="0" style="display: none">2018-12-17T23:30:53Z</span>
  </p>
  <div>
    <p>@Dima: Elasticsearch is an internal service, it does not need to be exported to the outside world by nginx. The correct thing to do is to not include elasticsearch in nginx, as I do it in the deployment chapter a bit later.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/70fa8019f92fcec60f83a34b14ee87b2?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#114</span> <span class="badge text-bg-warning">David A</span> said
    
    <span class="flask-moment" data-timestamp="2019-01-04T20:46:28Z" data-function="fromNow" data-refresh="0" style="display: none">2019-01-04T20:46:28Z</span>
  </p>
  <div>
    <p>Hi Miguel,<br>
I am a big fan of this tutorial series. I am working through it with windows 10 and I have come across this issue in this chapter: <br>
Traceback (most recent call last):<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\flask\<a href="http://app.py/" rel="nofollow">app.py</a>", line 2309, in <strong>call</strong><br>
    return self.wsgi_app(environ, start_response)<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\flask\<a href="http://app.py/" rel="nofollow">app.py</a>", line 2295, in wsgi_app<br>
    response = self.handle_exception(e)<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\flask\<a href="http://app.py/" rel="nofollow">app.py</a>", line 1741, in handle_exception<br>
    reraise(exc_type, exc_value, tb)<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\<a href="http://flask_compat.py/" rel="nofollow">flask_compat.py</a>", line 35, in reraise<br>
    raise value<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\flask\<a href="http://app.py/" rel="nofollow">app.py</a>", line 2292, in wsgi_app<br>
    response = self.full_dispatch_request()<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\flask\<a href="http://app.py/" rel="nofollow">app.py</a>", line 1815, in full_dispatch_request<br>
    rv = self.handle_user_exception(e)<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\flask\<a href="http://app.py/" rel="nofollow">app.py</a>", line 1718, in handle_user_exception<br>
    reraise(exc_type, exc_value, tb)<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\<a href="http://flask_compat.py/" rel="nofollow">flask_compat.py</a>", line 35, in reraise<br>
    raise value<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\flask\<a href="http://app.py/" rel="nofollow">app.py</a>", line 1813, in full_dispatch_request<br>
    rv = self.dispatch_request()<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\flask\<a href="http://app.py/" rel="nofollow">app.py</a>", line 1799, in dispatch_request<br>
    return self.view_functions<a href="__req.html" rel="nofollow">rule.endpoint</a><br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\flask_login\<a href="http://utils.py/" rel="nofollow">utils.py</a>", line 261, in decorated_view<br>
    return func(<em>args, </em><em>kwargs)<br>
  File "C:\Users\flyff\Desktop\Flask Megatutorial\microblog\app\main\<a href="http://routes.py/" rel="nofollow">routes.py</a>", line 144, in search<br>
    current_app.config['POSTS_PER_PAGE'])<br>
  File "C:\Users\flyff\Desktop\Flask Megatutorial\microblog\app\<a href="http://models.py/" rel="nofollow">models.py</a>", line 15, in search<br>
    ids, total = query_index(cls.<strong>tablename</strong>, expression, page, per_page)<br>
  File "C:\Users\flyff\Desktop\Flask Megatutorial\microblog\app\<a href="http://search.py/" rel="nofollow">search.py</a>", line 26, in query_index<br>
    'from': (page - 1) * per_page, 'size': per_page})<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\elasticsearch\client\<a href="http://utils.py/" rel="nofollow">utils.py</a>", line 76, in _wrapped<br>
    return func(</em>args, params=params, **kwargs)<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\elasticsearch\<a href="http://client__init__.py/" rel="nofollow">client__init__.py</a>", line 660, in search<br>
    doc_type, '_search'), params=params, body=body)<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\elasticsearch\<a href="http://transport.py/" rel="nofollow">transport.py</a>", line 318, in perform_request<br>
    status, headers_response, data = connection.perform_request(method, url, params, body, headers=headers, ignore=ignore, timeout=timeout)<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\elasticsearch\connection\<a href="http://http_urllib3.py/" rel="nofollow">http_urllib3.py</a>", line 186, in perform_request<br>
    self._raise_error(response.status, raw_data)<br>
  File "c:\users\flyff\desktop\flask megatutorial\microblog\venv\lib\site-packages\elasticsearch\connection\<a href="http://base.py/" rel="nofollow">base.py</a>", line 125, in _raise_error<br>
    raise HTTP_EXCEPTIONS.get(status_code, TransportError)(status_code, error_message, additional_info)<br>
elasticsearch.exceptions.NotFoundError: NotFoundError(404, 'index_not_found_exception', 'no such index')</p>
<p>Another possibly related issue is after using query, total = Post.search('one two three four five', 1, 5) I get:<br>
NameError: name 'Post' is not defined</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#115</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2019-01-04T23:24:10Z" data-function="fromNow" data-refresh="0" style="display: none">2019-01-04T23:24:10Z</span>
  </p>
  <div>
    <p>David: were you able to run the elasticsearch exercises from the article in the console? The error indicates the elasticsearch index does not exist, so it seems you did not add anything to the index.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/1bbc5011c3e0f682d7db7247dc821b49?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#116</span> <span class="badge text-bg-warning">Goga</span> said
    
    <span class="flask-moment" data-timestamp="2019-01-05T00:49:13Z" data-function="fromNow" data-refresh="0" style="display: none">2019-01-05T00:49:13Z</span>
  </p>
  <div>
    <p>Hi. Miguel. I am having the following problem. if i try to launch flask shell in cmd, I get RuntimeError: Working outside of application context. if i start python shell and do : from app.search import add_to_index, remove_from_index, query_index    and then  Post.query.all()  I get name 'Post' is not defined.<br>
then i do : from app import create_app  and then app = create_app()   I again get Working outside of application context .  and the same result with </p>
<blockquote>
<blockquote>
<blockquote>
<p>from app import db, create_app<br>
db.create_all(app=create_app())</p>
</blockquote>
</blockquote>
</blockquote>
<p>So what confuses me is how am I supposed to push app context if when I am trying to do that, I am already required to have app context.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#117</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2019-01-05T14:50:29Z" data-function="fromNow" data-refresh="0" style="display: none">2019-01-05T14:50:29Z</span>
  </p>
  <div>
    <p>@Goga: are you following the tutorial chapters in order? Sounds like you might be skipping things. Go back to Chapter 4 and make sure you can complete your database and shell set up.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/a5e02c0e52e27fd05ffe819addcbe67f?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#118</span> <span class="badge text-bg-warning">David A</span> said
    
    <span class="flask-moment" data-timestamp="2019-01-25T19:35:42Z" data-function="fromNow" data-refresh="0" style="display: none">2019-01-25T19:35:42Z</span>
  </p>
  <div>
    <p>Hi Miguel,<br>
I am running into an issue when trying to search. I get the following error: elasticsearch.exceptions.NotFoundError: NotFoundError(404, 'index_not_found_exception', 'no such index'). Does this error mean I need to delete and recreate the indexes? If so could you guide me. Also note I am on Windows. Would this be related to another issue I have in which Post is not defined when trying to execute this section of the tutorial: &gt;&gt;&gt; from app.search import add_to_index, remove_from_index, query_index</p>
<blockquote>
<blockquote>
<blockquote>
<p>for post in Post.query.all():<br>
...     add_to_index('posts', post)</p>
</blockquote>
</blockquote>
</blockquote>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#119</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2019-01-25T23:45:26Z" data-function="fromNow" data-refresh="0" style="display: none">2019-01-25T23:45:26Z</span>
  </p>
  <div>
    <p>@David: The "Post is not defined" could be that you haven't imported the Post model. Once you fix that you will be able to generate the elasticsearch index, and once you have an index created you will not get the 'index not found" error anymore.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/76102c740544771caf057622726fe297?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#120</span> <span class="badge text-bg-warning">Flaviu</span> said
    
    <span class="flask-moment" data-timestamp="2019-02-26T09:46:35Z" data-function="fromNow" data-refresh="0" style="display: none">2019-02-26T09:46:35Z</span>
  </p>
  <div>
    <p>Hi Miguel,</p>
<p>Many thanks for your tutorial! I think in your tutorial or your book (I use both of them) you split the databases and the config between test, dev and prod environment. How would you recomment doing the same with elastic search environment?</p>
<p>I was thinking using prefixes like test-, dev-, and prod- in front of the index names. Would that be a good idea? I couldn't think of something else.</p>
<p>Regards,<br>
Flaviu</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#121</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2019-02-26T19:07:21Z" data-function="fromNow" data-refresh="0" style="display: none">2019-02-26T19:07:21Z</span>
  </p>
  <div>
    <p>@Flaviu: you can use different elasticsearch databases if that's possible. In general you do not want to use the same database for multiple purposes. But if you must use a single database, then a prefix on all the index names is a decent solution.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/fe2d3a369c5c64c904f5c967bb13f848?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#122</span> <span class="badge text-bg-warning">Roger</span> said
    
    <span class="flask-moment" data-timestamp="2019-02-27T09:23:14Z" data-function="fromNow" data-refresh="0" style="display: none">2019-02-27T09:23:14Z</span>
  </p>
  <div>
    <p>@Miguel, thanks for this tutorial, I'd like to set ik-analyzer as my ElasticSearch analyzer instead of default Standard analyzer. It works directly on HTTP request:<br>
curl -H 'Content-Type: application/json'  -XGET 'localhost:9200/_analyze?pretty' -d '{"analyzer":"ik_max_word","text":"Some Keywords"}'<br>
then I try to combine this analyzer "ik_max_word" into Mega-Tutorial project, I could not find the effective config, can you give some hints about it? thank you!</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#123</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2019-02-27T10:48:51Z" data-function="fromNow" data-refresh="0" style="display: none">2019-02-27T10:48:51Z</span>
  </p>
  <div>
    <p>@Roger: I have never done this myself, but looking at the docs, it appears all you need to do is create a mapping from the fields in your index to this analyzer plugin. Since my usage in this chapter is fairly simple, I decided not to explicitly create an index. But in your case, you will need to create the index and configure it with the proper mapping. The Python client has an index creation function: <a href="https://elasticsearch-py.readthedocs.io/en/master/api.html#elasticsearch.client.IndicesClient.create" rel="nofollow">https://elasticsearch-py.readthedocs.io/en/master/api.html#elasticsearch.client.IndicesClient.create</a>.</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/91ac296cdb743e96d94d3b159832f8ed?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#124</span> <span class="badge text-bg-warning">Samuel</span> said
    
    <span class="flask-moment" data-timestamp="2019-04-10T13:09:25Z" data-function="fromNow" data-refresh="0" style="display: none">2019-04-10T13:09:25Z</span>
  </p>
  <div>
    <p>Hi, Miguel ! Thanks for this whole body of information ! I have learned alot. I have one issue and maybe you can throw some light. My SQLAlchemy models have many-to-many relationships(ex. multiple Plants can have multiple elements). I have tried to add the relationship attribute for the elements to the <strong>searchable</strong> variable, but I got the error SerializationError, because they are coming from a Select Multiple list and every element was passed as an individual object. I have tried to convert to JSON, but that doesn't work, so I deleted those relationships attr from the <strong>searchable</strong>, but in the console ofc they don't get indexed so I cannot search for a plant which has an element as Nitrogen. How can this be solved ? I was thinking to modify something in the SearchableMixin probably? Thank you !</p>
  </div>
</div>
    </li>
    
    <li>
      <div class="comment-thumbnail"><img class="rounded" src="https://gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35?s=60&amp;d=identicon"></div>
<div class="comment-body">
  
  <p>
    
    <span class="badge bg-secondary">#125</span> <span class="badge text-bg-danger">Miguel Grinberg</span> said
    
    <span class="flask-moment" data-timestamp="2019-04-10T17:15:25Z" data-function="fromNow" data-refresh="0" style="display: none">2019-04-10T17:15:25Z</span>
  </p>
  <div>
    <p>@Samuel: the elasticsearch index is used to search text, not to search relationships. Are you sure what you need can't be done strictly within SQLAlchemy and your relational database?</p>
  </div>
</div>
    </li>
    
  </ul>
</div>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <li class="page-item"><a class="page-link" href="1.html#comments">&laquo;&laquo;</a></li>
    <li class="page-item"><a class="page-link" href="4.html#comments">&laquo;</a></li>
    <li class="page-item"><a class="page-link" href="6.html#comments">&raquo;</a></li>
    <li class="page-item"><a class="page-link" href="0.html#comments">&raquo;&raquo;</a></li>
  </ul>
</nav>



<div id="comment-form">
  <h3>Leave a Comment</h3>

  
  
  

  
<form action="#comment-form" method="post">
  <input id="url" name="url" type="hidden" value="">
<input id="csrf_token" name="csrf_token" type="hidden" value="IjQyYjY5YzZlNTcyYjFkMTVlZGRkOWJjYjA3ZmFlYWFiNTg3YmU5ODki.ZxdnVA.MmaTVsUkShsnxZMD-BUxFUBaA0g">
    
  <div class="mb-3">
    <label class="form-label" for="name">Name</label>
    <div class="input-group has-validation">
      <input class="form-control" id="name" name="name" required type="text" value="">
    </div>
  </div>

    
    
  <div class="mb-3">
    <label class="form-label" for="email">Email</label>
    <div class="input-group has-validation">
      <input class="form-control" id="email" name="email" required type="text" value="">
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="comment">Comment</label>
    <div class="input-group has-validation">
      <textarea class="form-control" id="comment" name="comment" required>
</textarea>
    </div>
  </div>

    
  <div class="mb-3">
    <label class="form-label" for="captcha">Captcha</label>
    <div class="input-group has-validation">
      
<script src='https://www.google.com/recaptcha/api.js' async defer></script>
<div class="g-recaptcha" data-sitekey="6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S"></div>

    </div>
  </div>

    
  <input class="btn btn-primary mb-3" id="submit" name="submit" type="submit" value="Submit">

      
</form>

</div>


</div>

      </div>
    </div>
    
    <div class="col-md-4">
      <div id="sidebar">
        
          
  



<div class="card">
  
  
  
  
  <div class="card-header">
    <div class="row">
      <div class="col">The Flask Mega-Tutorial</div>
      <div class="col text-end">
        <a href="../../announcing-the-flask-mega-tutorial-2024-edition.html">
          <h5 style="margin-bottom: 0px"><span class="badge text-bg-warning">New 2024 Edition!</span></h5>
        </a>
      </div>
    </div>
  </div>
  <a class="card-book-cover" href="https://courses.miguelgrinberg.com/p/flask-mega-tutorial">
    <img src="../../../static/mega-tutorial-2024-small.png" alt="The New Flask Mega-Tutorial">
  </a>
  <div class="card-body">
    <p class="card-text">If you would you like to support my work on my <a href="../../the-flask-mega-tutorial-part-i-hello-world.html">Flask Mega-Tutorial series</a> on this blog and as a reward have access to the complete tutorial nicely structured as a book and/or a set of videos, you can now order it from my <a href="https://courses.miguelgrinberg.com/p/flask-mega-tutorial">Courses</a> site or from <a href="https://amzn.to/3MQffrm">Amazon</a>.</p>
  </div>
  <div class="card-body">
    <a class="card-link" href="https://amzn.to/3MQffrm">Click here to get the Book!</a><br />
    <a class="card-link" href="https://courses.miguelgrinberg.com/p/flask-mega-tutorial">Click here to get the Video Course!</a>
  </div>

  
</div>
        
        <div class="card">
  <div class="card-header">About Miguel</div>
  <div class="card-body">
    <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="../../../static/miguel.jpg" />
    <p class="card-text">Welcome to my blog!</p>
    <p class="card-text">I'm a software engineer and technical writer, currently living in Drogheda, Ireland.</p>
    <p class="card-text">You can also find me on <a href="https://twitter.com/miguelgrinberg">Twitter</a>, <a href="https://mstdn.social/@miguelgrinberg">Mastodon</a>, <a href="https://github.com/miguelgrinberg">Github</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a>, <a href="https://youtube.com/miguelgrinberg">YouTube</a>, <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a> and <a href="https://patreon.com/miguelgrinberg">Patreon</a>.</p>
    <p class="card-text">Thank you for visiting!</p>
  </div>
</div>
        
        <div class="card" id="categories">
  <div class="card-header">Categories</div>
  <div class="card-body">
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AI/feed"><img src="../../../static/rss-small.png" title="AI RSS Feed" label="AI RSS Feed" alt="AI RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AI" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AI" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/AWS/feed"><img src="../../../static/rss-small.png" title="AWS RSS Feed" label="AWS RSS Feed" alt="AWS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/AWS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="AWS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Arduino/feed"><img src="../../../static/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed" alt="Arduino RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Arduino" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Arduino" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Authentication/feed"><img src="../../../static/rss-small.png" title="Authentication RSS Feed" label="Authentication RSS Feed" alt="Authentication RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Authentication" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Authentication" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Blog/feed"><img src="../../../static/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed" alt="Blog RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Blog" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Blog" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/C++/feed"><img src="../../../static/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed" alt="C++ RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/C++" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="C++" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/CSS/feed"><img src="../../../static/rss-small.png" title="CSS RSS Feed" label="CSS RSS Feed" alt="CSS RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/CSS" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="CSS" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Cloud/feed"><img src="../../../static/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed" alt="Cloud RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Cloud" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Cloud" /> <small><em>10</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Database/feed"><img src="../../../static/rss-small.png" title="Database RSS Feed" label="Database RSS Feed" alt="Database RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Database" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Database" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Docker/feed"><img src="../../../static/rss-small.png" title="Docker RSS Feed" label="Docker RSS Feed" alt="Docker RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Docker" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Docker" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Filmmaking/feed"><img src="../../../static/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed" alt="Filmmaking RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Filmmaking" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Filmmaking" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Flask/feed"><img src="../../../static/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed" alt="Flask RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Flask" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Flask" /> <small><em>126</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Games/feed"><img src="../../../static/rss-small.png" title="Games RSS Feed" label="Games RSS Feed" alt="Games RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Games" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Games" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Heroku/feed"><img src="../../../static/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed" alt="Heroku RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Heroku" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Heroku" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/IoT/feed"><img src="../../../static/rss-small.png" title="IoT RSS Feed" label="IoT RSS Feed" alt="IoT RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/IoT" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="IoT" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/JavaScript/feed"><img src="../../../static/rss-small.png" title="JavaScript RSS Feed" label="JavaScript RSS Feed" alt="JavaScript RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/JavaScript" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="JavaScript" /> <small><em>35</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/MicroPython/feed"><img src="../../../static/rss-small.png" title="MicroPython RSS Feed" label="MicroPython RSS Feed" alt="MicroPython RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/MicroPython" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="MicroPython" /> <small><em>9</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microdot/feed"><img src="../../../static/rss-small.png" title="Microdot RSS Feed" label="Microdot RSS Feed" alt="Microdot RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microdot" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microdot" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Microservices/feed"><img src="../../../static/rss-small.png" title="Microservices RSS Feed" label="Microservices RSS Feed" alt="Microservices RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Microservices" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Microservices" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Movie Reviews/feed"><img src="../../../static/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed" alt="Movie Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Movie Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Movie Reviews" /> <small><em>5</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/OpenStack/feed"><img src="../../../static/rss-small.png" title="OpenStack RSS Feed" label="OpenStack RSS Feed" alt="OpenStack RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/OpenStack" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="OpenStack" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Personal/feed"><img src="../../../static/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed" alt="Personal RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Personal" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Personal" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Photography/feed"><img src="../../../static/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed" alt="Photography RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Photography" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Photography" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Product Reviews/feed"><img src="../../../static/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed" alt="Product Reviews RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Product Reviews" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Product Reviews" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Programming/feed"><img src="../../../static/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed" alt="Programming RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Programming" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Programming" /> <small><em>187</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Project Management/feed"><img src="../../../static/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed" alt="Project Management RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Project Management" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Project Management" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Python/feed"><img src="../../../static/rss-small.png" title="Python RSS Feed" label="Python RSS Feed" alt="Python RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Python" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Python" /> <small><em>169</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/REST/feed"><img src="../../../static/rss-small.png" title="REST RSS Feed" label="REST RSS Feed" alt="REST RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/REST" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="REST" /> <small><em>7</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Rackspace/feed"><img src="../../../static/rss-small.png" title="Rackspace RSS Feed" label="Rackspace RSS Feed" alt="Rackspace RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Rackspace" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Rackspace" /> <small><em>1</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Raspberry Pi/feed"><img src="../../../static/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed" alt="Raspberry Pi RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Raspberry Pi" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Raspberry Pi" /> <small><em>8</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/React/feed"><img src="../../../static/rss-small.png" title="React RSS Feed" label="React RSS Feed" alt="React RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/React" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="React" /> <small><em>18</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Robotics/feed"><img src="../../../static/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed" alt="Robotics RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Robotics" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Robotics" /> <small><em>6</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Security/feed"><img src="../../../static/rss-small.png" title="Security RSS Feed" label="Security RSS Feed" alt="Security RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Security" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Security" /> <small><em>12</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Video/feed"><img src="../../../static/rss-small.png" title="Video RSS Feed" label="Video RSS Feed" alt="Video RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Video" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Video" /> <small><em>22</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/WebSocket/feed"><img src="../../../static/rss-small.png" title="WebSocket RSS Feed" label="WebSocket RSS Feed" alt="WebSocket RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/WebSocket" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="WebSocket" /> <small><em>2</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Webcast/feed"><img src="../../../static/rss-small.png" title="Webcast RSS Feed" label="Webcast RSS Feed" alt="Webcast RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Webcast" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Webcast" /> <small><em>3</em></small>
      </form>
    </div>
    
    <div class="category">
      <a href="https://blog.miguelgrinberg.com/category/Windows/feed"><img src="../../../static/rss-small.png" title="Windows RSS Feed" label="Windows RSS Feed" alt="Windows RSS Feed" /></a>
      <form action="https://blog.miguelgrinberg.com/category/Windows" method="POST">
        <input type="submit" class="btn btn-primary btn-sm" value="Windows" /> <small><em>1</em></small>
      </form>
    </div>
    
  </div>
</div>
        
      </div>
    </div>
    
  </div>
  <div id="footer">
    
    <p>&copy; 2012-<script type="text/javascript">document.write(new Date().getFullYear());</script> by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster _at_ miguelgrinberg _dot_ com">Questions?</a></p>
  </div>
</div>

  
    <script src="../../../../cdn.jsdelivr.net/npm/bootstrap%405.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script type="text/javascript" src="../../../static/prettify.js"></script>
  <script src="../../../../cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous"></script>

<script>
moment.locale("en");
function flask_moment_render(elem) {{
    const timestamp = moment(elem.dataset.timestamp);
    const func = elem.dataset.function;
    const format = elem.dataset.format;
    const timestamp2 = elem.dataset.timestamp2;
    const no_suffix = elem.dataset.nosuffix;
    const units = elem.dataset.units;
    let args = [];
    if (format)
        args.push(format);
    if (timestamp2)
        args.push(moment(timestamp2));
    if (no_suffix)
        args.push(no_suffix);
    if (units)
        args.push(units);
    elem.textContent = timestamp[func].apply(timestamp, args);
    elem.classList.remove('flask-moment');
    elem.style.display = "";
}}
function flask_moment_render_all() {{
    const moments = document.querySelectorAll('.flask-moment');
    moments.forEach(function(moment) {{
        flask_moment_render(moment);
        const refresh = moment.dataset.refresh;
        if (refresh && refresh > 0) {{
            (function(elem, interval) {{
                setInterval(function() {{
                    flask_moment_render(elem);
                }}, interval);
            }})(moment, refresh);
        }}
    }})
}}
document.addEventListener("DOMContentLoaded", flask_moment_render_all);
</script>

  
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-20EHZP9GRZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-20EHZP9GRZ');
  </script>
  
  <script type="text/javascript">
    function setThemeUI() {
      document.getElementById('select-theme-auto').classList.remove('active');
      document.getElementById('select-theme-light').classList.remove('active');
      document.getElementById('select-theme-dark').classList.remove('active');
      const theme = getPreferredTheme();
      const actualTheme = document.documentElement.getAttribute('data-bs-theme', 'light');
      document.getElementById('select-theme-' + theme).classList.add('active');
      document.getElementById('current-theme').href.baseVal = `#icon-theme-${actualTheme}`;
    };

    function updateTheme(theme) {
      if (theme === 'auto') {
        localStorage.removeItem('theme')
      }
      else {
        localStorage.setItem('theme', theme)
      }
      setTheme(getPreferredTheme());
    }

    setThemeUI();

    const darkModePreference = window.matchMedia("(prefers-color-scheme: dark)");
    darkModePreference.addEventListener("change", e => {
      if (getPreferredTheme() === 'auto') {
        setTheme('auto');
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      // add prettyprint class to all <pre><code></code></pre> blocks
      let prettify = false;
      document.querySelectorAll('div.post-body pre code').forEach((code) => {
        code.parentNode.classList.add('prettyprint');
        prettify = true;
      });
      prettyPrint();
    });
  </script>

  </body>

<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-xvi-full-text-search-2018/page/5 by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 22 Oct 2024 08:51:07 GMT -->
</html>